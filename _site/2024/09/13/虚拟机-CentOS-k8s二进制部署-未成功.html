<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1">--><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰ | å°_å±®ã€çš„åšå®¢æ—¥è®°</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="æœåŠ¡å™¨å¯†ç  mfhk12xx" />
<meta property="og:description" content="æœåŠ¡å™¨å¯†ç  mfhk12xx" />
<link rel="canonical" href="http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html" />
<meta property="og:url" content="http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html" />
<meta property="og:site_name" content="å°_å±®ã€çš„åšå®¢æ—¥è®°" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-13T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-09-13T00:00:00+08:00","datePublished":"2024-09-13T00:00:00+08:00","description":"æœåŠ¡å™¨å¯†ç  mfhk12xx","headline":"è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html"},"url":"http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="å°_å±®ã€çš„åšå®¢æ—¥è®°" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">å°_å±®ã€çš„åšå®¢æ—¥è®°</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="https://jekyllrb.com/" target="_blank">æ¥è‡ªjekyllğŸ¤©</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-09-13T00:00:00+08:00" itemprop="datePublished">2024å¹´09æœˆ13æ—¥
      </time>â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">å°_å±®ã€</span></span></p><span class="tag-type">#è¿ç»´</span><span class="tag-type">#linux</span><span class="tag-type">#CentOS</span><span class="tag-type">#è™šæ‹Ÿæœº</span><span class="tag-type">#k8s</span><span class="tag-type">#kubernetes</span><span class="tag-type">#containerd</span></header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>æœåŠ¡å™¨å¯†ç  mfhk12xx</p>

<p>æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œé€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æœ€è¿‘æŠ¥é”™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>journalctl -xe
</code></pre></div></div>

<p>ä¹Ÿå¯é€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æœ€è¿‘æœåŠ¡çš„æ—¥å¿—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tail -f /var/log/messages
</code></pre></div></div>

<p>æŸ¥çœ‹ETCDå¥åº·çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_PREFIX='ETCDCTL_API=3 etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379" --write-out=table'
eval "${ETCD_PREFIX} endpoint health"
</code></pre></div></div>

<p>æŸ¥çœ‹masterç»„ä»¶å¥åº·çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status kube-proxy
systemctl status kubelet
systemctl status kube-scheduler
systemctl status kube-controller-manager
systemctl status kube-apiserver
kubectl get cs
</code></pre></div></div>

<h1 id="å‰ç½®æ“ä½œ">å‰ç½®æ“ä½œ</h1>

<h2 id="æå¥‡æ•°å°linuxæœåŠ¡å™¨">æå¥‡æ•°å°linuxæœåŠ¡å™¨</h2>

<p>æ€ä¹ˆæçš„ç•¥ï¼Œæˆ‘æäº†ä¸‰ä¸ª</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">host</th>
      <th style="text-align: center">ip</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">k8s-master</td>
      <td style="text-align: center">192.168.100.100</td>
    </tr>
    <tr>
      <td style="text-align: center">k8s-node1</td>
      <td style="text-align: center">192.168.100.101</td>
    </tr>
    <tr>
      <td style="text-align: center">k8s-node2</td>
      <td style="text-align: center">192.168.100.102</td>
    </tr>
  </tbody>
</table>

<h2 id="åˆ†é…å¥½ä¸»ä»èŠ‚ç‚¹">åˆ†é…å¥½ä¸»ä»èŠ‚ç‚¹</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; /etc/hosts &lt;&lt;EOF
192.168.100.100 k8s-master
192.168.100.101 k8s-node1
192.168.100.102 k8s-node2
EOF

</code></pre></div></div>

<h2 id="å…³é—­é˜²ç«å¢™">å…³é—­é˜²ç«å¢™</h2>

<p>è¿™æ ·çš„æ¯”è¾ƒæ–¹ä¾¿</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop firewalld
systemctl disable firewalld

</code></pre></div></div>

<h2 id="å…³é—­swap">å…³é—­swap</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -ri 's/.*swap.*/#&amp;/' /etc/fstab #æ°¸ä¹…
#swapoff -a   #ä¸´æ—¶

</code></pre></div></div>

<h2 id="å…³é—­selinux">å…³é—­selinux</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -i 's/enforcing/disabled/' /etc/selinux/config  #æ°¸ä¹…
#setenforce 0  # ä¸´æ—¶ 

</code></pre></div></div>

<h2 id="æ¡¥æ¥æµé‡è½¬å‘">æ¡¥æ¥æµé‡è½¬å‘</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt;EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv6.conf.all.disable_ipv6=1
net.ipv4.ip_forward=1
EOF
sysctl --system

</code></pre></div></div>

<h2 id="æ—¶é—´åŒæ­¥">æ—¶é—´åŒæ­¥</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install ntpdate -y
ntpdate time.windows.com

</code></pre></div></div>

<h2 id="ä¸»æœºåè§„åˆ’">ä¸»æœºåè§„åˆ’</h2>

<p>æŒ‰ç…§è§„åˆ’åœ¨å¯¹åº”ipçš„æœåŠ¡å™¨æ‰§è¡Œå¯¹åº”çš„set-hostname</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hostnamectl set-hostname k8s-master 
hostnamectl set-hostname k8s-node1
hostnamectl set-hostname k8s-node2

</code></pre></div></div>

<h2 id="æœåŠ¡éƒ¨ç½²">æœåŠ¡éƒ¨ç½²</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ip</th>
      <th style="text-align: center">host</th>
      <th style="text-align: center">æœåŠ¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">192.168.100.100</td>
      <td style="text-align: center">k8s-master</td>
      <td style="text-align: center">kube-proxy<br />kubelet<br />kube-scheduler<br />kube-controller-manager<br />kube-apiserver</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.100.101</td>
      <td style="text-align: center">k8s-node1</td>
      <td style="text-align: center">kube-proxy<br />kubelet</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.100.102</td>
      <td style="text-align: center">k8s-node2</td>
      <td style="text-align: center">kube-proxy<br />kubelet</td>
    </tr>
  </tbody>
</table>

<h1 id="éƒ¨ç½²etcd">éƒ¨ç½²ETCD</h1>

<h2 id="ä¸‹è½½cfssl">ä¸‹è½½cfssl</h2>

<p>åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šä¸‹è½½å°±è¡Œäº†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssl_1.6.3_linux_amd64 -O /usr/local/bin/cfssl
wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssljson_1.6.3_linux_amd64 -O /usr/local/bin/cfssljson
wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssl-certinfo_1.6.3_linux_amd64 -O /usr/local/bin/cfssl-certinfo

chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson /usr/local/bin/cfssl-certinfo 

cp cfssl_1.6.3_linux_amd64 cfssl
cp cfssl-certinfo_1.6.3_linux_amd64 cfssl-certinfo
cp cfssljson_1.6.3_linux_amd64 cfssljson
</code></pre></div></div>

<p>wgetä¸‹è½½ä¸ä¸‹æ¥å¯ä»¥æ‰‹åŠ¨ä¸‹è½½</p>

<h2 id="etcdè¯ä¹¦åˆ›å»º">ETCDè¯ä¹¦åˆ›å»º</h2>

<p>åœ¨ä¸‹è½½äº†cfsslçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/etcd/{bin,cfg,ssl} -p
cd /opt/etcd/ssl/
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ca-config.json
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "signing": {
        "default": {
            "expiry": "87600h"
        },
        "profiles": {
            "etcd": {
                "expiry": "87600h",
                "usages": [
                    "signing",
                    "key encipherment",
                    "server auth",
                    "client auth"
                ]
            }
        }
    }
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ca-csr.json
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "CN": "etcd CA",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "Beijing",
            "L": "Beijing"
        }
    ]
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi server-csr.json
</code></pre></div></div>

<p>ä¸‹é¢çš„hostséœ€è¦æ”¹æˆè‡ªå·±çš„</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "CN": "etcd",
    "hosts": [
         "192.168.100.100",
         "192.168.100.101",
         "192.168.100.102"
        ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "Beijing",
            "L": "Beijing"
        }
    ]
}
</code></pre></div></div>

<p>ç”Ÿæˆ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=etcd server-csr.json | cfssljson -bare server
</code></pre></div></div>

<p>è¯ä¹¦æ‹·è´åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç›¸åŒä½ç½®ï¼Œä¸»è¦æ˜¯ca.pemã€server.pemã€server-key.pemä¸‰ä¸ªæ–‡ä»¶ï¼Œæˆ‘æ”¾åœ¨/opt/etcd/ssl/å†…éƒ¨</p>

<h2 id="etcdé›†ç¾¤æ­å»º">ETCDé›†ç¾¤æ­å»º</h2>

<p>åœ¨ä¸€å°æœåŠ¡å™¨ä¸‹è½½etcd</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_VER=v3.4.24

//è¿™ä¸¤ä¸ªéƒ½å¯ä»¥
GOOGLE_URL=https://storage.googleapis.com/etcd
GITHUB_URL=https://github.com/etcd-io/etcd/releases/download
DOWNLOAD_URL=${GOOGLE_URL}

rm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
rm -rf /tmp/etcd-download-test &amp;&amp; mkdir -p /tmp/etcd-download-test

curl -L ${DOWNLOAD_URL}/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
tar xzvf /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz -C /tmp/etcd-download-test --strip-components=1
rm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp/etcd-download-test/
cp etcd etcdctl /usr/local/bin/
</code></pre></div></div>

<p>è¿™é‡Œçš„etcdã€etcdctlä¸¤ä¸ªæ–‡ä»¶æ‹·è´åˆ°å…¨éƒ¨èŠ‚ç‚¹çš„/usr/local/bin/ç›®å½•å†…</p>

<p>å¯¹æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼Œé…ç½®æ–‡ä»¶æ³¨æ„æ”¹ä¸€éƒ¨åˆ†</p>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/etcd/cfg/etcd.conf
</code></pre></div></div>

<p>é…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_INITIAL_CLUSTER_STATEETCD_INITIAL_CLUSTER_STATE#[Member]
ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
ETCD_NAME="etcd01"#ä¿®æ”¹ä¸ºETCD_INITIAL_CLUSTERä¸­=å³è¾¹ä¸ºæœ¬æœºipçš„å·¦è¾¹çš„name
ETCD_LISTEN_PEER_URLS="https://192.168.100.100:2380" #ä¿®æ”¹ä¸ºæœ¬æœºip
ETCD_LISTEN_CLIENT_URLS="https://192.168.100.100:2379,http://127.0.0.1:2379"#ä¿®æ”¹ä¸ºæœ¬æœºip
#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://192.168.100.100:2380"#ä¿®æ”¹ä¸ºæœ¬æœºip
ETCD_ADVERTISE_CLIENT_URLS="https://192.168.100.100:2379"#ä¿®æ”¹ä¸ºæœ¬æœºip

#ä¸‹é¢çš„åå­—è·Ÿipéœ€è¦äº‹å…ˆè§„åˆ’ä¸‹
ETCD_INITIAL_CLUSTER="etcd01=https://192.168.100.100:2380,etcd02=https://192.168.100.101:2380,etcd03=https://192.168.100.102:2380"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"
ETCD_INITIAL_CLUSTER_STATE="new"
#[Security]

#è¿™é‡Œæ˜¯å‰é¢cfsslåˆ›å»ºçš„è¯ä¹¦ï¼Œç”¨äºå¼€å¯TLS
ETCD_CERT_FILE="/opt/etcd/ssl/server.pem"
ETCD_KEY_FILE="/opt/etcd/ssl/server-key.pem"
ETCD_TRUSTED_CA_FILE="/opt/etcd/ssl/ca.pem"
ETCD_CLIENT_CERT_AUTH="true"
ETCD_PEER_CERT_FILE="/opt/etcd/ssl/server.pem"
ETCD_PEER_KEY_FILE="/opt/etcd/ssl/server-key.pem"
ETCD_PEER_TRUSTED_CA_FILE="/opt/etcd/ssl/ca.pem"
ETCD_PEER_CLIENT_CERT_AUTH="true"
</code></pre></div></div>

<p>å­—æ®µä»‹ç»ï¼Œä¸‹é¢çš„ä»£ç å—æ˜¯ä»‹ç»ï¼Œçœ‹çœ‹å°±è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--initial-clusterï¼šé›†ç¾¤å½“ä¸­çš„å…¶ä»–èŠ‚ç‚¹
--cert-fileï¼šetcdè¯ä¹¦è·¯å¾„
--key-fileï¼šetcdç§é’¥è·¯å¾„
--peer-cert-fileï¼šå¯¹ç­‰è¯ä¹¦(åŒå‘è¯ä¹¦)è·¯å¾„
--peer-key-fileï¼šå¯¹ç­‰è¯ä¹¦(åŒå‘è¯ä¹¦)ç§é’¥è·¯å¾„
--trusted-ca-fileï¼šä½œä¸ºå®¢æˆ·ç«¯æ—¶çš„CAè¯ä¹¦è·¯å¾„
--peer-trusted-ca-fileï¼šå¯¹ç­‰è¯ä¹¦çš„CAè¯ä¹¦è·¯å¾„
--initial-advertise-peer-urlsï¼šåˆ—å‡ºé›†ç¾¤æˆå‘˜é€šä¿¡çš„URLï¼Œç”¨äºé€šå‘Šé›†ç¾¤å…¶ä»–æˆå‘˜
--listen-peer-urlsï¼šç”¨äºç›‘å¬é›†ç¾¤å…¶ä»–æˆå‘˜çš„URLåˆ—è¡¨
--listen-client-urlsï¼šç”¨äºç›‘å¬å®¢æˆ·ç«¯é€šè®¯çš„URLåˆ—è¡¨
--advertise-client-urlsï¼šé€šå‘Šå®¢æˆ·ç«¯çš„URLï¼Œç”¨äºåˆ—å‡ºæ‰€æœ‰å®¢æˆ·ç«¯
--initial-cluster-tokenï¼šetcdé›†ç¾¤çš„åˆå§‹é›†ç¾¤ä»¤ç‰Œï¼ŒæœåŠ¡å™¨å¿…é¡»é€šè¿‡ä»¤ç‰Œæ‰èƒ½åŠ å…¥etcdé›†ç¾¤
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /usr/lib/systemd/system/etcd.service
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
EnvironmentFile=-/opt/etcd/cfg/etcd.conf
ExecStart=/usr/local/bin/etcd
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
</code></pre></div></div>

<p>ç„¶åå¯åŠ¨æœåŠ¡ï¼Œç»„æˆé›†ç¾¤çš„å‡ ä¸ªèŠ‚ç‚¹éœ€è¦åŒæ—¶å¼€å¯etcdæœåŠ¡ï¼Œä»ä¸Šåˆ°ä¸‹çš„æŒ‡ä»¤åˆ†åˆ«æ˜¯ï¼š</p>

<p>è¯»å–æœåŠ¡æ–‡ä»¶ã€å¼€æœºå¯åŠ¨etcdã€å¼€å¯etcdæœåŠ¡ã€æŸ¥çœ‹etcdè¿è¡ŒçŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable etcd
systemctl start etcd
systemctl status etcd

</code></pre></div></div>

<p>è¿è¡ŒçŠ¶æ€æ˜¯runningå°±è¡Œ</p>

<p>è¿™é‡Œçš„æœåŠ¡å¯åŠ¨è¦åŒæ—¶ï¼ŒETCD_INITIAL_CLUSTERé…ç½®æœ‰å‡ å°å°±è¦åœ¨å‡ å°å¯åŠ¨ã€‚</p>

<p>æœåŠ¡å¯åŠ¨è¦æ˜¯æŠ¥é”™äº†æœ‰æç¤ºã€å¯ä»¥ç™¾åº¦çœ‹çœ‹å“ªé‡Œæœ‰é—®é¢˜</p>

<hr />

<p>åˆ°è¿™é‡Œå°±éƒ¨ç½²å®Œæ¯•äº†ï¼Œåé¢æ˜¯å¯¹éƒ¨ç½²ç»“æœçš„æŸ¥çœ‹</p>

<p>ä½¿ç”¨è„šæ‰‹æ¶çš„å›ºå®šå‰ç¼€ï¼Œè¯ä¹¦ä½ç½®è‡ªå·±å®šï¼ŒæœåŠ¡å™¨ipè‡ªå·±æ”¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_PREFIX='ETCDCTL_API=3 etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379" --write-out=table'
</code></pre></div></div>

<p>æŸ¥çœ‹æˆå‘˜ä¿¡æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "${ETCD_PREFIX} member list"
</code></pre></div></div>

<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "${ETCD_PREFIX} endpoint health"
</code></pre></div></div>

<p>å…¨éƒ¨çš„healthåˆ—éƒ½æ˜¯trueè¡¨ç¤ºéƒ¨ç½²å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæœ‰æŸä¸€ä¸ªhealthæ˜¯falseï¼Œé‡å¯é‚£ä¸€ä¸ªetcdã€‚</p>

<p>é‡å¯å‰ä¿®æ”¹é…ç½®çš„ETCD_INITIAL_CLUSTER_STATEä¸ºâ€existingâ€ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å³å¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart etcd
</code></pre></div></div>

<h1 id="éƒ¨ç½²containerd">éƒ¨ç½²Containerd</h1>

<p>å…¨éƒ¨èŠ‚ç‚¹æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œcontaineréƒ¨ç½²</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/{containerd,cni/bin} -p
</code></pre></div></div>

<p>ä¸‹containerçš„è½½gzå®‰è£…åŒ…è·Ÿcniçš„gzå®‰è£…åŒ…è¿˜æœ‰runcçš„äºŒè¿›åˆ¶åŒ…ï¼Œè¿™é‡Œcontainerä½¿ç”¨1.7.0ç‰ˆæœ¬ï¼Œcniä½¿ç”¨1.2.0ï¼Œruncä½¿ç”¨1.1.4</p>

<p>containerdä¸‹è½½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/containerd/containerd/releases/download/v1.7.0/containerd-1.7.0-linux-amd64.tar.gz
</code></pre></div></div>

<p>cniæ’ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/containernetworking/plugins/releases/download/v1.2.0/cni-plugins-linux-amd64-v1.2.0.tgz
</code></pre></div></div>

<p>runcæ’ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64
</code></pre></div></div>

<p>containerdæ–‡ä»¶æ”¾åˆ°/opt/containerdè§£å‹ï¼Œctræ”¾åˆ°ç³»ç»Ÿç¯å¢ƒ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /opt/containerd/bin/ctr  /usr/local/bin
</code></pre></div></div>

<p>cniæ”¾åˆ°/opt/cni/binè§£å‹</p>

<p>è§£å‹å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxf *gz
</code></pre></div></div>

<p>åœ¨æ”¾ç½®runc.amd64çš„åœ°æ–¹è¿è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install -m 755 runc.amd64 /usr/local/sbin/runc
</code></pre></div></div>

<p>å…ˆå¯åŠ¨ä¸€æ¬¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/systemd/system/containerd.service &lt;&lt;EOF
[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target local-fs.target
 
[Service]
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/opt/containerd/bin/containerd
Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5
LimitNPROC=infinity
LimitCORE=infinity
LimitNOFILE=infinity
TasksMax=infinity
OOMScoreAdjust=-999
 
[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
systemctl enable containerd
systemctl start containerd
systemctl status containerd
</code></pre></div></div>

<p>é…ç½®Containerdæ‰€éœ€çš„æ¨¡å—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/modules-load.d/containerd.conf &lt;&lt;EOF
overlay
br_netfilter
EOF
systemctl restart systemd-modules-load.service
</code></pre></div></div>

<p>é…ç½®Containerdæ‰€éœ€çš„å†…æ ¸</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
sysctl --system
</code></pre></div></div>

<p>åˆ›å»ºcnié…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/cni/net.d/ -p
cat &gt; /etc/cni/net.d/10-mynet.conf &lt;&lt;EOF
{
    "cniVersion": "1.0.0",
    "name": "mynet",
    "type": "bridge",
    "bridge": "cni0",
    "isGateway": true,
    "ipMasq": true,
    "ipam": {
        "type": "host-local",
        "subnet": "10.88.0.0/16",
        "routes": [
            {
                "dst": "0.0.0.0/0"
            }
        ]
    }
}
EOF
cat &gt; /etc/cni/net.d/99-loopback.conf &lt;&lt;EOF
{
    "cniVerion": "1.0.0",
    "name": "lo",
    "type": "loopback"
}
EOF
</code></pre></div></div>

<p>åˆ›å»ºContainerdçš„é…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/containerd
/opt/containerd/bin/containerd config default | tee /etc/containerd/config.toml
</code></pre></div></div>

<p><strong>ä¿®æ”¹Containerdçš„é…ç½®æ–‡ä»¶/etc/containerd/config.tomlï¼Œå‡ ä¸ªé…ç½®æ˜¯åˆ†å¼€çš„</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#è¿™ä¸ªé…ç½®é‡Œçš„[plugins."io.containerd.grpc.v1.cri"]
sandbox_image = "registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6"
#è¿™ä¸ªé…ç½®é‡Œçš„[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options] SystemdCgroupæ³¨é‡Šæ‰
# SystemdCgroup = true
</code></pre></div></div>

<p>æŸ¥çœ‹é…ç½®é‡Œçš„è¿™ä¸€é¡¹config_pathï¼Œæ²¡æœ‰è‡ªå·±åŠ </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[plugins."io.containerd.grpc.v1.cri".registry]
  config_path = "/etc/containerd/certs.d"
</code></pre></div></div>

<p>æŸ¥çœ‹å‘½åç©ºé—´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctr namespaces ls
</code></pre></div></div>

<p>åˆ›å»ºå‘½åç©ºé—´çš„é…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/containerd/certs.d/k8s.io -p
</code></pre></div></div>

<p>é…ç½®é•œåƒåŠ é€Ÿhost.åé¢çš„æ”¹æˆè‡ªå·±é˜¿é‡Œäº‘çš„å…è´¹é•œåƒåŠ é€Ÿåœ°å€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;  /etc/containerd/certs.d/k8s.io/hosts.toml  &lt;&lt;EOF
server = "https://k8s.io"

[host."https://d68wvxw0.mirror.aliyuncs.com"]
  capabilities = ["pull", "resolve", "push"]
EOF
</code></pre></div></div>

<p>å¯åŠ¨æµ‹è¯•</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart containerd
ctr version

</code></pre></div></div>

<p>##</p>

<h1 id="ä¸»èŠ‚ç‚¹éƒ¨ç½²masterç»„ä»¶">ä¸»èŠ‚ç‚¹éƒ¨ç½²Masterç»„ä»¶</h1>

<h2 id="ä¸‹è½½æºç ">ä¸‹è½½æºç </h2>

<p>è¿™é‡Œæœ‰å…¨éƒ¨ç‰ˆæœ¬çš„æ—¥å¿—ï¼Œè¿›å»è¿™ä¸ªé¡µé¢ä¸‹æ»‘æœ‰å¾ˆå¤šç‰ˆæœ¬</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG
</code></pre></div></div>

<p>ç‚¹å‡»ç‰ˆæœ¬è¿›å»åå°±èƒ½çœ‹åˆ°ç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥</p>

<p>ç‚¹å‡»Download for xxxï¼Œè¿›å»æ‰¾åˆ°Server Binariesï¼Œæ˜¯Serverï¼Œä¸‹è½½ç¬¬ä¸€ä¸ªkubernetes-server-linux-amd64.tar.gz</p>

<p>æˆ‘ä¸‹è½½çš„1.26.3ç‰ˆæœ¬ï¼Œä¹‹ååˆ°è§„åˆ’çš„MasteræœåŠ¡å™¨è·‘ä»£ç </p>

<p>è§„åˆ’ä¸€ä¸ªæ”¾k8sçš„æ–‡ä»¶å¤¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs} 
</code></pre></div></div>

<p>å°†ä¸‹è½½çš„gzæ–‡ä»¶æ”¾åœ¨/opt/kubernetes/ç›®å½•ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/kubernetes
tar zxvf kubernetes-server-linux-amd64.tar.gz
cd kubernetes/server/bin
cp kube-apiserver kube-scheduler kube-controller-manager kubelet kube-proxy kubectl kubeadm /opt/kubernetes/bin
cp kubectl kubeadm /usr/bin/
</code></pre></div></div>

<h2 id="éƒ¨ç½²kube-apiserver">éƒ¨ç½²kube-apiserver</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-apiserver

cd /opt/kubernetes/ssl/kube-apiserver


cat &gt; ca-config.json &lt;&lt; EOF
{
  "signing": {
    "default": {
      "expiry": "87600h"
    },
    "profiles": {
      "kubernetes": {
         "expiry": "87600h",
         "usages": [
            "signing",
            "key encipherment",
            "server auth",
            "client auth"
        ]
      }
    }
  }
}
EOF
cat &gt; ca-csr.json &lt;&lt; EOF
{
    "CN": "kubernetes",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "Beijing",
            "ST": "Beijing",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
EOF

cat &gt; server-csr.json &lt;&lt; EOF
{
    "CN": "kubernetes",
    "hosts": [
      "127.0.0.1",
      "192.168.100.100",
      "192.168.100.101",
      "192.168.100.102",
      "k8s-master",
      "k8s-node1",
      "k8s-node2"
    ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "BeiJing",
            "ST": "BeiJing",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server

</code></pre></div></div>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; EOF
KUBE_APISERVER_OPTS="--v=2 \\
--etcd-servers=https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379 \\
--etcd-cafile=/opt/etcd/ssl/ca.pem \\
--etcd-certfile=/opt/etcd/ssl/server.pem \\
--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\
--bind-address=192.168.100.100 \\
--secure-port=6443 \\
--advertise-address=192.168.100.100 \\
--allow-privileged=true \\
--authorization-mode=RBAC,Node \\
--token-auth-file=/opt/kubernetes/cfg/token.csv \\
--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
--enable-bootstrap-token-auth=true \\
--service-cluster-ip-range=10.0.0.0/24 \\
--service-node-port-range=30000-32767 \\
--service-account-issuer=api \\
--service-account-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem \\
--service-account-signing-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--proxy-client-cert-file=/opt/kubernetes/ssl/kube-apiserver/server.pem \\
--proxy-client-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--kubelet-client-certificate=/opt/kubernetes/ssl/kube-apiserver/server.pem \\
--kubelet-client-key=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--tls-cert-file=/opt/kubernetes/ssl/kube-apiserver/server.pem  \\
--tls-private-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--client-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--requestheader-client-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--requestheader-allowed-names=kubernetes \\
--requestheader-extra-headers-prefix=X-Remote-Extra- \\
--requestheader-group-headers=X-Remote-Group \\
--requestheader-username-headers=X-Remote-User \\
--enable-aggregator-routing=true \\
--audit-log-maxage=30 \\
--audit-log-maxbackup=3 \\
--audit-log-maxsize=100 \\
--audit-log-path=/opt/kubernetes/logs/k8s-audit.log"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆä¸€ä¸ªtoken</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>head -c 16 /dev/urandom | od -An -t x | tr -d ' '

</code></pre></div></div>

<p>å†™å…¥bootstrapingéªŒè¯tokençš„æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; EOF
dcbfd5e168fde8abda5ed8b0fda3291f,kubelet-bootstrap,10001,"system:node-bootstrapper"
EOF

</code></pre></div></div>

<p>åˆ›å»ºapiserveræœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-apiserver
systemctl start kube-apiserver 
systemctl status kube-apiserver 

</code></pre></div></div>

<p>çŠ¶æ€æ˜¯runningå°±ok</p>

<h2 id="éƒ¨ç½²kube-controller-manager">éƒ¨ç½²kube-controller-manager</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; EOF
KUBE_CONTROLLER_MANAGER_OPTS="--v=2 \\
--leader-elect=true \\
--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
--bind-address=127.0.0.1 \\
--allocate-node-cidrs=true \\
--cluster-cidr=10.244.0.0/16 \\
--service-cluster-ip-range=10.0.0.0/24 \\
--cluster-signing-cert-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--cluster-signing-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem  \\
--root-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--service-account-private-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem \\
--cluster-signing-duration=87600h0m0s"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-controller-manager
cd /opt/kubernetes/ssl/kube-controller-manager
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-controller-manager
cat &gt; kube-controller-manager-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-controller-manager",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing", 
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager

</code></pre></div></div>

<p>shellæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆkubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-controller-manager.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-controller-manager \
  --client-certificate=/opt/kubernetes/ssl/kube-controller-manager/kube-controller-manager.pem \
  --client-key=/opt/kubernetes/ssl/kube-controller-manager/kube-controller-manager-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-controller-manager \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-controller-manager
systemctl start kube-controller-manager
systemctl status kube-controller-manager

</code></pre></div></div>

<p>çŠ¶æ€æ˜¯runningå°±ok</p>

<h2 id="éƒ¨ç½²-kube-scheduler">éƒ¨ç½² kube-scheduler</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; EOF
KUBE_SCHEDULER_OPTS="--v=2 \\
--leader-elect \\
--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
--bind-address=127.0.0.1"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-scheduler
cd /opt/kubernetes/ssl/kube-scheduler
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-scheduler
# åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶
cat &gt; kube-scheduler-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-scheduler",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF
# ç”Ÿæˆè¯ä¹¦
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler

</code></pre></div></div>

<p>ç”Ÿæˆ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-scheduler.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-scheduler \
  --client-certificate=/opt/kubernetes/ssl/kube-scheduler/kube-scheduler.pem \
  --client-key=/opt/kubernetes/ssl/kube-scheduler/kube-scheduler-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-scheduler \
  --kubeconfig=${KUBE_CONFIG}
    
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡ç®¡ç†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-scheduler
systemctl start kube-scheduler
systemctl status kube-scheduler

</code></pre></div></div>

<h2 id="é›†ç¾¤ç®¡ç†å‰é…ç½®">é›†ç¾¤ç®¡ç†å‰é…ç½®</h2>

<p>ç”Ÿæˆé›†ç¾¤é“¾æ¥è¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-link
cd /opt/kubernetes/ssl/kube-link
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-link

cat &gt; admin-csr.json &lt;&lt;EOF
{
  "CN": "admin",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF

cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin

</code></pre></div></div>

<p>åˆ›å»ºkubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /root/.kube

KUBE_CONFIG="/root/.kube/config"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-link/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials cluster-admin \
  --client-certificate=/opt/kubernetes/ssl/kube-link/admin.pem \
  --client-key=/opt/kubernetes/ssl/kube-link/admin-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=cluster-admin \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>æŸ¥çœ‹èŠ‚ç‚¹ç»„ä»¶çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> kubectl get cs
</code></pre></div></div>

<p>healthå…¨æ˜¯trueå°±æ˜¯ç»„ä»¶æ­£å¸¸</p>

<p>åˆ›å»ºç”¨æˆ·</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper \
--user=kubelet-bootstrap

</code></pre></div></div>

<h1 id="é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹éƒ¨ç½²">é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹éƒ¨ç½²</h1>

<h2 id="å®‰è£…ctictl">å®‰è£…ctictl</h2>

<p>ä¸‹è½½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.26.1/crictl-v1.26.1-linux-amd64.tar.gz
</code></pre></div></div>

<p>è§£å‹åç§»åŠ¨åˆ°ç¯å¢ƒå˜é‡é‡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf crictl-v1.26.1-linux-amd64.tar.gz
mv crictl /usr/local/bin/
</code></pre></div></div>

<p>æ·»åŠ crictlé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/crictl.yaml &lt;&lt;EOF
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 2
debug: false
pull-image-on-create: false
disable-pull-on-run: false
EOF

</code></pre></div></div>

<h2 id="masteréƒ¨ç½²kubelet">ï¼ˆmasterï¼‰éƒ¨ç½²kubelet</h2>

<p>å…ˆåœ¨masterèŠ‚ç‚¹æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤kubeletéƒ¨ç½²</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; EOF
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
address: 0.0.0.0
port: 10250
readOnlyPort: 10255
cgroupDriver: cgroupfs
clusterDNS:
- 10.0.0.2
clusterDomain: k8s-master 
failSwapOn: false
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /opt/kubernetes/ssl/kube-apiserver/ca.pem 
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
maxOpenFiles: 1000000
maxPods: 110
EOF

</code></pre></div></div>

<p>åˆ›å»ºbootstrap.kubeconfig</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/bootstrap.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443" 
TOKEN="dcbfd5e168fde8abda5ed8b0fda3291f"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials "kubelet-bootstrap" \
  --token=${TOKEN} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user="kubelet-bootstrap" \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; EOF
KUBELET_OPTS="--hostname-override=k8s-master \\
--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
--config=/opt/kubernetes/cfg/kubelet-config.yml \\
--cert-dir=/opt/kubernetes/ssl/kube-link \\
--container-runtime-endpoint=unix:///run/containerd/containerd.sock"
EOF

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kubelet
systemctl start kubelet
systemctl status kubelet

</code></pre></div></div>

<p>å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get csr
#ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåçš„è¡¨æ ¼ï¼Œå–nameé‚£ä¸€å—ä½œä¸ºä¸‹é¢å‘½ä»¤çš„å‚æ•°
kubectl certificate approve node-csr-t8Gq2LXx4SJ-WDa-HFeuc0ESNvEZ8oMTsZcaybs1NII
#æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤èƒ½çœ‹åˆ°k8s-masterå±•ç¤ºåˆ—è¡¨çŠ¶æ€ä¸ºready
kubectl get nodes

</code></pre></div></div>

<h2 id="masteréƒ¨ç½²kube-proxy">ï¼ˆmasterï¼‰éƒ¨ç½²kube-proxy</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; EOF
KUBE_PROXY_OPTS="--v=2 \\
--config=/opt/kubernetes/cfg/kube-proxy-config.yml"
EOF
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; EOF
kind: KubeProxyConfiguration
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
metricsBindAddress: 0.0.0.0:10249
clientConnection:
  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
hostnameOverride: k8s-master
clusterCIDR: 10.244.0.0/16
EOF
</code></pre></div></div>

<p>åˆ›å»ºè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-proxy
cd /opt/kubernetes/ssl/kube-proxy
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-proxy
cat &gt; kube-proxy-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-proxy",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "k8s",
      "OU": "System"
    }
  ]
}
EOF
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy

</code></pre></div></div>

<p>ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-proxy.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"
CERT_PATH="/opt/kubernetes/ssl/kube-proxy"

kubectl config set-cluster kubernetes \
  --certificate-authority=${CERT_PATH}/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-proxy \
  --client-certificate=${CERT_PATH}/kube-proxy.pem \
  --client-key=${CERT_PATH}/kube-proxy-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-proxy \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
    EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-proxy
systemctl start kube-proxy
systemctl status kube-proxy

</code></pre></div></div>

<h2 id="masteræ·»åŠ ç½‘ç»œç®¡ç†ç»„ä»¶">ï¼ˆmasterï¼‰æ·»åŠ ç½‘ç»œç®¡ç†ç»„ä»¶</h2>

<p>ä¸‹è½½calicotl</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/projectcalico/calico/releases/download/v3.25.0/calicoctl-linux-amd64
</code></pre></div></div>

<p>æ”¾åˆ°/usr/local/bin/ä¸­</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv /usr/local/bin/calicoctl-linux-amd64 /usr/local/bin/calicoctl
chmod +x /usr/local/bin/calicoctl
</code></pre></div></div>

<p>ä¸‹è½½é…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/calico.yaml
</code></pre></div></div>

<p>æ”¾åˆ°/opt/kubernetes/cfg/ä¸­</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f /opt/kubernetes/cfg/calico.yaml
kubectl get pods -n kube-system
</code></pre></div></div>

<h2 id="nodeå¤åˆ¶èŠ‚ç‚¹">ï¼ˆnodeï¼‰å¤åˆ¶èŠ‚ç‚¹</h2>

<p>masterèŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/kubernetes
tar zvcf kube.gz bin/ cfg/ ssl/

</code></pre></div></div>

<p>å°†/opt/kubernetes/ä¸‹çš„kube.gzæ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p>

<p>å­èŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes

</code></pre></div></div>

<p>å°†åˆšåˆšä¸‹è½½çš„kube.gzæ–‡ä»¶ä¸Šä¼ åˆ°/opt/kubernetes/</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tar -zxvf kube.gz
 
</code></pre></div></div>

<p>åˆ é™¤éƒ¨åˆ†é…ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸åŒ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig 
rm -f /opt/kubernetes/ssl/kube-link/kubelet*

</code></pre></div></div>

<p>ä¿®æ”¹ä¸»æœºåç§°</p>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/kubernetes/cfg/kubelet.conf

</code></pre></div></div>

<p>ä¿®æ”¹ï¼šâ€“hostname-override=k8s-node1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/kubernetes/cfg/kube-proxy-config.yml

</code></pre></div></div>

<p>ä¿®æ”¹ï¼šhostnameOverride: k8s-node1</p>

<hr />

<p>åˆ›å»ºè½¯è¿æ¥ï¼ˆåˆ›å»ºæœåŠ¡ï¼‰kubeletä¸kube-proxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
    EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>è¿™é‡Œå¯ä»¥å¼€ä¸€ä¸ªæ–°çš„sshä¸“é—¨æ‰“æ—¥å¿—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tail -f /var/log/messages
</code></pre></div></div>

<p>å¼€å¯kubelet</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kubelet
systemctl start kubelet
systemctl status kubelet

</code></pre></div></div>

<p>å¼€å¯kube-proxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-proxy
systemctl start kube-proxy
systemctl status kube-proxy

</code></pre></div></div>

<p>åœ¨Masterä¸ŠåŒæ„æ–°çš„Node kubeletè¯ä¹¦ç”³è¯·</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get csr
kubectl certificate approve #åé¢æ˜¯ä¸Šé¢è¯­å¥è·å–çš„NAMEåˆ—çš„ä¸€è¡Œ
</code></pre></div></div>

<p>æŸ¥çœ‹èŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes
</code></pre></div></div>

<p>æœ‰ä¸‰ä¸ªReadyçš„</p>

  </div>

  <a class="u-url" href="/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html" hidden></a>

  <div class="previous-next"><div class="previous-post">
        ğŸ‘ˆğŸ»:<a href="/2023/09/06/Linux-CentOS-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1.html">Linux Centos å¦‚ä½•æ³¨å†Œè‡ªå·±çš„æœåŠ¡</a>
      </div><div class="next-post">
        <a href="/jekyll/update/2024/09/24/welcome-to-jekyll.html">Welcome to Jekyll!</a>:ğŸ‘‰ğŸ»
      </div></div>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">Googleé‚®ç®±,ä¸€èˆ¬ä¸çœ‹</li>
          <li><a class="u-email" href="mailto:xunderlinec1960@gmail.com">xunderlinec1960@gmail.com</a></li>
        </ul>
      </div>
      
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">QQé‚®ç®±ï¼Œæœ‰äº‹å‘è¿™é‡Œ</li>
          <li><a class="u-email" href="mailto:1960481101@qq.com">1960481101@qq.com</a></li>
        </ul>
      </div>
      
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name">githubåŸºæœ¬æ²¡åœ¨ç”¨</li>
          <li><a href="https://github.com/XD3-BB"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">XD3-BB</span></a></li>
        </ul>
      </div>
    </div>

      <div class="footer-col footer-col-3">
        <span class="p-name">WordPressæ”¶è´¹ï¼ŒGhoståˆå¤ªå¤§äº†ï¼Œ2æ ¸2Gçš„æœåŠ¡å™¨è·‘ä¸èµ·æ¥ã€‚ã€‚è¿˜å¾—æ˜¯jekyllğŸ¥°</span>
      </div>
  </div>

</footer>
</body>

</html>
