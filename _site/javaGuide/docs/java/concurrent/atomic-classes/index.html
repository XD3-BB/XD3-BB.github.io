<h2 id="atomic-åŸå­ç±»ä»‹ç»">Atomic åŸå­ç±»ä»‹ç»</h2>

<p><code class="language-plaintext highlighter-rouge">Atomic</code> ç¿»è¯‘æˆä¸­æ–‡æ˜¯â€œåŸå­â€çš„æ„æ€ã€‚åœ¨åŒ–å­¦ä¸Šï¼ŒåŸå­æ˜¯æ„æˆç‰©è´¨çš„æœ€å°å•ä½ï¼Œåœ¨åŒ–å­¦ååº”ä¸­ä¸å¯åˆ†å‰²ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">Atomic</code> æŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œå…·æœ‰åŸå­æ€§ï¼Œå³è¯¥æ“ä½œä¸å¯åˆ†å‰²ã€ä¸å¯ä¸­æ–­ã€‚å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œæ—¶ï¼Œè¯¥æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆä¸æ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°éƒ¨åˆ†å®Œæˆçš„çŠ¶æ€ã€‚</p>

<p>åŸå­ç±»ç®€å•æ¥è¯´å°±æ˜¯å…·æœ‰åŸå­æ€§æ“ä½œç‰¹å¾çš„ç±»ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">java.util.concurrent.atomic</code> åŒ…ä¸­çš„ <code class="language-plaintext highlighter-rouge">Atomic</code> åŸå­ç±»æä¾›äº†ä¸€ç§çº¿ç¨‹å®‰å…¨çš„æ–¹å¼æ¥æ“ä½œå•ä¸ªå˜é‡ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">Atomic</code> ç±»ä¾èµ–äº CASï¼ˆCompare-And-Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ä¹è§‚é”æ¥ä¿è¯å…¶æ–¹æ³•çš„åŸå­æ€§ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼ˆå¦‚ <code class="language-plaintext highlighter-rouge">synchronized</code> å—æˆ– <code class="language-plaintext highlighter-rouge">ReentrantLock</code>ï¼‰ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬åªä»‹ç» Atomic åŸå­ç±»çš„æ¦‚å¿µï¼Œå…·ä½“å®ç°åŸç†å¯ä»¥é˜…è¯»ç¬”è€…å†™çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="./cas.md">CAS è¯¦è§£</a>ã€‚</p>

<p><img src="https://oss.javaguide.cn/github/javaguide/java/JUC%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%A6%82%E8%A7%88.png" alt="JUCåŸå­ç±»æ¦‚è§ˆ" /></p>

<p>æ ¹æ®æ“ä½œçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°† JUC åŒ…ä¸­çš„åŸå­ç±»åˆ†ä¸º 4 ç±»ï¼š</p>

<p><strong>1ã€åŸºæœ¬ç±»å‹</strong></p>

<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicInteger</code>ï¼šæ•´å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLong</code>ï¼šé•¿æ•´å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicBoolean</code>ï¼šå¸ƒå°”å‹åŸå­ç±»</li>
</ul>

<p><strong>2ã€æ•°ç»„ç±»å‹</strong></p>

<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ </p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicIntegerArray</code>ï¼šæ•´å‹æ•°ç»„åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLongArray</code>ï¼šé•¿æ•´å‹æ•°ç»„åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicReferenceArray</code>ï¼šå¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li>
</ul>

<p><strong>3ã€å¼•ç”¨ç±»å‹</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicReference</code>ï¼šå¼•ç”¨ç±»å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicMarkableReference</code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°† boolean æ ‡è®°ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œ<del>ä¹Ÿå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜</del>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicStampedReference</code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚</li>
</ul>

<p><strong>ğŸ› ä¿®æ­£ï¼ˆå‚è§ï¼š<a href="https://github.com/Snailclimb/JavaGuide/issues/626">issue#626</a>ï¼‰</strong> : <code class="language-plaintext highlighter-rouge">AtomicMarkableReference</code> ä¸èƒ½è§£å†³ ABA é—®é¢˜ã€‚</p>

<p><strong>4ã€å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicIntegerFieldUpdater</code>:åŸå­æ›´æ–°æ•´å‹å­—æ®µçš„æ›´æ–°å™¨</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLongFieldUpdater</code>ï¼šåŸå­æ›´æ–°é•¿æ•´å‹å­—æ®µçš„æ›´æ–°å™¨</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicReferenceFieldUpdater</code>ï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µ</li>
</ul>

<h2 id="åŸºæœ¬ç±»å‹åŸå­ç±»">åŸºæœ¬ç±»å‹åŸå­ç±»</h2>

<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°åŸºæœ¬ç±»å‹</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicInteger</code>ï¼šæ•´å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLong</code>ï¼šé•¿æ•´å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicBoolean</code>ï¼šå¸ƒå°”å‹åŸå­ç±»</li>
</ul>

<p>ä¸Šé¢ä¸‰ä¸ªç±»æä¾›çš„æ–¹æ³•å‡ ä¹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»¥ <code class="language-plaintext highlighter-rouge">AtomicInteger</code> ä¸ºä¾‹å­æ¥ä»‹ç»ã€‚</p>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicInteger</code> ç±»å¸¸ç”¨æ–¹æ³•</strong> ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">get</span><span class="o">()</span> <span class="c1">//è·å–å½“å‰çš„å€¼</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span><span class="c1">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è®¾ç½®æ–°çš„å€¼</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndIncrement</span><span class="o">()</span><span class="c1">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå¢</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndDecrement</span><span class="o">()</span> <span class="c1">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶è‡ªå‡</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">delta</span><span class="o">)</span> <span class="c1">//è·å–å½“å‰çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span>
<span class="kt">boolean</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">expect</span><span class="o">,</span> <span class="kt">int</span> <span class="n">update</span><span class="o">)</span> <span class="c1">//å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">lazySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span><span class="c1">//æœ€ç»ˆè®¾ç½®ä¸ºnewValue, lazySet æä¾›äº†ä¸€ç§æ¯” set æ–¹æ³•æ›´å¼±çš„è¯­ä¹‰ï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ï¼Œä½†å¯èƒ½æ›´é«˜æ•ˆã€‚</span>
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicInteger</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆå§‹åŒ– AtomicInteger å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º 0</span>
<span class="nc">AtomicInteger</span> <span class="n">atomicInt</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

<span class="c1">// ä½¿ç”¨ getAndSet æ–¹æ³•è·å–å½“å‰å€¼ï¼Œå¹¶è®¾ç½®æ–°å€¼ä¸º 3</span>
<span class="kt">int</span> <span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicInt</span><span class="o">.</span><span class="na">getAndSet</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"tempValue: "</span> <span class="o">+</span> <span class="n">tempValue</span> <span class="o">+</span> <span class="s">"; atomicInt: "</span> <span class="o">+</span> <span class="n">atomicInt</span><span class="o">);</span>

<span class="c1">// ä½¿ç”¨ getAndIncrement æ–¹æ³•è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå¢ 1</span>
<span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicInt</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"tempValue: "</span> <span class="o">+</span> <span class="n">tempValue</span> <span class="o">+</span> <span class="s">"; atomicInt: "</span> <span class="o">+</span> <span class="n">atomicInt</span><span class="o">);</span>

<span class="c1">// ä½¿ç”¨ getAndAdd æ–¹æ³•è·å–å½“å‰å€¼ï¼Œå¹¶å¢åŠ æŒ‡å®šå€¼ 5</span>
<span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicInt</span><span class="o">.</span><span class="na">getAndAdd</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"tempValue: "</span> <span class="o">+</span> <span class="n">tempValue</span> <span class="o">+</span> <span class="s">"; atomicInt: "</span> <span class="o">+</span> <span class="n">atomicInt</span><span class="o">);</span>

<span class="c1">// ä½¿ç”¨ compareAndSet æ–¹æ³•è¿›è¡ŒåŸå­æ€§æ¡ä»¶æ›´æ–°ï¼ŒæœŸæœ›å€¼ä¸º 9ï¼Œæ›´æ–°å€¼ä¸º 10</span>
<span class="kt">boolean</span> <span class="n">updateSuccess</span> <span class="o">=</span> <span class="n">atomicInt</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Update Success: "</span> <span class="o">+</span> <span class="n">updateSuccess</span> <span class="o">+</span> <span class="s">"; atomicInt: "</span> <span class="o">+</span> <span class="n">atomicInt</span><span class="o">);</span>

<span class="c1">// è·å–å½“å‰å€¼</span>
<span class="kt">int</span> <span class="n">currentValue</span> <span class="o">=</span> <span class="n">atomicInt</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Current value: "</span> <span class="o">+</span> <span class="n">currentValue</span><span class="o">);</span>

<span class="c1">// ä½¿ç”¨ lazySet æ–¹æ³•è®¾ç½®æ–°å€¼ä¸º 15</span>
<span class="n">atomicInt</span><span class="o">.</span><span class="na">lazySet</span><span class="o">(</span><span class="mi">15</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After lazySet, atomicInt: "</span> <span class="o">+</span> <span class="n">atomicInt</span><span class="o">);</span>
</code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">tempValue:</span> <span class="mi">0</span><span class="o">;</span> <span class="nl">atomicInt:</span> <span class="mi">3</span>
<span class="nl">tempValue:</span> <span class="mi">3</span><span class="o">;</span> <span class="nl">atomicInt:</span> <span class="mi">4</span>
<span class="nl">tempValue:</span> <span class="mi">4</span><span class="o">;</span> <span class="nl">atomicInt:</span> <span class="mi">9</span>
<span class="nc">Update</span> <span class="nl">Success:</span> <span class="kc">true</span><span class="o">;</span> <span class="nl">atomicInt:</span> <span class="mi">10</span>
<span class="nc">Current</span> <span class="nl">value:</span> <span class="mi">10</span>
<span class="nc">After</span> <span class="n">lazySet</span><span class="o">,</span> <span class="nl">atomicInt:</span> <span class="mi">15</span>
</code></pre></div></div>

<h2 id="æ•°ç»„ç±»å‹åŸå­ç±»">æ•°ç»„ç±»å‹åŸå­ç±»</h2>

<p>ä½¿ç”¨åŸå­çš„æ–¹å¼æ›´æ–°æ•°ç»„é‡Œçš„æŸä¸ªå…ƒç´ </p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicIntegerArray</code>ï¼šæ•´å½¢æ•°ç»„åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLongArray</code>ï¼šé•¿æ•´å½¢æ•°ç»„åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicReferenceArray</code>ï¼šå¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li>
</ul>

<p>ä¸Šé¢ä¸‰ä¸ªç±»æä¾›çš„æ–¹æ³•å‡ ä¹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»¥ <code class="language-plaintext highlighter-rouge">AtomicIntegerArray</code> ä¸ºä¾‹å­æ¥ä»‹ç»ã€‚</p>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicIntegerArray</code> ç±»å¸¸ç”¨æ–¹æ³•</strong>ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="c1">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span><span class="c1">//è¿”å› index=i ä½ç½®çš„å½“å‰çš„å€¼ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ–°å€¼ï¼šnewValue</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndIncrement</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span><span class="c1">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå¢</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndDecrement</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="c1">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶è®©è¯¥ä½ç½®çš„å…ƒç´ è‡ªå‡</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">delta</span><span class="o">)</span> <span class="c1">//è·å– index=i ä½ç½®å…ƒç´ çš„å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸçš„å€¼</span>
<span class="kt">boolean</span> <span class="nf">compareAndSet</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">expect</span><span class="o">,</span> <span class="kt">int</span> <span class="n">update</span><span class="o">)</span> <span class="c1">//å¦‚æœè¾“å…¥çš„æ•°å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°† index=i ä½ç½®çš„å…ƒç´ å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ï¼ˆupdateï¼‰</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">lazySet</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span><span class="c1">//æœ€ç»ˆ å°†index=i ä½ç½®çš„å…ƒç´ è®¾ç½®ä¸ºnewValue,ä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚</span>
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicIntegerArray</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span><span class="o">[]</span> <span class="n">nums</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">};</span>
<span class="c1">// åˆ›å»º AtomicIntegerArray</span>
<span class="nc">AtomicIntegerArray</span> <span class="n">atomicArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicIntegerArray</span><span class="o">(</span><span class="n">nums</span><span class="o">);</span>

<span class="c1">// æ‰“å° AtomicIntegerArray ä¸­çš„åˆå§‹å€¼</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Initial values in AtomicIntegerArray:"</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Index "</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// ä½¿ç”¨ getAndSet æ–¹æ³•å°†ç´¢å¼• 0 å¤„çš„å€¼è®¾ç½®ä¸º 2ï¼Œå¹¶è¿”å›æ—§å€¼</span>
<span class="kt">int</span> <span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">getAndSet</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\nAfter getAndSet(0, 2):"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returned value: "</span> <span class="o">+</span> <span class="n">tempValue</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Index "</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// ä½¿ç”¨ getAndIncrement æ–¹æ³•å°†ç´¢å¼• 0 å¤„çš„å€¼åŠ  1ï¼Œå¹¶è¿”å›æ—§å€¼</span>
<span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\nAfter getAndIncrement(0):"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returned value: "</span> <span class="o">+</span> <span class="n">tempValue</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Index "</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// ä½¿ç”¨ getAndAdd æ–¹æ³•å°†ç´¢å¼• 0 å¤„çš„å€¼å¢åŠ  5ï¼Œå¹¶è¿”å›æ—§å€¼</span>
<span class="n">tempValue</span> <span class="o">=</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">getAndAdd</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\nAfter getAndAdd(0, 5):"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Returned value: "</span> <span class="o">+</span> <span class="n">tempValue</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Index "</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">atomicArray</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<pre><code class="language-plain">Initial values in AtomicIntegerArray:
Index 0: 1 Index 1: 2 Index 2: 3 Index 3: 4 Index 4: 5 Index 5: 6
After getAndSet(0, 2):
Returned value: 1
Index 0: 2 Index 1: 2 Index 2: 3 Index 3: 4 Index 4: 5 Index 5: 6
After getAndIncrement(0):
Returned value: 2
Index 0: 3 Index 1: 2 Index 2: 3 Index 3: 4 Index 4: 5 Index 5: 6
After getAndAdd(0, 5):
Returned value: 3
Index 0: 8 Index 1: 2 Index 2: 3 Index 3: 4 Index 4: 5 Index 5: 6
</code></pre>

<h2 id="å¼•ç”¨ç±»å‹åŸå­ç±»">å¼•ç”¨ç±»å‹åŸå­ç±»</h2>

<p>åŸºæœ¬ç±»å‹åŸå­ç±»åªèƒ½æ›´æ–°ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœéœ€è¦åŸå­æ›´æ–°å¤šä¸ªå˜é‡ï¼Œéœ€è¦ä½¿ç”¨ å¼•ç”¨ç±»å‹åŸå­ç±»ã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicReference</code>ï¼šå¼•ç”¨ç±»å‹åŸå­ç±»</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicStampedReference</code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°†æ•´æ•°å€¼ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œå¯ç”¨äºè§£å†³åŸå­çš„æ›´æ–°æ•°æ®å’Œæ•°æ®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicMarkableReference</code>ï¼šåŸå­æ›´æ–°å¸¦æœ‰æ ‡è®°çš„å¼•ç”¨ç±»å‹ã€‚è¯¥ç±»å°† boolean æ ‡è®°ä¸å¼•ç”¨å…³è”èµ·æ¥ï¼Œ<del>ä¹Ÿå¯ä»¥è§£å†³ä½¿ç”¨ CAS è¿›è¡ŒåŸå­æ›´æ–°æ—¶å¯èƒ½å‡ºç°çš„ ABA é—®é¢˜ã€‚</del></li>
</ul>

<p>ä¸Šé¢ä¸‰ä¸ªç±»æä¾›çš„æ–¹æ³•å‡ ä¹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»¥ <code class="language-plaintext highlighter-rouge">AtomicReference</code> ä¸ºä¾‹å­æ¥ä»‹ç»ã€‚</p>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicReference</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Person ç±»</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    <span class="c1">//çœç•¥getter/setterå’ŒtoString</span>
<span class="o">}</span>


<span class="c1">// åˆ›å»º AtomicReference å¯¹è±¡å¹¶è®¾ç½®åˆå§‹å€¼</span>
<span class="nc">AtomicReference</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">ar</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicReference</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"SnailClimb"</span><span class="o">,</span> <span class="mi">22</span><span class="o">));</span>

<span class="c1">// æ‰“å°åˆå§‹å€¼</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Initial Person: "</span> <span class="o">+</span> <span class="n">ar</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>

<span class="c1">// æ›´æ–°å€¼</span>
<span class="nc">Person</span> <span class="n">updatePerson</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"Daisy"</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
<span class="n">ar</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">ar</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">updatePerson</span><span class="o">);</span>

<span class="c1">// æ‰“å°æ›´æ–°åçš„å€¼</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Updated Person: "</span> <span class="o">+</span> <span class="n">ar</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>

<span class="c1">// å°è¯•å†æ¬¡æ›´æ–°</span>
<span class="nc">Person</span> <span class="n">anotherUpdatePerson</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"John"</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span>
<span class="kt">boolean</span> <span class="n">isUpdated</span> <span class="o">=</span> <span class="n">ar</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">updatePerson</span><span class="o">,</span> <span class="n">anotherUpdatePerson</span><span class="o">);</span>

<span class="c1">// æ‰“å°æ˜¯å¦æ›´æ–°æˆåŠŸåŠæœ€ç»ˆå€¼</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Second Update Success: "</span> <span class="o">+</span> <span class="n">isUpdated</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Final Person: "</span> <span class="o">+</span> <span class="n">ar</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
</code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<pre><code class="language-plain">Initial Person: Person{name='SnailClimb', age=22}
Updated Person: Person{name='Daisy', age=20}
Second Update Success: true
Final Person: Person{name='John', age=30}
</code></pre>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicStampedReference</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆ›å»ºä¸€ä¸ª AtomicStampedReference å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º "SnailClimb"ï¼Œåˆå§‹ç‰ˆæœ¬å·ä¸º 1</span>
<span class="nc">AtomicStampedReference</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">asr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicStampedReference</span><span class="o">&lt;&gt;(</span><span class="s">"SnailClimb"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

<span class="c1">// æ‰“å°åˆå§‹å€¼å’Œç‰ˆæœ¬å·</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">initialStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">initialRef</span> <span class="o">=</span> <span class="n">asr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">initialStamp</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Initial Reference: "</span> <span class="o">+</span> <span class="n">initialRef</span> <span class="o">+</span> <span class="s">", Initial Stamp: "</span> <span class="o">+</span> <span class="n">initialStamp</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>

<span class="c1">// æ›´æ–°å€¼å’Œç‰ˆæœ¬å·</span>
<span class="kt">int</span> <span class="n">oldStamp</span> <span class="o">=</span> <span class="n">initialStamp</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">oldRef</span> <span class="o">=</span> <span class="n">initialRef</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">newRef</span> <span class="o">=</span> <span class="s">"Daisy"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">newStamp</span> <span class="o">=</span> <span class="n">oldStamp</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>

<span class="kt">boolean</span> <span class="n">isUpdated</span> <span class="o">=</span> <span class="n">asr</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">oldRef</span><span class="o">,</span> <span class="n">newRef</span><span class="o">,</span> <span class="n">oldStamp</span><span class="o">,</span> <span class="n">newStamp</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Update Success: "</span> <span class="o">+</span> <span class="n">isUpdated</span><span class="o">);</span>

<span class="c1">// æ‰“å°æ›´æ–°åçš„å€¼å’Œç‰ˆæœ¬å·</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">updatedStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">updatedRef</span> <span class="o">=</span> <span class="n">asr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">updatedStamp</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Updated Reference: "</span> <span class="o">+</span> <span class="n">updatedRef</span> <span class="o">+</span> <span class="s">", Updated Stamp: "</span> <span class="o">+</span> <span class="n">updatedStamp</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>

<span class="c1">// å°è¯•ç”¨é”™è¯¯çš„ç‰ˆæœ¬å·æ›´æ–°</span>
<span class="kt">boolean</span> <span class="n">isUpdatedWithWrongStamp</span> <span class="o">=</span> <span class="n">asr</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">newRef</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="n">oldStamp</span><span class="o">,</span> <span class="n">newStamp</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Update with Wrong Stamp Success: "</span> <span class="o">+</span> <span class="n">isUpdatedWithWrongStamp</span><span class="o">);</span>

<span class="c1">// æ‰“å°æœ€ç»ˆçš„å€¼å’Œç‰ˆæœ¬å·</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">finalStamp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">finalRef</span> <span class="o">=</span> <span class="n">asr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">finalStamp</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Final Reference: "</span> <span class="o">+</span> <span class="n">finalRef</span> <span class="o">+</span> <span class="s">", Final Stamp: "</span> <span class="o">+</span> <span class="n">finalStamp</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</code></pre></div></div>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code class="language-plain">Initial Reference: SnailClimb, Initial Stamp: 1
Update Success: true
Updated Reference: Daisy, Updated Stamp: 2
Update with Wrong Stamp Success: false
Final Reference: Daisy, Final Stamp: 2
</code></pre>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicMarkableReference</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆ›å»ºä¸€ä¸ª AtomicMarkableReference å¯¹è±¡ï¼Œåˆå§‹å€¼ä¸º "SnailClimb"ï¼Œåˆå§‹æ ‡è®°ä¸º false</span>
<span class="nc">AtomicMarkableReference</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">amr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicMarkableReference</span><span class="o">&lt;&gt;(</span><span class="s">"SnailClimb"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

<span class="c1">// æ‰“å°åˆå§‹å€¼å’Œæ ‡è®°</span>
<span class="kt">boolean</span><span class="o">[]</span> <span class="n">initialMark</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">initialRef</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">initialMark</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Initial Reference: "</span> <span class="o">+</span> <span class="n">initialRef</span> <span class="o">+</span> <span class="s">", Initial Mark: "</span> <span class="o">+</span> <span class="n">initialMark</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>

<span class="c1">// æ›´æ–°å€¼å’Œæ ‡è®°</span>
<span class="nc">String</span> <span class="n">oldRef</span> <span class="o">=</span> <span class="n">initialRef</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">newRef</span> <span class="o">=</span> <span class="s">"Daisy"</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">oldMark</span> <span class="o">=</span> <span class="n">initialMark</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="kt">boolean</span> <span class="n">newMark</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

<span class="kt">boolean</span> <span class="n">isUpdated</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">oldRef</span><span class="o">,</span> <span class="n">newRef</span><span class="o">,</span> <span class="n">oldMark</span><span class="o">,</span> <span class="n">newMark</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Update Success: "</span> <span class="o">+</span> <span class="n">isUpdated</span><span class="o">);</span>

<span class="c1">// æ‰“å°æ›´æ–°åçš„å€¼å’Œæ ‡è®°</span>
<span class="kt">boolean</span><span class="o">[]</span> <span class="n">updatedMark</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">updatedRef</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">updatedMark</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Updated Reference: "</span> <span class="o">+</span> <span class="n">updatedRef</span> <span class="o">+</span> <span class="s">", Updated Mark: "</span> <span class="o">+</span> <span class="n">updatedMark</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>

<span class="c1">// å°è¯•ç”¨é”™è¯¯çš„æ ‡è®°æ›´æ–°</span>
<span class="kt">boolean</span> <span class="n">isUpdatedWithWrongMark</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">newRef</span><span class="o">,</span> <span class="s">"John"</span><span class="o">,</span> <span class="n">oldMark</span><span class="o">,</span> <span class="o">!</span><span class="n">newMark</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Update with Wrong Mark Success: "</span> <span class="o">+</span> <span class="n">isUpdatedWithWrongMark</span><span class="o">);</span>

<span class="c1">// æ‰“å°æœ€ç»ˆçš„å€¼å’Œæ ‡è®°</span>
<span class="kt">boolean</span><span class="o">[]</span> <span class="n">finalMark</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">boolean</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
<span class="nc">String</span> <span class="n">finalRef</span> <span class="o">=</span> <span class="n">amr</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">finalMark</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Final Reference: "</span> <span class="o">+</span> <span class="n">finalRef</span> <span class="o">+</span> <span class="s">", Final Mark: "</span> <span class="o">+</span> <span class="n">finalMark</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</code></pre></div></div>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code class="language-plain">Initial Reference: SnailClimb, Initial Mark: false
Update Success: true
Updated Reference: Daisy, Updated Mark: true
Update with Wrong Mark Success: false
Final Reference: Daisy, Final Mark: true
</code></pre>

<h2 id="å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»">å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»</h2>

<p>å¦‚æœéœ€è¦åŸå­æ›´æ–°æŸä¸ªç±»é‡Œçš„æŸä¸ªå­—æ®µæ—¶ï¼Œéœ€è¦ç”¨åˆ°å¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»ã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">AtomicIntegerFieldUpdater</code>:åŸå­æ›´æ–°æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicLongFieldUpdater</code>ï¼šåŸå­æ›´æ–°é•¿æ•´å½¢å­—æ®µçš„æ›´æ–°å™¨</li>
  <li><code class="language-plaintext highlighter-rouge">AtomicReferenceFieldUpdater</code>ï¼šåŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µçš„æ›´æ–°å™¨</li>
</ul>

<p>è¦æƒ³åŸå­åœ°æ›´æ–°å¯¹è±¡çš„å±æ€§éœ€è¦ä¸¤æ­¥ã€‚ç¬¬ä¸€æ­¥ï¼Œå› ä¸ºå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³• newUpdater()åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ã€‚ç¬¬äºŒæ­¥ï¼Œæ›´æ–°çš„å¯¹è±¡å±æ€§å¿…é¡»ä½¿ç”¨ public volatile ä¿®é¥°ç¬¦ã€‚</p>

<p>ä¸Šé¢ä¸‰ä¸ªç±»æä¾›çš„æ–¹æ³•å‡ ä¹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä»¥ <code class="language-plaintext highlighter-rouge">AtomicIntegerFieldUpdater</code>ä¸ºä¾‹å­æ¥ä»‹ç»ã€‚</p>

<p><strong><code class="language-plaintext highlighter-rouge">AtomicIntegerFieldUpdater</code> ç±»ä½¿ç”¨ç¤ºä¾‹</strong> :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Person ç±»</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// è¦ä½¿ç”¨ AtomicIntegerFieldUpdaterï¼Œå­—æ®µå¿…é¡»æ˜¯ public volatile</span>
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
    <span class="c1">//çœç•¥getter/setterå’ŒtoString</span>
<span class="o">}</span>

<span class="c1">// åˆ›å»º AtomicIntegerFieldUpdater å¯¹è±¡</span>
<span class="nc">AtomicIntegerFieldUpdater</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">ageUpdater</span> <span class="o">=</span> <span class="nc">AtomicIntegerFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"age"</span><span class="o">);</span>

<span class="c1">// åˆ›å»º Person å¯¹è±¡</span>
<span class="nc">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"SnailClimb"</span><span class="o">,</span> <span class="mi">22</span><span class="o">);</span>

<span class="c1">// æ‰“å°åˆå§‹å€¼</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Initial Person: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>

<span class="c1">// æ›´æ–° age å­—æ®µ</span>
<span class="n">ageUpdater</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">(</span><span class="n">person</span><span class="o">);</span> <span class="c1">// è‡ªå¢</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After Increment: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>

<span class="n">ageUpdater</span><span class="o">.</span><span class="na">addAndGet</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span> <span class="c1">// å¢åŠ  5</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After Adding 5: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>

<span class="n">ageUpdater</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span> <span class="c1">// å¦‚æœå½“å‰å€¼æ˜¯ 28ï¼Œåˆ™è®¾ç½®ä¸º 30</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After Compare and Set (28 to 30): "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>

<span class="c1">// å°è¯•ä½¿ç”¨é”™è¯¯çš„æ¯”è¾ƒå€¼è¿›è¡Œæ›´æ–°</span>
<span class="kt">boolean</span> <span class="n">isUpdated</span> <span class="o">=</span> <span class="n">ageUpdater</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">person</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="mi">35</span><span class="o">);</span> <span class="c1">// è¿™æ¬¡åº”è¯¥å¤±è´¥</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Compare and Set (28 to 35) Success: "</span> <span class="o">+</span> <span class="n">isUpdated</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Final Person: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>
</code></pre></div></div>

<p>è¾“å‡ºç»“æœï¼š</p>

<pre><code class="language-plain">Initial Person: Name: SnailClimb, Age: 22
After Increment: Name: SnailClimb, Age: 23
After Adding 5: Name: SnailClimb, Age: 28
After Compare and Set (28 to 30): Name: SnailClimb, Age: 30
Compare and Set (28 to 35) Success: false
Final Person: Name: SnailClimb, Age: 30
</code></pre>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li>ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</li>
</ul>

<!-- @include: @article-footer.snippet.md -->
