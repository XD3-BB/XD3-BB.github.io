<p>这篇文章我根据《阿里巴巴 Java 开发手册》总结了关于集合使用常见的注意事项以及其具体原理。</p>

<p>强烈建议小伙伴们多多阅读几遍，避免自己写代码的时候出现这些低级的问题。</p>

<h2 id="集合判空">集合判空</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>判断所有集合内部的元素是否为空，使用 <code class="language-plaintext highlighter-rouge">isEmpty()</code> 方法，而不是 <code class="language-plaintext highlighter-rouge">size()==0</code> 的方式。</strong></p>
</blockquote>

<p>这是因为 <code class="language-plaintext highlighter-rouge">isEmpty()</code> 方法的可读性更好，并且时间复杂度为 O(1)。</p>

<p>绝大部分我们使用的集合的 <code class="language-plaintext highlighter-rouge">size()</code> 方法的时间复杂度也是 O(1)，不过，也有很多复杂度不是 O(1) 的，比如 <code class="language-plaintext highlighter-rouge">java.util.concurrent</code> 包下的某些集合（<code class="language-plaintext highlighter-rouge">ConcurrentLinkedQueue</code>、<code class="language-plaintext highlighter-rouge">ConcurrentHashMap</code>…）。</p>

<p>下面是 <code class="language-plaintext highlighter-rouge">ConcurrentHashMap</code> 的 <code class="language-plaintext highlighter-rouge">size()</code> 方法和 <code class="language-plaintext highlighter-rouge">isEmpty()</code> 方法的源码。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="n">sumCount</span><span class="o">();</span>
    <span class="k">return</span> <span class="o">((</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0L</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span>
            <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span><span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">)</span> <span class="o">?</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span> <span class="o">:</span>
            <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">n</span><span class="o">);</span>
<span class="o">}</span>
<span class="kd">final</span> <span class="kt">long</span> <span class="nf">sumCount</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">CounterCell</span><span class="o">[]</span> <span class="n">as</span> <span class="o">=</span> <span class="n">counterCells</span><span class="o">;</span> <span class="nc">CounterCell</span> <span class="n">a</span><span class="o">;</span>
    <span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">baseCount</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">as</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">as</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">((</span><span class="n">a</span> <span class="o">=</span> <span class="n">as</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                <span class="n">sum</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">sumCount</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">0L</span><span class="o">;</span> <span class="c1">// ignore transient negative values</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="集合转-map">集合转 Map</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>在使用 <code class="language-plaintext highlighter-rouge">java.util.stream.Collectors</code> 类的 <code class="language-plaintext highlighter-rouge">toMap()</code> 方法转为 <code class="language-plaintext highlighter-rouge">Map</code> 集合时，一定要注意当 value 为 null 时会抛 NPE 异常。</strong></p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phoneNumber</span><span class="o">;</span>
     <span class="c1">// getters and setters</span>
<span class="o">}</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Person</span><span class="o">&gt;</span> <span class="n">bookList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">bookList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"jack"</span><span class="o">,</span><span class="s">"18163138123"</span><span class="o">));</span>
<span class="n">bookList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"martin"</span><span class="o">,</span><span class="kc">null</span><span class="o">));</span>
<span class="c1">// 空指针异常</span>
<span class="n">bookList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toMap</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getName</span><span class="o">,</span> <span class="nl">Person:</span><span class="o">:</span><span class="n">getPhoneNumber</span><span class="o">));</span>
</code></pre></div></div>

<p>下面我们来解释一下原因。</p>

<p>首先，我们来看 <code class="language-plaintext highlighter-rouge">java.util.stream.Collectors</code> 类的 <code class="language-plaintext highlighter-rouge">toMap()</code> 方法 ，可以看到其内部调用了 <code class="language-plaintext highlighter-rouge">Map</code> 接口的 <code class="language-plaintext highlighter-rouge">merge()</code> 方法。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="no">K</span><span class="o">,</span> <span class="no">U</span><span class="o">,</span> <span class="no">M</span> <span class="kd">extends</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="no">K</span><span class="o">,</span> <span class="no">U</span><span class="o">&gt;&gt;</span>
<span class="nc">Collector</span><span class="o">&lt;</span><span class="no">T</span><span class="o">,</span> <span class="o">?,</span> <span class="no">M</span><span class="o">&gt;</span> <span class="nf">toMap</span><span class="o">(</span><span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">K</span><span class="o">&gt;</span> <span class="n">keyMapper</span><span class="o">,</span>
                            <span class="nc">Function</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">T</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">U</span><span class="o">&gt;</span> <span class="n">valueMapper</span><span class="o">,</span>
                            <span class="nc">BinaryOperator</span><span class="o">&lt;</span><span class="no">U</span><span class="o">&gt;</span> <span class="n">mergeFunction</span><span class="o">,</span>
                            <span class="nc">Supplier</span><span class="o">&lt;</span><span class="no">M</span><span class="o">&gt;</span> <span class="n">mapSupplier</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">BiConsumer</span><span class="o">&lt;</span><span class="no">M</span><span class="o">,</span> <span class="no">T</span><span class="o">&gt;</span> <span class="n">accumulator</span>
            <span class="o">=</span> <span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">map</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">keyMapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">element</span><span class="o">),</span>
                                          <span class="n">valueMapper</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">element</span><span class="o">),</span> <span class="n">mergeFunction</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">CollectorImpl</span><span class="o">&lt;&gt;(</span><span class="n">mapSupplier</span><span class="o">,</span> <span class="n">accumulator</span><span class="o">,</span> <span class="n">mapMerger</span><span class="o">(</span><span class="n">mergeFunction</span><span class="o">),</span> <span class="no">CH_ID</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Map</code> 接口的 <code class="language-plaintext highlighter-rouge">merge()</code> 方法如下，这个方法是接口中的默认实现。</p>

<blockquote>
  <p>如果你还不了解 Java 8 新特性的话，请看这篇文章：<a href="https://mp.weixin.qq.com/s/ojyl7B6PiHaTWADqmUq2rw">《Java8 新特性总结》</a> 。</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">default</span> <span class="no">V</span> <span class="nf">merge</span><span class="o">(</span><span class="no">K</span> <span class="n">key</span><span class="o">,</span> <span class="no">V</span> <span class="n">value</span><span class="o">,</span>
        <span class="nc">BiFunction</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">V</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="no">V</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="no">V</span><span class="o">&gt;</span> <span class="n">remappingFunction</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">remappingFunction</span><span class="o">);</span>
    <span class="nc">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="no">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="no">V</span> <span class="n">newValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">oldValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">value</span> <span class="o">:</span>
               <span class="n">remappingFunction</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">oldValue</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">newValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">remove</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">newValue</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">newValue</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">merge()</code> 方法会先调用 <code class="language-plaintext highlighter-rouge">Objects.requireNonNull()</code> 方法判断 value 是否为空。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">requireNonNull</span><span class="o">(</span><span class="no">T</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullPointerException</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="集合遍历">集合遍历</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>不要在 foreach 循环里进行元素的 <code class="language-plaintext highlighter-rouge">remove/add</code> 操作。remove 元素请使用 <code class="language-plaintext highlighter-rouge">Iterator</code> 方式，如果并发操作，需要对 <code class="language-plaintext highlighter-rouge">Iterator</code> 对象加锁。</strong></p>
</blockquote>

<p>通过反编译你会发现 foreach 语法底层其实还是依赖 <code class="language-plaintext highlighter-rouge">Iterator</code> 。不过， <code class="language-plaintext highlighter-rouge">remove/add</code> 操作直接调用的是集合自己的方法，而不是 <code class="language-plaintext highlighter-rouge">Iterator</code> 的 <code class="language-plaintext highlighter-rouge">remove/add</code>方法</p>

<p>这就导致 <code class="language-plaintext highlighter-rouge">Iterator</code> 莫名其妙地发现自己有元素被 <code class="language-plaintext highlighter-rouge">remove/add</code> ，然后，它就会抛出一个 <code class="language-plaintext highlighter-rouge">ConcurrentModificationException</code> 来提示用户发生了并发修改异常。这就是单线程状态下产生的 <strong>fail-fast 机制</strong>。</p>

<blockquote>
  <p><strong>fail-fast 机制</strong>：多个线程对 fail-fast 集合进行修改的时候，可能会抛出<code class="language-plaintext highlighter-rouge">ConcurrentModificationException</code>。 即使是单线程下也有可能会出现这种情况，上面已经提到过。</p>

  <p>相关阅读：<a href="https://www.cnblogs.com/54chensongxia/p/12470446.html">什么是 fail-fast</a> 。</p>
</blockquote>

<p>Java8 开始，可以使用 <code class="language-plaintext highlighter-rouge">Collection#removeIf()</code>方法删除满足特定条件的元素,如</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">list</span><span class="o">.</span><span class="na">removeIf</span><span class="o">(</span><span class="n">filter</span> <span class="o">-&gt;</span> <span class="n">filter</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">);</span> <span class="cm">/* 删除list中的所有偶数 */</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span> <span class="cm">/* [1, 3, 5, 7, 9] */</span>
</code></pre></div></div>

<p>除了上面介绍的直接使用 <code class="language-plaintext highlighter-rouge">Iterator</code> 进行遍历操作之外，你还可以：</p>

<ul>
  <li>使用普通的 for 循环</li>
  <li>使用 fail-safe 的集合类。<code class="language-plaintext highlighter-rouge">java.util</code>包下面的所有的集合类都是 fail-fast 的，而<code class="language-plaintext highlighter-rouge">java.util.concurrent</code>包下面的所有的类都是 fail-safe 的。</li>
  <li>……</li>
</ul>

<h2 id="集合去重">集合去重</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>可以利用 <code class="language-plaintext highlighter-rouge">Set</code> 元素唯一的特性，可以快速对一个集合进行去重操作，避免使用 <code class="language-plaintext highlighter-rouge">List</code> 的 <code class="language-plaintext highlighter-rouge">contains()</code> 进行遍历去重或者判断包含操作。</strong></p>
</blockquote>

<p>这里我们以 <code class="language-plaintext highlighter-rouge">HashSet</code> 和 <code class="language-plaintext highlighter-rouge">ArrayList</code> 为例说明。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Set 去重代码示例</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">removeDuplicateBySet</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="nc">CollectionUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;(</span><span class="n">data</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// List 去重代码示例</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">removeDuplicateByList</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="nc">CollectionUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">data</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="o">}</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">data</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="no">T</span> <span class="n">current</span> <span class="o">:</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">current</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">current</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<p>两者的核心差别在于 <code class="language-plaintext highlighter-rouge">contains()</code> 方法的实现。</p>

<p><code class="language-plaintext highlighter-rouge">HashSet</code> 的 <code class="language-plaintext highlighter-rouge">contains()</code> 方法底部依赖的 <code class="language-plaintext highlighter-rouge">HashMap</code> 的 <code class="language-plaintext highlighter-rouge">containsKey()</code> 方法，时间复杂度接近于 O（1）（没有出现哈希冲突的时候为 O（1））。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">transient</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="no">E</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>我们有 N 个元素插入进 Set 中，那时间复杂度就接近是 O (n)。</p>

<p><code class="language-plaintext highlighter-rouge">ArrayList</code> 的 <code class="language-plaintext highlighter-rouge">contains()</code> 方法是通过遍历所有元素的方法来做的，时间复杂度接近是 O(n)。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">indexOf</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">indexOf</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">elementData</span><span class="o">[</span><span class="n">i</span><span class="o">]==</span><span class="kc">null</span><span class="o">)</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">elementData</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="集合转数组">集合转数组</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>使用集合转数组的方法，必须使用集合的 <code class="language-plaintext highlighter-rouge">toArray(T[] array)</code>，传入的是类型完全一致、长度为 0 的空数组。</strong></p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">toArray(T[] array)</code> 方法的参数是一个泛型数组，如果 <code class="language-plaintext highlighter-rouge">toArray</code> 方法中没有传递任何参数的话返回的是 <code class="language-plaintext highlighter-rouge">Object</code>类 型数组。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="o">[]</span> <span class="n">s</span><span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span>
    <span class="s">"dog"</span><span class="o">,</span> <span class="s">"lazy"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">,</span> <span class="s">"over"</span><span class="o">,</span> <span class="s">"jumps"</span><span class="o">,</span> <span class="s">"fox"</span><span class="o">,</span> <span class="s">"brown"</span><span class="o">,</span> <span class="s">"quick"</span><span class="o">,</span> <span class="s">"A"</span>
<span class="o">};</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
<span class="nc">Collections</span><span class="o">.</span><span class="na">reverse</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
<span class="c1">//没有指定类型的话会报错</span>
<span class="n">s</span><span class="o">=</span><span class="n">list</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</code></pre></div></div>

<p>由于 JVM 优化，<code class="language-plaintext highlighter-rouge">new String[0]</code>作为<code class="language-plaintext highlighter-rouge">Collection.toArray()</code>方法的参数现在使用更好，<code class="language-plaintext highlighter-rouge">new String[0]</code>就是起一个模板的作用，指定了返回数组的类型，0 是为了节省空间，因为它只是为了说明返回的类型。详见：<a href="https://shipilev.net/blog/2016/arrays-wisdom-ancients/">https://shipilev.net/blog/2016/arrays-wisdom-ancients/</a></p>

<h2 id="数组转集合">数组转集合</h2>

<p>《阿里巴巴 Java 开发手册》的描述如下：</p>

<blockquote>
  <p><strong>使用工具类 <code class="language-plaintext highlighter-rouge">Arrays.asList()</code> 把数组转换成集合时，不能使用其修改集合相关的方法， 它的 <code class="language-plaintext highlighter-rouge">add/remove/clear</code> 方法会抛出 <code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code> 异常。</strong></p>
</blockquote>

<p>我在之前的一个项目中就遇到一个类似的坑。</p>

<p><code class="language-plaintext highlighter-rouge">Arrays.asList()</code>在平时开发中还是比较常见的，我们可以使用它将一个数组转换为一个 <code class="language-plaintext highlighter-rouge">List</code> 集合。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span><span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span><span class="s">"Apple"</span><span class="o">,</span> <span class="s">"Banana"</span><span class="o">,</span> <span class="s">"Orange"</span><span class="o">};</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">myArray</span><span class="o">);</span>
<span class="c1">//上面两个语句等价于下面一条语句</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Apple"</span><span class="o">,</span><span class="s">"Banana"</span><span class="o">,</span> <span class="s">"Orange"</span><span class="o">);</span>
</code></pre></div></div>

<p>JDK 源码对于这个方法的说明：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
  *返回由指定数组支持的固定大小的列表。此方法作为基于数组和基于集合的API之间的桥梁，
  * 与 Collection.toArray()结合使用。返回的List是可序列化并实现RandomAccess接口。
  */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">asList</span><span class="o">(</span><span class="no">T</span><span class="o">...</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">a</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>下面我们来总结一下使用注意事项。</p>

<p><strong>1、<code class="language-plaintext highlighter-rouge">Arrays.asList()</code>是泛型方法，传递的数组必须是对象数组，而不是基本类型。</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span><span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="nc">List</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">myArray</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">size</span><span class="o">());</span><span class="c1">//1</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span><span class="c1">//数组地址值</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span><span class="c1">//报错：ArrayIndexOutOfBoundsException</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">[])</span> <span class="n">myList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">array</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span><span class="c1">//1</span>
</code></pre></div></div>

<p>当传入一个原生数据类型数组时，<code class="language-plaintext highlighter-rouge">Arrays.asList()</code> 的真正得到的参数就不是数组中的元素，而是数组对象本身！此时 <code class="language-plaintext highlighter-rouge">List</code> 的唯一元素就是这个数组，这也就解释了上面的代码。</p>

<p>我们使用包装类型数组就可以解决这个问题。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Integer</span><span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
</code></pre></div></div>

<p><strong>2、使用集合的修改方法: <code class="language-plaintext highlighter-rouge">add()</code>、<code class="language-plaintext highlighter-rouge">remove()</code>、<code class="language-plaintext highlighter-rouge">clear()</code>会抛出异常。</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
<span class="n">myList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span><span class="c1">//运行时报错：UnsupportedOperationException</span>
<span class="n">myList</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span><span class="c1">//运行时报错：UnsupportedOperationException</span>
<span class="n">myList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span><span class="c1">//运行时报错：UnsupportedOperationException</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Arrays.asList()</code> 方法返回的并不是 <code class="language-plaintext highlighter-rouge">java.util.ArrayList</code> ，而是 <code class="language-plaintext highlighter-rouge">java.util.Arrays</code> 的一个内部类,这个内部类并没有实现集合的修改方法或者说并没有重写这些方法。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//class java.util.Arrays$ArrayList</span>
</code></pre></div></div>

<p>下图是 <code class="language-plaintext highlighter-rouge">java.util.Arrays$ArrayList</code> 的简易源码，我们可以看到这个类重写的方法有哪些。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractList</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span>
        <span class="kd">implements</span> <span class="nc">RandomAccess</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
    <span class="o">{</span>
        <span class="o">...</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="no">E</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="no">E</span> <span class="nf">set</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="no">E</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">indexOf</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
           <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">forEach</span><span class="o">(</span><span class="nc">Consumer</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">replaceAll</span><span class="o">(</span><span class="nc">UnaryOperator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">operator</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sort</span><span class="o">(</span><span class="nc">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="no">E</span><span class="o">&gt;</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
          <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>我们再看一下<code class="language-plaintext highlighter-rouge">java.util.AbstractList</code>的 <code class="language-plaintext highlighter-rouge">add/remove/clear</code> 方法就知道为什么会抛出 <code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code> 了。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="no">E</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="no">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">add</span><span class="o">(</span><span class="n">size</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="no">E</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">UnsupportedOperationException</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">removeRange</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">());</span>
<span class="o">}</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">removeRange</span><span class="o">(</span><span class="kt">int</span> <span class="n">fromIndex</span><span class="o">,</span> <span class="kt">int</span> <span class="n">toIndex</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ListIterator</span><span class="o">&lt;</span><span class="no">E</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">listIterator</span><span class="o">(</span><span class="n">fromIndex</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span> <span class="n">n</span><span class="o">=</span><span class="n">toIndex</span><span class="o">-</span><span class="n">fromIndex</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="n">it</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>那我们如何正确的将数组转换为 <code class="language-plaintext highlighter-rouge">ArrayList</code> ?</strong></p>

<p>1、手动实现工具类</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//JDK1.5+</span>
<span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nf">arrayToList</span><span class="o">(</span><span class="kd">final</span> <span class="no">T</span><span class="o">[]</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;(</span><span class="n">array</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>

  <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="no">T</span> <span class="n">s</span> <span class="o">:</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">l</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">l</span><span class="o">;</span>
<span class="o">}</span>


<span class="nc">Integer</span> <span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">};</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arrayToList</span><span class="o">(</span><span class="n">myArray</span><span class="o">).</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//class java.util.ArrayList</span>
</code></pre></div></div>

<p>2、最简便的方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">))</span>
</code></pre></div></div>

<p>3、使用 Java8 的 <code class="language-plaintext highlighter-rouge">Stream</code>(推荐)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Integer</span> <span class="o">[]</span> <span class="n">myArray</span> <span class="o">=</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">};</span>
<span class="nc">List</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">myArray</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="c1">//基本类型也可以实现转换（依赖boxed的装箱操作）</span>
<span class="kt">int</span> <span class="o">[]</span> <span class="n">myArray2</span> <span class="o">=</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">};</span>
<span class="nc">List</span> <span class="n">myList</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">myArray2</span><span class="o">).</span><span class="na">boxed</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</code></pre></div></div>

<p>4、使用 Guava</p>

<p>对于不可变集合，你可以使用<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java"><code class="language-plaintext highlighter-rouge">ImmutableList</code></a>类及其<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java#L101"><code class="language-plaintext highlighter-rouge">of()</code></a>与<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableList.java#L225"><code class="language-plaintext highlighter-rouge">copyOf()</code></a>工厂方法：（参数不能为空）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">il</span> <span class="o">=</span> <span class="nc">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"string"</span><span class="o">,</span> <span class="s">"elements"</span><span class="o">);</span>  <span class="c1">// from varargs</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">il</span> <span class="o">=</span> <span class="nc">ImmutableList</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">aStringArray</span><span class="o">);</span>      <span class="c1">// from array</span>
</code></pre></div></div>

<p>对于可变集合，你可以使用<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/Lists.java"><code class="language-plaintext highlighter-rouge">Lists</code></a>类及其<a href="https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/Lists.java#L87"><code class="language-plaintext highlighter-rouge">newArrayList()</code></a>工厂方法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">l1</span> <span class="o">=</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="n">anotherListOrCollection</span><span class="o">);</span>    <span class="c1">// from collection</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">l2</span> <span class="o">=</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="n">aStringArray</span><span class="o">);</span>               <span class="c1">// from array</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">l3</span> <span class="o">=</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">(</span><span class="s">"or"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">,</span> <span class="s">"elements"</span><span class="o">);</span> <span class="c1">// from varargs</span>
</code></pre></div></div>

<p>5、使用 Apache Commons Collections</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span>
<span class="nc">CollectionUtils</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
</code></pre></div></div>

<p>6、 使用 Java9 的 <code class="language-plaintext highlighter-rouge">List.of()</code>方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Integer</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">array</span><span class="o">);</span>
</code></pre></div></div>

<!-- @include: @article-footer.snippet.md -->
