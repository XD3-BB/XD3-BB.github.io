<blockquote>
  <p>本文由 JavaGuide 翻译并完善，原文地址：<a href="https://medium.com/@AlexanderObregon/maven-best-practices-tips-and-tricks-for-java-developers-438eca03f72b">https://medium.com/@AlexanderObregon/maven-best-practices-tips-and-tricks-for-java-developers-438eca03f72b</a> 。</p>
</blockquote>

<p>Maven 是一种广泛使用的 Java 项目构建自动化工具。它简化了构建过程并帮助管理依赖关系，使开发人员的工作更轻松。Maven 详细介绍可以参考我写的这篇 <a href="./maven-core-concepts.md">Maven 核心概念总结</a> 。</p>

<p>这篇文章不会涉及到 Maven 概念的介绍，主要讨论一些最佳实践、建议和技巧，以优化我们在项目中对 Maven 的使用并改善我们的开发体验。</p>

<h2 id="maven-标准目录结构">Maven 标准目录结构</h2>

<p>Maven 遵循标准目录结构来保持项目之间的一致性。遵循这种结构可以让其他开发人员更轻松地理解我们的项目。</p>

<p>Maven 项目的标准目录结构如下：</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">src</span><span class="o">/</span>
  <span class="n">main</span><span class="o">/</span>
    <span class="n">java</span><span class="o">/</span>
    <span class="n">resources</span><span class="o">/</span>
  <span class="n">test</span><span class="o">/</span>
    <span class="n">java</span><span class="o">/</span>
    <span class="n">resources</span><span class="o">/</span>
<span class="n">pom</span><span class="o">.</span><span class="na">xml</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">src/main/java</code>：源代码目录</li>
  <li><code class="language-plaintext highlighter-rouge">src/main/resources</code>：资源文件目录</li>
  <li><code class="language-plaintext highlighter-rouge">src/test/java</code>：测试代码目录</li>
  <li><code class="language-plaintext highlighter-rouge">src/test/resources</code>：测试资源文件目录</li>
</ul>

<p>这只是一个最简单的 Maven 项目目录示例。实际项目中，我们还会根据项目规范去做进一步的细分。</p>

<h2 id="指定-maven-编译器插件">指定 Maven 编译器插件</h2>

<p>默认情况下，Maven 使用 Java5 编译我们的项目。要使用不同的 JDK 版本，请在 <code class="language-plaintext highlighter-rouge">pom.xml</code> 文件中配置 Maven 编译器插件。</p>

<p>例如，如果你想要使用 Java8 来编译你的项目，你可以在<code class="language-plaintext highlighter-rouge">&lt;build&gt;</code>标签下添加以下的代码片段：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
        <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<p>这样，Maven 就会使用 Java8 的编译器来编译你的项目。如果你想要使用其他版本的 JDK，你只需要修改<code class="language-plaintext highlighter-rouge">&lt;source&gt;</code>和<code class="language-plaintext highlighter-rouge">&lt;target&gt;</code>标签的值即可。例如，如果你想要使用 Java11，你可以将它们的值改为 11。</p>

<h2 id="有效管理依赖关系">有效管理依赖关系</h2>

<p>Maven 的依赖管理系统是其最强大的功能之一。在顶层 pom 文件中，通过标签 <code class="language-plaintext highlighter-rouge">dependencyManagement</code> 定义公共的依赖关系，这有助于避免冲突并确保所有模块使用相同版本的依赖项。</p>

<p>例如，假设我们有一个父模块和两个子模块 A 和 B，我们想要在所有模块中使用 JUnit 5.7.2 作为测试框架。我们可以在父模块的<code class="language-plaintext highlighter-rouge">pom.xml</code>文件中使用<code class="language-plaintext highlighter-rouge">&lt;dependencyManagement&gt;</code>标签来定义 JUnit 的版本：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>5.7.2<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>

<p>在子模块 A 和 B 的 <code class="language-plaintext highlighter-rouge">pom.xml</code> 文件中，我们只需要引用 JUnit 的 <code class="language-plaintext highlighter-rouge">groupId</code> 和 <code class="language-plaintext highlighter-rouge">artifactId</code> 即可:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.junit.jupiter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<h2 id="针对不同环境使用配置文件">针对不同环境使用配置文件</h2>

<p>Maven 配置文件允许我们配置不同环境的构建设置，例如开发、测试和生产。在 <code class="language-plaintext highlighter-rouge">pom.xml</code> 文件中定义配置文件并使用命令行参数激活它们：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;profiles&gt;</span>
  <span class="nt">&lt;profile&gt;</span>
    <span class="nt">&lt;id&gt;</span>development<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;activation&gt;</span>
      <span class="nt">&lt;activeByDefault&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
    <span class="nt">&lt;/activation&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;environment&gt;</span>dev<span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
  <span class="nt">&lt;/profile&gt;</span>
  <span class="nt">&lt;profile&gt;</span>
    <span class="nt">&lt;id&gt;</span>production<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;environment&gt;</span>prod<span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
  <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></div></div>

<p>使用命令行激活配置文件：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean <span class="nb">install</span> <span class="nt">-P</span> production
</code></pre></div></div>

<h2 id="保持-pomxml-干净且井然有序">保持 pom.xml 干净且井然有序</h2>

<p>组织良好的 <code class="language-plaintext highlighter-rouge">pom.xml</code> 文件更易于维护和理解。以下是维护干净的 <code class="language-plaintext highlighter-rouge">pom.xml</code> 的一些技巧：</p>

<ul>
  <li>将相似的依赖项和插件组合在一起。</li>
  <li>使用注释来描述特定依赖项或插件的用途。</li>
  <li>将插件和依赖项的版本号保留在 <code class="language-plaintext highlighter-rouge">&lt;properties&gt;</code> 标签内以便于管理。</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
  <span class="nt">&lt;junit.version&gt;</span>5.7.0<span class="nt">&lt;/junit.version&gt;</span>
  <span class="nt">&lt;mockito.version&gt;</span>3.9.0<span class="nt">&lt;/mockito.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
</code></pre></div></div>

<h2 id="使用-maven-wrapper">使用 Maven Wrapper</h2>

<p>Maven Wrapper 是一个用于管理和使用 Maven 的工具，它允许在没有预先安装 Maven 的情况下运行和构建 Maven 项目。</p>

<p>Maven 官方文档是这样介绍 Maven Wrapper 的：</p>

<blockquote>
  <p>The Maven Wrapper is an easy way to ensure a user of your Maven build has everything necessary to run your Maven build.</p>

  <p>Maven Wrapper 是一种简单的方法，可以确保 Maven 构建的用户拥有运行 Maven 构建所需的一切。</p>
</blockquote>

<p>Maven Wrapper 可以确保构建过程使用正确的 Maven 版本，非常方便。要使用 Maven Wrapper，请在项目目录中运行以下命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn wrapper:wrapper
</code></pre></div></div>

<p>此命令会在我们的项目中生成 Maven Wrapper 文件。现在我们可以使用 <code class="language-plaintext highlighter-rouge">./mvnw</code> （或 Windows 上的 <code class="language-plaintext highlighter-rouge">./mvnw.cmd</code>）而不是 <code class="language-plaintext highlighter-rouge">mvn</code> 来执行 Maven 命令。</p>

<h2 id="通过持续集成实现构建自动化">通过持续集成实现构建自动化</h2>

<p>将 Maven 项目与持续集成 (CI) 系统（例如 Jenkins 或 GitHub Actions）集成，可确保自动构建、测试和部署我们的代码。CI 有助于及早发现问题并在整个团队中提供一致的构建流程。以下是 Maven 项目的简单 GitHub Actions 工作流程示例：</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">name:</span> <span class="n">Java</span> <span class="n">CI</span> <span class="n">with</span> <span class="n">Maven</span>

<span class="nl">on:</span> <span class="o">[</span><span class="n">push</span><span class="o">]</span>

<span class="nl">jobs:</span>
  <span class="nl">build:</span>
    <span class="n">runs</span><span class="o">-</span><span class="nl">on:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">latest</span>

    <span class="nl">steps:</span>
    <span class="o">-</span> <span class="nl">name:</span> <span class="n">Checkout</span> <span class="n">code</span>
      <span class="nl">uses:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="nd">@v2</span>

    <span class="o">-</span> <span class="nl">name:</span> <span class="n">Set</span> <span class="n">up</span> <span class="n">JDK</span> <span class="mi">11</span>
      <span class="nl">uses:</span> <span class="n">actions</span><span class="o">/</span><span class="n">setup</span><span class="o">-</span><span class="n">java</span><span class="nd">@v2</span>
      <span class="nl">with:</span>
        <span class="n">java</span><span class="o">-</span><span class="nl">version:</span> <span class="s1">'11'</span>
        <span class="nl">distribution:</span> <span class="s1">'adopt'</span>

    <span class="o">-</span> <span class="nl">name:</span> <span class="n">Build</span> <span class="n">with</span> <span class="n">Maven</span>
      <span class="nl">run:</span> <span class="o">./</span><span class="n">mvnw</span> <span class="n">clean</span> <span class="n">install</span>
</code></pre></div></div>

<h2 id="利用-maven-插件获得附加功能">利用 Maven 插件获得附加功能</h2>

<p>有许多 Maven 插件可用于扩展 Maven 的功能。一些流行的插件包括（前三个是 Maven 自带的插件，后三个是第三方提供的插件）：</p>

<ul>
  <li>maven-surefire-plugin：配置并执行单元测试。</li>
  <li>maven-failsafe-plugin：配置并执行集成测试。</li>
  <li>maven-javadoc-plugin：生成 Javadoc 格式的项目文档。</li>
  <li>maven-checkstyle-plugin：强制执行编码标准和最佳实践。</li>
  <li>jacoco-maven-plugin: 单测覆盖率。</li>
  <li>sonar-maven-plugin：分析代码质量。</li>
  <li>……</li>
</ul>

<p>jacoco-maven-plugin 使用示例：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.jacoco<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>jacoco-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>0.8.8<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>prepare-agent<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>generate-code-coverage-report<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>report<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
      <span class="nt">&lt;/executions&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></div></div>

<p>如果这些已有的插件无法满足我们的需求，我们还可以自定义插件。</p>

<p>探索可用的插件并在 <code class="language-plaintext highlighter-rouge">pom.xml</code> 文件中配置它们以增强我们的开发过程。</p>

<h2 id="总结">总结</h2>

<p>Maven 是一个强大的工具，可以简化 Java 项目的构建过程和依赖关系管理。通过遵循这些最佳实践和技巧，我们可以优化 Maven 的使用并改善我们的 Java 开发体验。请记住使用标准目录结构，有效管理依赖关系，利用不同环境的配置文件，并将项目与持续集成系统集成，以确保构建一致。</p>
