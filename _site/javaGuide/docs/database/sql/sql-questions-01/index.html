<blockquote>
  <p>题目来源于：<a href="https://www.nowcoder.com/exam/oj?page=1&amp;tab=SQL%E7%AF%87&amp;topicId=298">牛客题霸 - SQL 必知必会</a></p>
</blockquote>

<h2 id="检索数据">检索数据</h2>

<p><code class="language-plaintext highlighter-rouge">SELECT</code> 用于从数据库中查询数据。</p>

<h3 id="从-customers-表中检索所有的-id">从 Customers 表中检索所有的 ID</h3>

<p>现有表 <code class="language-plaintext highlighter-rouge">Customers</code> 如下：</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A</td>
    </tr>
    <tr>
      <td>B</td>
    </tr>
    <tr>
      <td>C</td>
    </tr>
  </tbody>
</table>

<p>编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Customers</code> 表中检索所有的 <code class="language-plaintext highlighter-rouge">cust_id</code>。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_id</span>
<span class="k">FROM</span> <span class="n">Customers</span>
</code></pre></div></div>

<h3 id="检索并列出已订购产品的清单">检索并列出已订购产品的清单</h3>

<p>表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 含有非空的列 <code class="language-plaintext highlighter-rouge">prod_id</code> 代表商品 id，包含了所有已订购的商品（有些已被订购多次）。</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
    </tr>
    <tr>
      <td>a2</td>
    </tr>
    <tr>
      <td>a3</td>
    </tr>
    <tr>
      <td>a4</td>
    </tr>
    <tr>
      <td>a5</td>
    </tr>
    <tr>
      <td>a6</td>
    </tr>
    <tr>
      <td>a7</td>
    </tr>
  </tbody>
</table>

<p>编写 SQL 语句，检索并列出所有已订购商品（<code class="language-plaintext highlighter-rouge">prod_id</code>）的去重后的清单。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">prod_id</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
</code></pre></div></div>

<p>知识点：<code class="language-plaintext highlighter-rouge">DISTINCT</code> 用于返回列中的唯一不同值。</p>

<h3 id="检索所有列">检索所有列</h3>

<p>现在有 <code class="language-plaintext highlighter-rouge">Customers</code> 表（表中含有列 <code class="language-plaintext highlighter-rouge">cust_id</code> 代表客户 id，<code class="language-plaintext highlighter-rouge">cust_name</code> 代表客户姓名）</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>an</td>
    </tr>
    <tr>
      <td>a6</td>
      <td>lee</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p>需要编写 SQL 语句，检索所有列。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">cust_name</span>
<span class="k">FROM</span> <span class="n">Customers</span>
</code></pre></div></div>

<h2 id="排序检索数据">排序检索数据</h2>

<p><code class="language-plaintext highlighter-rouge">ORDER BY</code> 用于对结果集按照一个列或者多个列进行排序。默认按照升序对记录进行排序，如果需要按照降序对记录进行排序，可以使用 <code class="language-plaintext highlighter-rouge">DESC</code> 关键字。</p>

<h3 id="检索顾客名称并且排序">检索顾客名称并且排序</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">Customers</code>，<code class="language-plaintext highlighter-rouge">cust_id</code> 代表客户 id，<code class="language-plaintext highlighter-rouge">cust_name</code> 代表客户姓名。</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>an</td>
    </tr>
    <tr>
      <td>a6</td>
      <td>lee</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p>从 <code class="language-plaintext highlighter-rouge">Customers</code> 中检索所有的顾客名称（<code class="language-plaintext highlighter-rouge">cust_name</code>），并按从 Z 到 A 的顺序显示结果。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span> <span class="k">DESC</span>
</code></pre></div></div>

<h3 id="对顾客-id-和日期排序">对顾客 ID 和日期排序</h3>

<p>有 <code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>order_num</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>andy</td>
      <td>aaaa</td>
      <td>2021-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>andy</td>
      <td>bbbb</td>
      <td>2021-01-01 12:00:00</td>
    </tr>
    <tr>
      <td>bob</td>
      <td>cccc</td>
      <td>2021-01-10 12:00:00</td>
    </tr>
    <tr>
      <td>dick</td>
      <td>dddd</td>
      <td>2021-01-11 00:00:00</td>
    </tr>
  </tbody>
</table>

<p>编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Orders</code> 表中检索顾客 ID（<code class="language-plaintext highlighter-rouge">cust_id</code>）和订单号（<code class="language-plaintext highlighter-rouge">order_num</code>），并先按顾客 ID 对结果进行排序，再按订单日期倒序排列。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">根据列名排序</span>
<span class="o">#</span> <span class="err">注意：是</span> <span class="n">order_date</span> <span class="err">降序，而不是</span> <span class="n">order_num</span>
<span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_id</span><span class="p">,</span><span class="n">order_date</span> <span class="k">DESC</span>
</code></pre></div></div>

<p>知识点：<code class="language-plaintext highlighter-rouge">order by</code> 对多列排序的时候，先排序的列放前面，后排序的列放后面。并且，不同的列可以有不同的排序规则。</p>

<h3 id="按照数量和价格排序">按照数量和价格排序</h3>

<p>假设有一个 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>quantity</th>
      <th>item_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>100</td>
    </tr>
    <tr>
      <td>10</td>
      <td>1003</td>
    </tr>
    <tr>
      <td>2</td>
      <td>500</td>
    </tr>
  </tbody>
</table>

<p>编写 SQL 语句，显示 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表中的数量（<code class="language-plaintext highlighter-rouge">quantity</code>）和价格（<code class="language-plaintext highlighter-rouge">item_price</code>），并按数量由多到少、价格由高到低排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">item_price</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">quantity</span> <span class="k">DESC</span><span class="p">,</span><span class="n">item_price</span> <span class="k">DESC</span>
</code></pre></div></div>

<h3 id="检查-sql-语句">检查 SQL 语句</h3>

<p>有 <code class="language-plaintext highlighter-rouge">Vendors</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>vend_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>海底捞</td>
    </tr>
    <tr>
      <td>小龙坎</td>
    </tr>
    <tr>
      <td>大龙燚</td>
    </tr>
  </tbody>
</table>

<p>下面的 SQL 语句有问题吗？尝试将它改正确，使之能够正确运行，并且返回结果根据<code class="language-plaintext highlighter-rouge">vend_name</code> 逆序排列。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_name</span><span class="p">,</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">ORDER</span> <span class="n">vend_name</span> <span class="k">DESC</span>
</code></pre></div></div>

<p>改正后：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_name</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">vend_name</span> <span class="k">DESC</span>
</code></pre></div></div>

<p>知识点：</p>

<ul>
  <li>逗号作用是用来隔开列与列之间的。</li>
  <li>ORDER BY 是有 BY 的，需要撰写完整，且位置正确。</li>
</ul>

<h2 id="过滤数据">过滤数据</h2>

<p><code class="language-plaintext highlighter-rouge">WHERE</code> 可以过滤返回的数据。</p>

<p>下面的运算符可以在 <code class="language-plaintext highlighter-rouge">WHERE</code> 子句中使用：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">运算符</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">=</td>
      <td style="text-align: left">等于</td>
    </tr>
    <tr>
      <td style="text-align: left">&lt;&gt;</td>
      <td style="text-align: left">不等于。 <strong>注释：</strong> 在 SQL 的一些版本中，该操作符可被写成 !=</td>
    </tr>
    <tr>
      <td style="text-align: left">&gt;</td>
      <td style="text-align: left">大于</td>
    </tr>
    <tr>
      <td style="text-align: left">&lt;</td>
      <td style="text-align: left">小于</td>
    </tr>
    <tr>
      <td style="text-align: left">&gt;=</td>
      <td style="text-align: left">大于等于</td>
    </tr>
    <tr>
      <td style="text-align: left">&lt;=</td>
      <td style="text-align: left">小于等于</td>
    </tr>
    <tr>
      <td style="text-align: left">BETWEEN</td>
      <td style="text-align: left">在某个范围内</td>
    </tr>
    <tr>
      <td style="text-align: left">LIKE</td>
      <td style="text-align: left">搜索某种模式</td>
    </tr>
    <tr>
      <td style="text-align: left">IN</td>
      <td style="text-align: left">指定针对某个列的多个可能值</td>
    </tr>
  </tbody>
</table>

<h3 id="返回固定价格的产品">返回固定价格的产品</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">Products</code>：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0018</td>
      <td>sockets</td>
      <td>9.49</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
      <td>600</td>
    </tr>
    <tr>
      <td>b0018</td>
      <td>gucci t-shirts</td>
      <td>1000</td>
    </tr>
  </tbody>
</table>

<p>【问题】从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索产品 ID（<code class="language-plaintext highlighter-rouge">prod_id</code>）和产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>），只返回价格为 9.49 美元的产品。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_name</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="o">=</span> <span class="mi">9</span><span class="p">.</span><span class="mi">49</span>
</code></pre></div></div>

<h3 id="返回更高价格的产品">返回更高价格的产品</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">Products</code>：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0018</td>
      <td>sockets</td>
      <td>9.49</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
      <td>600</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>gucci t-shirts</td>
      <td>1000</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索产品 ID（<code class="language-plaintext highlighter-rouge">prod_id</code>）和产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>），只返回价格为 9 美元或更高的产品。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_name</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="o">&gt;=</span> <span class="mi">9</span>
</code></pre></div></div>

<h3 id="返回产品并且按照价格排序">返回产品并且按照价格排序</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">Products</code>：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>egg</td>
      <td>3</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>sockets</td>
      <td>4</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>coffee</td>
      <td>15</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回 <code class="language-plaintext highlighter-rouge">Products</code> 表中所有价格在 3 美元到 6 美元之间的产品的名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和价格（<code class="language-plaintext highlighter-rouge">prod_price</code>），然后按价格对结果进行排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="k">BETWEEN</span> <span class="mi">3</span> <span class="k">AND</span> <span class="mi">6</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_price</span>

<span class="o">#</span> <span class="err">或者</span>
<span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">AND</span> <span class="n">prod_price</span> <span class="o">&lt;=</span> <span class="mi">6</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_price</span>
</code></pre></div></div>

<h3 id="返回更多的产品">返回更多的产品</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表含有：订单号 <code class="language-plaintext highlighter-rouge">order_num</code>，<code class="language-plaintext highlighter-rouge">quantity</code>产品数量</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p>【问题】从 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表中检索出所有不同且不重复的订单号（<code class="language-plaintext highlighter-rouge">order_num</code>），其中每个订单都要包含 100 个或更多的产品。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
<span class="k">HAVING</span> <span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span>
</code></pre></div></div>

<h2 id="高级数据过滤">高级数据过滤</h2>

<p><code class="language-plaintext highlighter-rouge">AND</code> 和 <code class="language-plaintext highlighter-rouge">OR</code> 运算符用于基于一个以上的条件对记录进行过滤，两者可以结合使用。<code class="language-plaintext highlighter-rouge">AND</code> 必须 2 个条件都成立，<code class="language-plaintext highlighter-rouge">OR</code>只要 2 个条件中的一个成立即可。</p>

<h3 id="检索供应商名称">检索供应商名称</h3>

<p><code class="language-plaintext highlighter-rouge">Vendors</code> 表有字段供应商名称（<code class="language-plaintext highlighter-rouge">vend_name</code>）、供应商国家（<code class="language-plaintext highlighter-rouge">vend_country</code>）、供应商州（<code class="language-plaintext highlighter-rouge">vend_state</code>）</p>

<table>
  <thead>
    <tr>
      <th>vend_name</th>
      <th>vend_country</th>
      <th>vend_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>apple</td>
      <td>USA</td>
      <td>CA</td>
    </tr>
    <tr>
      <td>vivo</td>
      <td>CNA</td>
      <td>shenzhen</td>
    </tr>
    <tr>
      <td>huawei</td>
      <td>CNA</td>
      <td>xian</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Vendors</code> 表中检索供应商名称（<code class="language-plaintext highlighter-rouge">vend_name</code>），仅返回加利福尼亚州的供应商（这需要按国家[USA]和州[CA]进行过滤，没准其他国家也存在一个 CA）</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_name</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">WHERE</span> <span class="n">vend_country</span> <span class="o">=</span> <span class="s1">'USA'</span> <span class="k">AND</span> <span class="n">vend_state</span> <span class="o">=</span> <span class="s1">'CA'</span>
</code></pre></div></div>

<h3 id="检索并列出已订购产品的清单-1">检索并列出已订购产品的清单</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表包含了所有已订购的产品（有些已被订购多次）。</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BR01</td>
      <td>a1</td>
      <td>105</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a2</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a2</td>
      <td>200</td>
    </tr>
    <tr>
      <td>BR03</td>
      <td>a4</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>BR017</td>
      <td>a5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a2</td>
      <td>19</td>
    </tr>
    <tr>
      <td>BR017</td>
      <td>a7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，查找所有订购了数量至少 100 个的 <code class="language-plaintext highlighter-rouge">BR01</code>、<code class="language-plaintext highlighter-rouge">BR02</code> 或 <code class="language-plaintext highlighter-rouge">BR03</code> 的订单。你需要返回 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表的订单号（<code class="language-plaintext highlighter-rouge">order_num</code>）、产品 ID（<code class="language-plaintext highlighter-rouge">prod_id</code>）和数量（<code class="language-plaintext highlighter-rouge">quantity</code>），并按产品 ID 和数量进行过滤。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">quantity</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">WHERE</span> <span class="n">prod_id</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'BR01'</span><span class="p">,</span> <span class="s1">'BR02'</span><span class="p">,</span> <span class="s1">'BR03'</span><span class="p">)</span> <span class="k">AND</span> <span class="n">quantity</span> <span class="o">&gt;=</span> <span class="mi">100</span>
</code></pre></div></div>

<h3 id="返回所有价格在-3-美元到-6-美元之间的产品的名称和价格">返回所有价格在 3 美元到 6 美元之间的产品的名称和价格</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">Products</code>：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>egg</td>
      <td>3</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>sockets</td>
      <td>4</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>coffee</td>
      <td>15</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回所有价格在 3 美元到 6 美元之间的产品的名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和价格（<code class="language-plaintext highlighter-rouge">prod_price</code>），使用 AND 操作符，然后按价格对结果进行升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">and</span> <span class="n">prod_price</span> <span class="o">&lt;=</span> <span class="mi">6</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_price</span>
</code></pre></div></div>

<h3 id="检查-sql-语句-1">检查 SQL 语句</h3>

<p>供应商表 <code class="language-plaintext highlighter-rouge">Vendors</code> 有字段供应商名称 <code class="language-plaintext highlighter-rouge">vend_name</code>、供应商国家 <code class="language-plaintext highlighter-rouge">vend_country</code>、供应商省份 <code class="language-plaintext highlighter-rouge">vend_state</code></p>

<table>
  <thead>
    <tr>
      <th>vend_name</th>
      <th>vend_country</th>
      <th>vend_state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>apple</td>
      <td>USA</td>
      <td>CA</td>
    </tr>
    <tr>
      <td>vivo</td>
      <td>CNA</td>
      <td>shenzhen</td>
    </tr>
    <tr>
      <td>huawei</td>
      <td>CNA</td>
      <td>xian</td>
    </tr>
  </tbody>
</table>

<p>【问题】修改正确下面 sql，使之正确返回。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_name</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">vend_name</span>
<span class="k">WHERE</span> <span class="n">vend_country</span> <span class="o">=</span> <span class="s1">'USA'</span> <span class="k">AND</span> <span class="n">vend_state</span> <span class="o">=</span> <span class="s1">'CA'</span><span class="p">;</span>
</code></pre></div></div>

<p>修改后：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_name</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">WHERE</span> <span class="n">vend_country</span> <span class="o">=</span> <span class="s1">'USA'</span> <span class="k">AND</span> <span class="n">vend_state</span> <span class="o">=</span> <span class="s1">'CA'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">vend_name</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ORDER BY</code> 语句必须放在 <code class="language-plaintext highlighter-rouge">WHERE</code> 之后。</p>

<h2 id="用通配符进行过滤">用通配符进行过滤</h2>

<p>SQL 通配符必须与 <code class="language-plaintext highlighter-rouge">LIKE</code> 运算符一起使用</p>

<p>在 SQL 中，可使用以下通配符：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">通配符</th>
      <th style="text-align: left">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">%</code></td>
      <td style="text-align: left">代表零个或多个字符</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">_</code></td>
      <td style="text-align: left">仅替代一个字符</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">[charlist]</code></td>
      <td style="text-align: left">字符列中的任何单一字符</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">[^charlist]</code> 或者 <code class="language-plaintext highlighter-rouge">[!charlist]</code></td>
      <td style="text-align: left">不在字符列中的任何单一字符</td>
    </tr>
  </tbody>
</table>

<h3 id="检索产品名称和描述一">检索产品名称和描述（一）</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表如下：</p>

<table>
  <thead>
    <tr>
      <th>prod_name</th>
      <th>prod_desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>usb</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>gucci t-shirts</td>
    </tr>
    <tr>
      <td>c0019</td>
      <td>gucci toy</td>
    </tr>
    <tr>
      <td>d0019</td>
      <td>lego toy</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和描述（<code class="language-plaintext highlighter-rouge">prod_desc</code>），仅返回描述中包含 <code class="language-plaintext highlighter-rouge">toy</code> 一词的产品名称。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_desc</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_desc</span> <span class="k">LIKE</span> <span class="s1">'%toy%'</span>
</code></pre></div></div>

<h3 id="检索产品名称和描述二">检索产品名称和描述（二）</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表如下：</p>

<table>
  <thead>
    <tr>
      <th>prod_name</th>
      <th>prod_desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>usb</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>gucci t-shirts</td>
    </tr>
    <tr>
      <td>c0019</td>
      <td>gucci toy</td>
    </tr>
    <tr>
      <td>d0019</td>
      <td>lego toy</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和描述（<code class="language-plaintext highlighter-rouge">prod_desc</code>），仅返回描述中未出现 <code class="language-plaintext highlighter-rouge">toy</code> 一词的产品，最后按”产品名称“对结果进行排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_desc</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_desc</span> <span class="k">NOT</span> <span class="k">LIKE</span> <span class="s1">'%toy%'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_name</span>
</code></pre></div></div>

<h3 id="检索产品名称和描述三">检索产品名称和描述（三）</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表如下：</p>

<table>
  <thead>
    <tr>
      <th>prod_name</th>
      <th>prod_desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>usb</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>gucci t-shirts</td>
    </tr>
    <tr>
      <td>c0019</td>
      <td>gucci toy</td>
    </tr>
    <tr>
      <td>d0019</td>
      <td>lego carrots toy</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和描述（<code class="language-plaintext highlighter-rouge">prod_desc</code>），仅返回描述中同时出现 <code class="language-plaintext highlighter-rouge">toy</code> 和 <code class="language-plaintext highlighter-rouge">carrots</code> 的产品。有好几种方法可以执行此操作，但对于这个挑战题，请使用 <code class="language-plaintext highlighter-rouge">AND</code> 和两个 <code class="language-plaintext highlighter-rouge">LIKE</code> 比较。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_desc</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_desc</span> <span class="k">LIKE</span> <span class="s1">'%toy%'</span> <span class="k">AND</span> <span class="n">prod_desc</span> <span class="k">LIKE</span> <span class="nv">"%carrots%"</span>
</code></pre></div></div>

<h3 id="检索产品名称和描述四">检索产品名称和描述（四）</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表如下：</p>

<table>
  <thead>
    <tr>
      <th>prod_name</th>
      <th>prod_desc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>usb</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>iphone13</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>gucci t-shirts</td>
    </tr>
    <tr>
      <td>c0019</td>
      <td>gucci toy</td>
    </tr>
    <tr>
      <td>d0019</td>
      <td>lego toy carrots</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 Products 表中检索产品名称（prod_name）和描述（prod_desc），仅返回在描述中以<strong>先后顺序</strong>同时出现 toy 和 carrots 的产品。提示：只需要用带有三个 <code class="language-plaintext highlighter-rouge">%</code> 符号的 <code class="language-plaintext highlighter-rouge">LIKE</code> 即可。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_desc</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_desc</span> <span class="k">LIKE</span> <span class="s1">'%toy%carrots%'</span>
</code></pre></div></div>

<h2 id="创建计算字段">创建计算字段</h2>

<h3 id="别名">别名</h3>

<p>别名的常见用法是在检索出的结果中重命名表的列字段（为了符合特定的报表要求或客户需求）。有表 <code class="language-plaintext highlighter-rouge">Vendors</code> 代表供应商信息，<code class="language-plaintext highlighter-rouge">vend_id</code> 供应商 id、<code class="language-plaintext highlighter-rouge">vend_name</code> 供应商名称、<code class="language-plaintext highlighter-rouge">vend_address</code> 供应商地址、<code class="language-plaintext highlighter-rouge">vend_city</code> 供应商城市。</p>

<table>
  <thead>
    <tr>
      <th>vend_id</th>
      <th>vend_name</th>
      <th>vend_address</th>
      <th>vend_city</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a001</td>
      <td>tencent cloud</td>
      <td>address1</td>
      <td>shenzhen</td>
    </tr>
    <tr>
      <td>a002</td>
      <td>huawei cloud</td>
      <td>address2</td>
      <td>dongguan</td>
    </tr>
    <tr>
      <td>a003</td>
      <td>aliyun cloud</td>
      <td>address3</td>
      <td>hangzhou</td>
    </tr>
    <tr>
      <td>a003</td>
      <td>netease cloud</td>
      <td>address4</td>
      <td>guangzhou</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Vendors</code> 表中检索 <code class="language-plaintext highlighter-rouge">vend_id</code>、<code class="language-plaintext highlighter-rouge">vend_name</code>、<code class="language-plaintext highlighter-rouge">vend_address</code> 和 <code class="language-plaintext highlighter-rouge">vend_city</code>，将 <code class="language-plaintext highlighter-rouge">vend_name</code> 重命名为 <code class="language-plaintext highlighter-rouge">vname</code>，将 <code class="language-plaintext highlighter-rouge">vend_city</code> 重命名为 <code class="language-plaintext highlighter-rouge">vcity</code>，将 <code class="language-plaintext highlighter-rouge">vend_address</code> 重命名为 <code class="language-plaintext highlighter-rouge">vaddress</code>，按供应商名称对结果进行升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="n">vend_name</span> <span class="k">AS</span> <span class="n">vname</span><span class="p">,</span> <span class="n">vend_address</span> <span class="k">AS</span> <span class="n">vaddress</span><span class="p">,</span> <span class="n">vend_city</span> <span class="k">AS</span> <span class="n">vcity</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">vname</span>
<span class="o">#</span> <span class="k">as</span> <span class="err">可以省略</span>
<span class="k">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="n">vend_name</span> <span class="n">vname</span><span class="p">,</span> <span class="n">vend_address</span> <span class="n">vaddress</span><span class="p">,</span> <span class="n">vend_city</span> <span class="n">vcity</span>
<span class="k">FROM</span> <span class="n">Vendors</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">vname</span>
</code></pre></div></div>

<h3 id="打折">打折</h3>

<p>我们的示例商店正在进行打折促销，所有产品均降价 10%。<code class="language-plaintext highlighter-rouge">Products</code> 表包含 <code class="language-plaintext highlighter-rouge">prod_id</code> 产品 id、<code class="language-plaintext highlighter-rouge">prod_price</code> 产品价格。</p>

<p>【问题】编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中返回 <code class="language-plaintext highlighter-rouge">prod_id</code>、<code class="language-plaintext highlighter-rouge">prod_price</code> 和 <code class="language-plaintext highlighter-rouge">sale_price</code>。<code class="language-plaintext highlighter-rouge">sale_price</code> 是一个包含促销价格的计算字段。提示：可以乘以 0.9，得到原价的 90%（即 10%的折扣）。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_price</span><span class="p">,</span> <span class="n">prod_price</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9</span> <span class="k">AS</span> <span class="n">sale_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
</code></pre></div></div>

<p>注意：<code class="language-plaintext highlighter-rouge">sale_price</code> 是对计算结果的命名，而不是原有的列名。</p>

<h2 id="使用函数处理数据">使用函数处理数据</h2>

<h3 id="顾客登录名">顾客登录名</h3>

<p>我们的商店已经上线了，正在创建顾客账户。所有用户都需要登录名，默认登录名是其名称和所在城市的组合。</p>

<p>给出 <code class="language-plaintext highlighter-rouge">Customers</code> 表 如下：</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
      <th>cust_contact</th>
      <th>cust_city</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>Andy Li</td>
      <td>Andy Li</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>Ben Liu</td>
      <td>Ben Liu</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>Tony Dai</td>
      <td>Tony Dai</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>Tom Chen</td>
      <td>Tom Chen</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>An Li</td>
      <td>An Li</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a6</td>
      <td>Lee Chen</td>
      <td>Lee Chen</td>
      <td>Oak Park</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>Hex Liu</td>
      <td>Hex Liu</td>
      <td>Oak Park</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回顾客 ID（<code class="language-plaintext highlighter-rouge">cust_id</code>）、顾客名称（<code class="language-plaintext highlighter-rouge">cust_name</code>）和登录名（<code class="language-plaintext highlighter-rouge">user_login</code>），其中登录名全部为大写字母，并由顾客联系人的前两个字符（<code class="language-plaintext highlighter-rouge">cust_contact</code>）和其所在城市的前三个字符（<code class="language-plaintext highlighter-rouge">cust_city</code>）组成。提示：需要使用函数、拼接和别名。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">cust_name</span><span class="p">,</span> <span class="k">UPPER</span><span class="p">(</span><span class="n">CONCAT</span><span class="p">(</span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">cust_contact</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">cust_city</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> <span class="k">AS</span> <span class="n">user_login</span>
<span class="k">FROM</span> <span class="n">Customers</span>
</code></pre></div></div>

<p>知识点：</p>

<ul>
  <li>截取函数<code class="language-plaintext highlighter-rouge">SUBSTRING()</code>：截取字符串，<code class="language-plaintext highlighter-rouge">substring(str ,n ,m)</code>（n 表示起始截取位置，m 表示要截取的字符个数）表示返回字符串 str 从第 n 个字符开始截取 m 个字符；</li>
  <li>
    <p>拼接函数<code class="language-plaintext highlighter-rouge">CONCAT()</code>：将两个或多个字符串连接成一个字符串，select concat(A,B)：连接字符串 A 和 B。</p>
  </li>
  <li>大写函数 <code class="language-plaintext highlighter-rouge">UPPER()</code>：将指定字符串转换为大写。</li>
</ul>

<h3 id="返回-2020-年-1-月的所有订单的订单号和订单日期">返回 2020 年 1 月的所有订单的订单号和订单日期</h3>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 订单表如下：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>2020-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>2020-01-02 00:00:00</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>2020-01-01 12:00:00</td>
    </tr>
    <tr>
      <td>a0004</td>
      <td>2020-02-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0005</td>
      <td>2020-03-01 00:00:00</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回 2020 年 1 月的所有订单的订单号（<code class="language-plaintext highlighter-rouge">order_num</code>）和订单日期（<code class="language-plaintext highlighter-rouge">order_date</code>），并按订单日期升序排序</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">WHERE</span> <span class="k">month</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'01'</span> <span class="k">AND</span> <span class="nb">YEAR</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'2020'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>
</code></pre></div></div>

<p>也可以用通配符来做：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">WHERE</span> <span class="n">order_date</span> <span class="k">LIKE</span> <span class="s1">'2020-01%'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>
</code></pre></div></div>

<p>知识点：</p>

<ul>
  <li>日期格式：<code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code></li>
  <li>时间格式：<code class="language-plaintext highlighter-rouge">HH:MM:SS</code></li>
</ul>

<p>日期和时间处理相关的常用函数：</p>

<table>
  <thead>
    <tr>
      <th>函 数</th>
      <th>说 明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ADDDATE()</code></td>
      <td>增加一个日期（天、周等）</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ADDTIME()</code></td>
      <td>增加一个时间（时、分等）</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CURDATE()</code></td>
      <td>返回当前日期</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CURTIME()</code></td>
      <td>返回当前时间</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DATE()</code></td>
      <td>返回日期时间的日期部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DATEDIFF</code></td>
      <td>计算两个日期之差</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DATE_FORMAT()</code></td>
      <td>返回一个格式化的日期或时间串</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DAY()</code></td>
      <td>返回一个日期的天数部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DAYOFWEEK()</code></td>
      <td>对于一个日期，返回对应的星期几</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">HOUR()</code></td>
      <td>返回一个时间的小时部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">MINUTE()</code></td>
      <td>返回一个时间的分钟部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">MONTH()</code></td>
      <td>返回一个日期的月份部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">NOW()</code></td>
      <td>返回当前日期和时间</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SECOND()</code></td>
      <td>返回一个时间的秒部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">TIME()</code></td>
      <td>返回一个日期时间的时间部分</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">YEAR()</code></td>
      <td>返回一个日期的年份部分</td>
    </tr>
  </tbody>
</table>

<h2 id="汇总数据">汇总数据</h2>

<p>汇总数据相关的函数：</p>

<table>
  <thead>
    <tr>
      <th>函 数</th>
      <th>说 明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AVG()</code></td>
      <td>返回某列的平均值</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">COUNT()</code></td>
      <td>返回某列的行数</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">MAX()</code></td>
      <td>返回某列的最大值</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">MIN()</code></td>
      <td>返回某列的最小值</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">SUM()</code></td>
      <td>返回某列值之和</td>
    </tr>
  </tbody>
</table>

<h3 id="确定已售出产品的总数">确定已售出产品的总数</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表代表售出的产品，<code class="language-plaintext highlighter-rouge">quantity</code> 代表售出商品数量。</p>

<table>
  <thead>
    <tr>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10</td>
    </tr>
    <tr>
      <td>100</td>
    </tr>
    <tr>
      <td>1000</td>
    </tr>
    <tr>
      <td>10001</td>
    </tr>
    <tr>
      <td>2</td>
    </tr>
    <tr>
      <td>15</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，确定已售出产品的总数。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">Sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">items_ordered</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
</code></pre></div></div>

<h3 id="确定已售出产品项-br01-的总数">确定已售出产品项 BR01 的总数</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表代表售出的产品，<code class="language-plaintext highlighter-rouge">quantity</code> 代表售出商品数量，产品项为 <code class="language-plaintext highlighter-rouge">prod_id</code>。</p>

<table>
  <thead>
    <tr>
      <th>quantity</th>
      <th>prod_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10</td>
      <td>AR01</td>
    </tr>
    <tr>
      <td>100</td>
      <td>AR10</td>
    </tr>
    <tr>
      <td>1000</td>
      <td>BR01</td>
    </tr>
    <tr>
      <td>10001</td>
      <td>BR010</td>
    </tr>
  </tbody>
</table>

<p>【问题】修改创建的语句，确定已售出产品项（<code class="language-plaintext highlighter-rouge">prod_id</code>）为”BR01”的总数。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">Sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">items_ordered</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>
</code></pre></div></div>

<h3 id="确定-products-表中价格不超过-10-美元的最贵产品的价格">确定 Products 表中价格不超过 10 美元的最贵产品的价格</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表如下，<code class="language-plaintext highlighter-rouge">prod_price</code> 代表商品的价格。</p>

<table>
  <thead>
    <tr>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>9.49</td>
    </tr>
    <tr>
      <td>600</td>
    </tr>
    <tr>
      <td>1000</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，确定 <code class="language-plaintext highlighter-rouge">Products</code> 表中价格不超过 10 美元的最贵产品的价格（<code class="language-plaintext highlighter-rouge">prod_price</code>）。将计算所得的字段命名为 <code class="language-plaintext highlighter-rouge">max_price</code>。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">Max</span><span class="p">(</span><span class="n">prod_price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_price</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">WHERE</span> <span class="n">prod_price</span> <span class="o">&lt;=</span> <span class="mi">10</span>
</code></pre></div></div>

<h2 id="分组数据">分组数据</h2>

<p><code class="language-plaintext highlighter-rouge">GROUP BY</code>：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GROUP BY</code> 子句将记录分组到汇总行中。</li>
  <li><code class="language-plaintext highlighter-rouge">GROUP BY</code> 为每个组返回一个记录。</li>
  <li><code class="language-plaintext highlighter-rouge">GROUP BY</code> 通常还涉及聚合<code class="language-plaintext highlighter-rouge">COUNT</code>，<code class="language-plaintext highlighter-rouge">MAX</code>，<code class="language-plaintext highlighter-rouge">SUM</code>，<code class="language-plaintext highlighter-rouge">AVG</code> 等。</li>
  <li><code class="language-plaintext highlighter-rouge">GROUP BY</code> 可以按一列或多列进行分组。</li>
  <li><code class="language-plaintext highlighter-rouge">GROUP BY</code> 按分组字段进行排序后，<code class="language-plaintext highlighter-rouge">ORDER BY</code> 可以以汇总字段来进行排序。</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">HAVING</code>：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAVING</code> 用于对汇总的 <code class="language-plaintext highlighter-rouge">GROUP BY</code> 结果进行过滤。</li>
  <li><code class="language-plaintext highlighter-rouge">HAVING</code> 必须要与 <code class="language-plaintext highlighter-rouge">GROUP BY</code> 连用。</li>
  <li><code class="language-plaintext highlighter-rouge">WHERE</code> 和 <code class="language-plaintext highlighter-rouge">HAVING</code> 可以在相同的查询中。</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">HAVING</code> vs <code class="language-plaintext highlighter-rouge">WHERE</code>：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">WHERE</code>：过滤指定的行，后面不能加聚合函数（分组函数）。</li>
  <li><code class="language-plaintext highlighter-rouge">HAVING</code>：过滤分组，必须要与 <code class="language-plaintext highlighter-rouge">GROUP BY</code> 连用，不能单独使用。</li>
</ul>

<h3 id="返回每个订单号各有多少行数">返回每个订单号各有多少行数</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表包含每个订单的每个产品</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a004</td>
    </tr>
    <tr>
      <td>a007</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回每个订单号（<code class="language-plaintext highlighter-rouge">order_num</code>）各有多少行数（<code class="language-plaintext highlighter-rouge">order_lines</code>），并按 <code class="language-plaintext highlighter-rouge">order_lines</code> 对结果进行升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">Count</span><span class="p">(</span><span class="n">order_num</span><span class="p">)</span> <span class="k">AS</span> <span class="n">order_lines</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_lines</span>
</code></pre></div></div>

<p>知识点：</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">count(*)</code>,<code class="language-plaintext highlighter-rouge">count(列名)</code>都可以，区别在于，<code class="language-plaintext highlighter-rouge">count(列名)</code>是统计非 NULL 的行数；</li>
  <li><code class="language-plaintext highlighter-rouge">order by</code> 最后执行，所以可以使用列别名；</li>
  <li>分组聚合一定不要忘记加上 <code class="language-plaintext highlighter-rouge">group by</code> ,不然只会有一行结果。</li>
</ol>

<h3 id="每个供应商成本最低的产品">每个供应商成本最低的产品</h3>

<p>有 <code class="language-plaintext highlighter-rouge">Products</code> 表，含有字段 <code class="language-plaintext highlighter-rouge">prod_price</code> 代表产品价格，<code class="language-plaintext highlighter-rouge">vend_id</code> 代表供应商 id</p>

<table>
  <thead>
    <tr>
      <th>vend_id</th>
      <th>prod_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0011</td>
      <td>100</td>
    </tr>
    <tr>
      <td>a0019</td>
      <td>0.1</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>1000</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>6980</td>
    </tr>
    <tr>
      <td>b0019</td>
      <td>20</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回名为 <code class="language-plaintext highlighter-rouge">cheapest_item</code> 的字段，该字段包含每个供应商成本最低的产品（使用 <code class="language-plaintext highlighter-rouge">Products</code> 表中的 <code class="language-plaintext highlighter-rouge">prod_price</code>），然后从最低成本到最高成本对结果进行升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="k">Min</span><span class="p">(</span><span class="n">prod_price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cheapest_item</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">vend_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cheapest_item</span>
</code></pre></div></div>

<h3 id="返回订单数量总和不小于-100-的所有订单的订单号">返回订单数量总和不小于 100 的所有订单的订单号</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品表，包括：订单号 <code class="language-plaintext highlighter-rouge">order_num</code> 和订单数量 <code class="language-plaintext highlighter-rouge">quantity</code>。</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p>【问题】请编写 SQL 语句，返回订单数量总和不小于 100 的所有订单号，最后结果按照订单号升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">直接聚合</span>
<span class="k">SELECT</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
<span class="k">HAVING</span> <span class="k">Sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_num</span>

<span class="o">#</span> <span class="err">子查询</span>
<span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">Sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">sum_num</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
    <span class="k">HAVING</span> <span class="n">sum_num</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="n">a</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span>
</code></pre></div></div>

<p>知识点：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">where</code>：过滤过滤指定的行，后面不能加聚合函数（分组函数）。</li>
  <li><code class="language-plaintext highlighter-rouge">having</code>：过滤分组，与 <code class="language-plaintext highlighter-rouge">group by</code> 连用，不能单独使用。</li>
</ul>

<h3 id="计算总和">计算总和</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表代表订单信息，包括字段：订单号 <code class="language-plaintext highlighter-rouge">order_num</code> 和 <code class="language-plaintext highlighter-rouge">item_price</code> 商品售出价格、<code class="language-plaintext highlighter-rouge">quantity</code> 商品数量。</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>item_price</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>10</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>2</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，根据订单号聚合，返回订单总价不小于 1000 的所有订单号，最后的结果按订单号进行升序排序。</p>

<p>提示：总价 = item_price 乘以 quantity</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">Sum</span><span class="p">(</span><span class="n">item_price</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_price</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
<span class="k">HAVING</span> <span class="n">total_price</span> <span class="o">&gt;=</span> <span class="mi">1000</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_num</span>
</code></pre></div></div>

<h3 id="检查-sql-语句-2">检查 SQL 语句</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表含有 <code class="language-plaintext highlighter-rouge">order_num</code> 订单号</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a002</td>
    </tr>
    <tr>
      <td>a004</td>
    </tr>
    <tr>
      <td>a007</td>
    </tr>
  </tbody>
</table>

<p>【问题】将下面代码修改正确后执行</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">items</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">items</span>
<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">items</span><span class="p">,</span> <span class="n">order_num</span><span class="p">;</span>
</code></pre></div></div>

<p>修改后：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">items</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span>
<span class="k">HAVING</span> <span class="n">items</span> <span class="o">&gt;=</span> <span class="mi">3</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">items</span><span class="p">,</span> <span class="n">order_num</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="使用子查询">使用子查询</h2>

<p>子查询是嵌套在较大查询中的 SQL 查询，也称内部查询或内部选择，包含子查询的语句也称为外部查询或外部选择。简单来说，子查询就是指将一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 查询（子查询）的结果作为另一个 SQL 语句（主查询）的数据来源或者判断条件。</p>

<p>子查询可以嵌入 <code class="language-plaintext highlighter-rouge">SELECT</code>、<code class="language-plaintext highlighter-rouge">INSERT</code>、<code class="language-plaintext highlighter-rouge">UPDATE</code> 和 <code class="language-plaintext highlighter-rouge">DELETE</code> 语句中，也可以和 <code class="language-plaintext highlighter-rouge">=</code>、<code class="language-plaintext highlighter-rouge">&lt;</code>、<code class="language-plaintext highlighter-rouge">&gt;</code>、<code class="language-plaintext highlighter-rouge">IN</code>、<code class="language-plaintext highlighter-rouge">BETWEEN</code>、<code class="language-plaintext highlighter-rouge">EXISTS</code> 等运算符一起使用。</p>

<p>子查询常用在 <code class="language-plaintext highlighter-rouge">WHERE</code> 子句和 <code class="language-plaintext highlighter-rouge">FROM</code> 子句后边：</p>

<ul>
  <li>当用于 <code class="language-plaintext highlighter-rouge">WHERE</code> 子句时，根据不同的运算符，子查询可以返回单行单列、多行单列、单行多列数据。子查询就是要返回能够作为 WHERE 子句查询条件的值。</li>
  <li>当用于 <code class="language-plaintext highlighter-rouge">FROM</code> 子句时，一般返回多行多列数据，相当于返回一张临时表，这样才符合 <code class="language-plaintext highlighter-rouge">FROM</code> 后面是表的规则。这种做法能够实现多表联合查询。</li>
</ul>

<blockquote>
  <p>注意：MySQL 数据库从 4.1 版本才开始支持子查询，早期版本是不支持的。</p>
</blockquote>

<p>用于 <code class="language-plaintext highlighter-rouge">WHERE</code> 子句的子查询的基本语法如下：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">column_name</span> <span class="p">[,</span> <span class="k">column_name</span> <span class="p">]</span>
<span class="k">FROM</span> <span class="n">table1</span> <span class="p">[,</span> <span class="n">table2</span> <span class="p">]</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">operator</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="k">column_name</span> <span class="p">[,</span> <span class="k">column_name</span> <span class="p">]</span>
<span class="k">FROM</span> <span class="n">table1</span> <span class="p">[,</span> <span class="n">table2</span> <span class="p">]</span>
<span class="p">[</span><span class="k">WHERE</span><span class="p">])</span>
</code></pre></div></div>

<ul>
  <li>子查询需要放在括号<code class="language-plaintext highlighter-rouge">( )</code>内。</li>
  <li><code class="language-plaintext highlighter-rouge">operator</code> 表示用于 <code class="language-plaintext highlighter-rouge">WHERE</code> 子句的运算符，可以是比较运算符（如 <code class="language-plaintext highlighter-rouge">=</code>, <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;&gt;</code> 等）或逻辑运算符（如 <code class="language-plaintext highlighter-rouge">IN</code>, <code class="language-plaintext highlighter-rouge">NOT IN</code>, <code class="language-plaintext highlighter-rouge">EXISTS</code>, <code class="language-plaintext highlighter-rouge">NOT EXISTS</code> 等），具体根据需求来确定。</li>
</ul>

<p>用于 <code class="language-plaintext highlighter-rouge">FROM</code> 子句的子查询的基本语法如下：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">column_name</span> <span class="p">[,</span> <span class="k">column_name</span> <span class="p">]</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">column_name</span> <span class="p">[,</span> <span class="k">column_name</span> <span class="p">]</span>
      <span class="k">FROM</span> <span class="n">table1</span> <span class="p">[,</span> <span class="n">table2</span> <span class="p">]</span>
      <span class="p">[</span><span class="k">WHERE</span><span class="p">])</span> <span class="k">AS</span> <span class="n">temp_table_name</span> <span class="p">[,</span> <span class="p">...]</span>
<span class="p">[</span><span class="k">JOIN</span> <span class="k">type</span> <span class="k">JOIN</span> <span class="k">table_name</span> <span class="k">ON</span> <span class="n">condition</span><span class="p">]</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>用于 <code class="language-plaintext highlighter-rouge">FROM</code> 的子查询返回的结果相当于一张临时表，所以需要使用 AS 关键字为该临时表起一个名字。</li>
  <li>子查询需要放在括号 <code class="language-plaintext highlighter-rouge">( )</code> 内。</li>
  <li>可以指定多个临时表名，并使用 <code class="language-plaintext highlighter-rouge">JOIN</code> 语句连接这些表。</li>
</ul>

<h3 id="返回购买价格为-10-美元或以上产品的顾客列表">返回购买价格为 10 美元或以上产品的顾客列表</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表示订单商品表，含有字段订单号：<code class="language-plaintext highlighter-rouge">order_num</code>、订单价格：<code class="language-plaintext highlighter-rouge">item_price</code>；<code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单信息表，含有顾客 <code class="language-plaintext highlighter-rouge">id：cust_id</code> 和订单号：<code class="language-plaintext highlighter-rouge">order_num</code></p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表:</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>item_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>2</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>5</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust5</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust7</td>
    </tr>
  </tbody>
</table>

<p>【问题】使用子查询，返回购买价格为 10 美元或以上产品的顾客列表，结果无需排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_id</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">WHERE</span> <span class="n">order_num</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">order_num</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">where</span> <span class="n">item_price</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="确定哪些订单购买了-prod_id-为-br01-的产品一">确定哪些订单购买了 prod_id 为 BR01 的产品（一）</h3>

<p>表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品信息表，<code class="language-plaintext highlighter-rouge">prod_id</code> 为产品 id；<code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单表有 <code class="language-plaintext highlighter-rouge">cust_id</code> 代表顾客 id 和订单日期 <code class="language-plaintext highlighter-rouge">order_date</code></p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BR01</td>
      <td>a0001</td>
    </tr>
    <tr>
      <td>BR01</td>
      <td>a0002</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0003</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0013</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>cust10</td>
      <td>2022-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>cust1</td>
      <td>2022-01-01 00:01:00</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cust1</td>
      <td>2022-01-02 00:00:00</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>cust2</td>
      <td>2022-01-01 00:20:00</td>
    </tr>
  </tbody>
</table>

<p>【问题】</p>

<p>编写 SQL 语句，使用子查询来确定哪些订单（在 <code class="language-plaintext highlighter-rouge">OrderItems</code> 中）购买了 <code class="language-plaintext highlighter-rouge">prod_id</code> 为 “BR01” 的产品，然后从 <code class="language-plaintext highlighter-rouge">Orders</code> 表中返回每个产品对应的顾客 ID（<code class="language-plaintext highlighter-rouge">cust_id</code>）和订单日期（<code class="language-plaintext highlighter-rouge">order_date</code>），按订购日期对结果进行升序排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">写法</span> <span class="mi">1</span><span class="err">：子查询</span>
<span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span><span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">WHERE</span> <span class="n">order_num</span> <span class="k">IN</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span>
     <span class="k">FROM</span> <span class="n">OrderItems</span>
     <span class="k">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span> <span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span><span class="p">;</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">2</span><span class="p">:</span> <span class="err">连接表</span>
<span class="k">SELECT</span> <span class="n">b</span><span class="p">.</span><span class="n">cust_id</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">OrderItems</span> <span class="n">a</span><span class="p">,</span><span class="n">Orders</span> <span class="n">b</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">order_num</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>
</code></pre></div></div>

<h3 id="返回购买-prod_id-为-br01-的产品的所有顾客的电子邮件一">返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（一）</h3>

<p>你想知道订购 BR01 产品的日期，有表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品信息表，<code class="language-plaintext highlighter-rouge">prod_id</code> 为产品 id；<code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单表有 <code class="language-plaintext highlighter-rouge">cust_id</code> 代表顾客 id 和订单日期 <code class="language-plaintext highlighter-rouge">order_date</code>；<code class="language-plaintext highlighter-rouge">Customers</code> 表含有 <code class="language-plaintext highlighter-rouge">cust_email</code> 顾客邮件和 <code class="language-plaintext highlighter-rouge">cust_id</code> 顾客 id</p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BR01</td>
      <td>a0001</td>
    </tr>
    <tr>
      <td>BR01</td>
      <td>a0002</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0003</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0013</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>cust10</td>
      <td>2022-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>cust1</td>
      <td>2022-01-01 00:01:00</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cust1</td>
      <td>2022-01-02 00:00:00</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>cust2</td>
      <td>2022-01-01 00:20:00</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表代表顾客信息，<code class="language-plaintext highlighter-rouge">cust_id</code> 为顾客 id，<code class="language-plaintext highlighter-rouge">cust_email</code> 为顾客 email</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td><a href="mailto:cust10@cust.com">cust10@cust.com</a></td>
    </tr>
    <tr>
      <td>cust1</td>
      <td><a href="mailto:cust1@cust.com">cust1@cust.com</a></td>
    </tr>
    <tr>
      <td>cust2</td>
      <td><a href="mailto:cust2@cust.com">cust2@cust.com</a></td>
    </tr>
  </tbody>
</table>

<p>【问题】返回购买 <code class="language-plaintext highlighter-rouge">prod_id</code> 为 <code class="language-plaintext highlighter-rouge">BR01</code> 的产品的所有顾客的电子邮件（<code class="language-plaintext highlighter-rouge">Customers</code> 表中的 <code class="language-plaintext highlighter-rouge">cust_email</code>），结果无需排序。</p>

<p>提示：这涉及 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句，最内层的从 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表返回 <code class="language-plaintext highlighter-rouge">order_num</code>，中间的从 <code class="language-plaintext highlighter-rouge">Customers</code> 表返回 <code class="language-plaintext highlighter-rouge">cust_id</code>。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">写法</span> <span class="mi">1</span><span class="err">：子查询</span>
<span class="k">SELECT</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_id</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">cust_id</span>
    <span class="k">FROM</span> <span class="n">Orders</span>
    <span class="k">WHERE</span> <span class="n">order_num</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span>
        <span class="k">FROM</span> <span class="n">OrderItems</span>
        <span class="k">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span><span class="p">))</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">2</span><span class="p">:</span> <span class="err">连接表（</span><span class="k">inner</span> <span class="k">join</span><span class="err">）</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">OrderItems</span> <span class="n">a</span><span class="p">,</span><span class="n">Orders</span> <span class="n">b</span><span class="p">,</span><span class="n">Customers</span> <span class="k">c</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">order_num</span> <span class="k">AND</span> <span class="n">b</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">3</span><span class="err">：连接表（</span><span class="k">left</span> <span class="k">join</span><span class="err">）</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">a</span> <span class="k">LEFT</span> <span class="k">JOIN</span>
  <span class="n">OrderItems</span> <span class="n">b</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">order_num</span> <span class="k">LEFT</span> <span class="k">JOIN</span>
  <span class="n">Customers</span> <span class="k">c</span> <span class="k">ON</span> <span class="n">a</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span>
<span class="k">WHERE</span> <span class="n">b</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>
</code></pre></div></div>

<h3 id="返回每个顾客不同订单的总金额">返回每个顾客不同订单的总金额</h3>

<p>我们需要一个顾客 ID 列表，其中包含他们已订购的总金额。</p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表代表订单信息，<code class="language-plaintext highlighter-rouge">OrderItems</code> 表有订单号：<code class="language-plaintext highlighter-rouge">order_num</code> 和商品售出价格：<code class="language-plaintext highlighter-rouge">item_price</code>、商品数量：<code class="language-plaintext highlighter-rouge">quantity</code>。</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>item_price</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>10</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>1</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>1</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>2</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>1</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表订单号：<code class="language-plaintext highlighter-rouge">order_num</code>、顾客 id：<code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>cust2</td>
    </tr>
  </tbody>
</table>

<p>【问题】</p>

<p>编写 SQL 语句，返回顾客 ID（<code class="language-plaintext highlighter-rouge">Orders</code> 表中的 <code class="language-plaintext highlighter-rouge">cust_id</code>），并使用子查询返回 <code class="language-plaintext highlighter-rouge">total_ordered</code> 以便返回每个顾客的订单总数，将结果按金额从大到小排序。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">写法</span> <span class="mi">1</span><span class="err">：子查询</span>
<span class="k">SELECT</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">tb</span><span class="p">.</span><span class="n">total_ordered</span><span class="p">)</span> <span class="k">AS</span> <span class="nv">`total_ordered`</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">item_price</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_ordered</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">order_num</span><span class="p">)</span> <span class="k">AS</span> <span class="n">tb</span><span class="p">,</span>
  <span class="n">Orders</span> <span class="n">o</span>
<span class="k">WHERE</span> <span class="n">tb</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">total_ordered</span> <span class="k">DESC</span><span class="p">;</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">2</span><span class="err">：连接表</span>
<span class="k">SELECT</span> <span class="n">b</span><span class="p">.</span><span class="n">cust_id</span><span class="p">,</span> <span class="k">Sum</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">a</span><span class="p">.</span><span class="n">item_price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_ordered</span>
<span class="k">FROM</span> <span class="n">OrderItems</span> <span class="n">a</span><span class="p">,</span><span class="n">Orders</span> <span class="n">b</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">cust_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">total_ordered</span> <span class="k">DESC</span>
</code></pre></div></div>

<p>关于写法一详细介绍可以参考： <a href="https://github.com/Snailclimb/JavaGuide/issues/2402">issue#2402：写法 1 存在的错误以及修改方法</a>。</p>

<h3 id="从-products-表中检索所有的产品名称以及对应的销售总数">从 Products 表中检索所有的产品名称以及对应的销售总数</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表中检索所有的产品名称：<code class="language-plaintext highlighter-rouge">prod_name</code>、产品 id：<code class="language-plaintext highlighter-rouge">prod_id</code></p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>egg</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>sockets</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>coffee</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cola</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品表，订单产品：<code class="language-plaintext highlighter-rouge">prod_id</code>、售出数量：<code class="language-plaintext highlighter-rouge">quantity</code></p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p>【问题】</p>

<p>编写 SQL 语句，从 <code class="language-plaintext highlighter-rouge">Products</code> 表中检索所有的产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>），以及名为 <code class="language-plaintext highlighter-rouge">quant_sold</code> 的计算列，其中包含所售产品的总数（在 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表上使用子查询和 <code class="language-plaintext highlighter-rouge">SUM(quantity)</code> 检索）。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">写法</span> <span class="mi">1</span><span class="err">：子查询</span>
<span class="k">SELECT</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="p">,</span> <span class="n">tb</span><span class="p">.</span><span class="n">quant_sold</span>
<span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="k">Sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">quant_sold</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">prod_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">tb</span><span class="p">,</span>
  <span class="n">Products</span> <span class="n">p</span>
<span class="k">WHERE</span> <span class="n">tb</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">2</span><span class="err">：连接表</span>
<span class="k">SELECT</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="p">,</span> <span class="k">Sum</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">quant_sold</span>
<span class="k">FROM</span> <span class="n">Products</span> <span class="n">p</span><span class="p">,</span>
  <span class="n">OrderItems</span> <span class="n">o</span>
<span class="k">WHERE</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">prod_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_name</span><span class="err">（这里不能用</span> <span class="n">p</span><span class="p">.</span><span class="n">prod_id</span><span class="err">，会报错）</span>
</code></pre></div></div>

<h2 id="连接表">连接表</h2>

<p>JOIN 是“连接”的意思，顾名思义，SQL JOIN 子句用于将两个或者多个表联合起来进行查询。</p>

<p>连接表时需要在每个表中选择一个字段，并对这些字段的值进行比较，值相同的两条记录将合并为一条。<strong>连接表的本质就是将不同表的记录合并起来，形成一张新表。当然，这张新表只是临时的，它仅存在于本次查询期间</strong>。</p>

<p>使用 <code class="language-plaintext highlighter-rouge">JOIN</code> 连接两个表的基本语法如下：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">table1</span><span class="p">.</span><span class="n">column1</span><span class="p">,</span> <span class="n">table2</span><span class="p">.</span><span class="n">column2</span><span class="p">...</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">JOIN</span> <span class="n">table2</span>
<span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="n">common_column1</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="n">common_column2</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">table1.common_column1 = table2.common_column2</code> 是连接条件，只有满足此条件的记录才会合并为一行。您可以使用多个运算符来连接表，例如 =、&gt;、&lt;、&lt;&gt;、&lt;=、&gt;=、!=、<code class="language-plaintext highlighter-rouge">between</code>、<code class="language-plaintext highlighter-rouge">like</code> 或者 <code class="language-plaintext highlighter-rouge">not</code>，但是最常见的是使用 =。</p>

<p>当两个表中有同名的字段时，为了帮助数据库引擎区分是哪个表的字段，在书写同名字段名时需要加上表名。当然，如果书写的字段名在两个表中是唯一的，也可以不使用以上格式，只写字段名即可。</p>

<p>另外，如果两张表的关联字段名相同，也可以使用 <code class="language-plaintext highlighter-rouge">USING</code>子句来代替 <code class="language-plaintext highlighter-rouge">ON</code>，举个例子：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">join</span><span class="p">....</span><span class="k">on</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="n">o</span>
<span class="k">ON</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span>

<span class="o">#</span> <span class="err">如果两张表的关联字段名相同，也可以使用</span><span class="k">USING</span><span class="err">子句：</span><span class="k">JOIN</span><span class="p">....</span><span class="k">USING</span><span class="p">()</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="n">o</span>
<span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span>
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">ON</code> 和 <code class="language-plaintext highlighter-rouge">WHERE</code> 的区别</strong>：</p>

<ul>
  <li>连接表时，SQL 会根据连接条件生成一张新的临时表。<code class="language-plaintext highlighter-rouge">ON</code> 就是连接条件，它决定临时表的生成。</li>
  <li><code class="language-plaintext highlighter-rouge">WHERE</code> 是在临时表生成以后，再对临时表中的数据进行过滤，生成最终的结果集，这个时候已经没有 JOIN-ON 了。</li>
</ul>

<p>所以总结来说就是：<strong>SQL 先根据 ON 生成一张临时表，然后再根据 WHERE 对临时表进行筛选</strong>。</p>

<p>SQL 允许在 <code class="language-plaintext highlighter-rouge">JOIN</code> 左边加上一些修饰性的关键词，从而形成不同类型的连接，如下表所示：</p>

<table>
  <thead>
    <tr>
      <th>连接类型</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>INNER JOIN 内连接</td>
      <td>（默认连接方式）只有当两个表都存在满足条件的记录时才会返回行。</td>
    </tr>
    <tr>
      <td>LEFT JOIN / LEFT OUTER JOIN 左(外)连接</td>
      <td>返回左表中的所有行，即使右表中没有满足条件的行也是如此。</td>
    </tr>
    <tr>
      <td>RIGHT JOIN / RIGHT OUTER JOIN 右(外)连接</td>
      <td>返回右表中的所有行，即使左表中没有满足条件的行也是如此。</td>
    </tr>
    <tr>
      <td>FULL JOIN / FULL OUTER JOIN 全(外)连接</td>
      <td>只要其中有一个表存在满足条件的记录，就返回行。</td>
    </tr>
    <tr>
      <td>SELF JOIN</td>
      <td>将一个表连接到自身，就像该表是两个表一样。为了区分两个表，在 SQL 语句中需要至少重命名一个表。</td>
    </tr>
    <tr>
      <td>CROSS JOIN</td>
      <td>交叉连接，从两个或者多个连接表中返回记录集的笛卡尔积。</td>
    </tr>
  </tbody>
</table>

<p>下图展示了 LEFT JOIN、RIGHT JOIN、INNER JOIN、OUTER JOIN 相关的 7 种用法。</p>

<p><img src="https://oss.javaguide.cn/github/javaguide/csdn/d1794312b448516831369f869814ab39.png" alt="" /></p>

<p>如果不加任何修饰词，只写 <code class="language-plaintext highlighter-rouge">JOIN</code>，那么默认为 <code class="language-plaintext highlighter-rouge">INNER JOIN</code></p>

<p>对于 <code class="language-plaintext highlighter-rouge">INNER JOIN</code> 来说，还有一种隐式的写法，称为 “<strong>隐式内连接</strong>”，也就是没有 <code class="language-plaintext highlighter-rouge">INNER JOIN</code> 关键字，使用 <code class="language-plaintext highlighter-rouge">WHERE</code> 语句实现内连接的功能</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">隐式内连接</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span><span class="p">,</span><span class="n">Orders</span> <span class="n">o</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span>

<span class="o">#</span> <span class="err">显式内连接</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="n">o</span>
<span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="返回顾客名称和相关订单号">返回顾客名称和相关订单号</h3>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表有字段顾客名称 <code class="language-plaintext highlighter-rouge">cust_name</code>、顾客 id <code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>cust22</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>cust221</td>
      <td>an</td>
    </tr>
    <tr>
      <td>cust2217</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 订单信息表，含有字段 <code class="language-plaintext highlighter-rouge">order_num</code> 订单号、<code class="language-plaintext highlighter-rouge">cust_id</code> 顾客 id</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust22</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust221</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust2217</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回 <code class="language-plaintext highlighter-rouge">Customers</code> 表中的顾客名称（<code class="language-plaintext highlighter-rouge">cust_name</code>）和 <code class="language-plaintext highlighter-rouge">Orders</code> 表中的相关订单号（<code class="language-plaintext highlighter-rouge">order_num</code>），并按顾客名称再按订单号对结果进行升序排序。你可以尝试用两个不同的写法，一个使用简单的等连接语法，另外一个使用 INNER JOIN。</p>

<p>答案：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">隐式内连接</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span><span class="p">,</span><span class="n">Orders</span> <span class="n">o</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span><span class="n">o</span><span class="p">.</span><span class="n">order_num</span>

<span class="o">#</span> <span class="err">显式内连接</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="n">o</span>
<span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span><span class="n">o</span><span class="p">.</span><span class="n">order_num</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="返回顾客名称和相关订单号以及每个订单的总价">返回顾客名称和相关订单号以及每个订单的总价</h3>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表有字段，顾客名称：<code class="language-plaintext highlighter-rouge">cust_name</code>、顾客 id：<code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>cust22</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>cust221</td>
      <td>an</td>
    </tr>
    <tr>
      <td>cust2217</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 订单信息表，含有字段，订单号：<code class="language-plaintext highlighter-rouge">order_num</code>、顾客 id：<code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust22</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust221</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust2217</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表有字段，商品订单号：<code class="language-plaintext highlighter-rouge">order_num</code>、商品数量：<code class="language-plaintext highlighter-rouge">quantity</code>、商品价格：<code class="language-plaintext highlighter-rouge">item_price</code></p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>quantity</th>
      <th>item_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>1000</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>200</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>10</td>
      <td>15</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>25</td>
      <td>50</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>15</td>
      <td>25</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>

<p>【问题】除了返回顾客名称和订单号，返回 <code class="language-plaintext highlighter-rouge">Customers</code> 表中的顾客名称（<code class="language-plaintext highlighter-rouge">cust_name</code>）和 <code class="language-plaintext highlighter-rouge">Orders</code> 表中的相关订单号（<code class="language-plaintext highlighter-rouge">order_num</code>），添加第三列 <code class="language-plaintext highlighter-rouge">OrderTotal</code>，其中包含每个订单的总价，并按顾客名称再按订单号对结果进行升序排序。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">简单的等连接语法</span>
<span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">item_price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">OrderTotal</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span><span class="p">,</span><span class="n">Orders</span> <span class="n">o</span><span class="p">,</span><span class="n">OrderItems</span> <span class="n">oi</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span> <span class="k">AND</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">oi</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
</code></pre></div></div>

<p>注意，可能有小伙伴会这样写：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">item_price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">OrderTotal</span>
<span class="k">FROM</span> <span class="n">Customers</span> <span class="k">c</span><span class="p">,</span><span class="n">Orders</span> <span class="n">o</span><span class="p">,</span><span class="n">OrderItems</span> <span class="n">oi</span>
<span class="k">WHERE</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">cust_id</span> <span class="k">AND</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">oi</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">.</span><span class="n">cust_name</span><span class="p">,</span><span class="n">o</span><span class="p">.</span><span class="n">order_num</span>
</code></pre></div></div>

<p>这是错误的！只对 <code class="language-plaintext highlighter-rouge">cust_name</code> 进行聚类确实符合题意，但是不符合 <code class="language-plaintext highlighter-rouge">GROUP BY</code> 的语法。</p>

<p>select 语句中，如果没有 <code class="language-plaintext highlighter-rouge">GROUP BY</code> 语句，那么 <code class="language-plaintext highlighter-rouge">cust_name</code>、<code class="language-plaintext highlighter-rouge">order_num</code> 会返回若干个值，而 <code class="language-plaintext highlighter-rouge">sum(quantity * item_price)</code> 只返回一个值，通过 <code class="language-plaintext highlighter-rouge">group by</code> <code class="language-plaintext highlighter-rouge">cust_name</code> 可以让 <code class="language-plaintext highlighter-rouge">cust_name</code> 和 <code class="language-plaintext highlighter-rouge">sum(quantity * item_price)</code> 一一对应起来，或者说<strong>聚类</strong>，所以同样的，也要对 <code class="language-plaintext highlighter-rouge">order_num</code> 进行聚类。</p>

<blockquote>
  <p><strong>一句话，select 中的字段要么都聚类，要么都不聚类</strong></p>
</blockquote>

<h3 id="确定哪些订单购买了-prod_id-为-br01-的产品二">确定哪些订单购买了 prod_id 为 BR01 的产品（二）</h3>

<p>表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品信息表，<code class="language-plaintext highlighter-rouge">prod_id</code> 为产品 id；<code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单表有 <code class="language-plaintext highlighter-rouge">cust_id</code> 代表顾客 id 和订单日期 <code class="language-plaintext highlighter-rouge">order_date</code></p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BR01</td>
      <td>a0001</td>
    </tr>
    <tr>
      <td>BR01</td>
      <td>a0002</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0003</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0013</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>cust10</td>
      <td>2022-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>cust1</td>
      <td>2022-01-01 00:01:00</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cust1</td>
      <td>2022-01-02 00:00:00</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>cust2</td>
      <td>2022-01-01 00:20:00</td>
    </tr>
  </tbody>
</table>

<p>【问题】</p>

<p>编写 SQL 语句，使用子查询来确定哪些订单（在 <code class="language-plaintext highlighter-rouge">OrderItems</code> 中）购买了 <code class="language-plaintext highlighter-rouge">prod_id</code> 为 “BR01” 的产品，然后从 <code class="language-plaintext highlighter-rouge">Orders</code> 表中返回每个产品对应的顾客 ID（<code class="language-plaintext highlighter-rouge">cust_id</code>）和订单日期（<code class="language-plaintext highlighter-rouge">order_date</code>），按订购日期对结果进行升序排序。</p>

<p>提示：这一次使用连接和简单的等连接语法。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">写法</span> <span class="mi">1</span><span class="err">：子查询</span>
<span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">WHERE</span> <span class="n">order_num</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">2</span><span class="err">：连接表</span> <span class="k">inner</span> <span class="k">join</span>
<span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span> <span class="n">o</span> <span class="k">INNER</span> <span class="k">JOIN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">order_num</span>
    <span class="k">FROM</span> <span class="n">OrderItems</span>
    <span class="k">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span><span class="p">)</span> <span class="n">tb</span> <span class="k">ON</span> <span class="n">o</span><span class="p">.</span><span class="n">order_num</span> <span class="o">=</span> <span class="n">tb</span><span class="p">.</span><span class="n">order_num</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>

<span class="o">#</span> <span class="err">写法</span> <span class="mi">3</span><span class="err">：写法</span> <span class="mi">2</span> <span class="err">的简化版</span>
<span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">order_date</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderItems</span> <span class="k">USING</span><span class="p">(</span><span class="n">order_num</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">OrderItems</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_date</span>
</code></pre></div></div>

<h3 id="返回购买-prod_id-为-br01-的产品的所有顾客的电子邮件二">返回购买 prod_id 为 BR01 的产品的所有顾客的电子邮件（二）</h3>

<p>有表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 代表订单商品信息表，<code class="language-plaintext highlighter-rouge">prod_id</code> 为产品 id；<code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单表有 <code class="language-plaintext highlighter-rouge">cust_id</code> 代表顾客 id 和订单日期 <code class="language-plaintext highlighter-rouge">order_date</code>；<code class="language-plaintext highlighter-rouge">Customers</code> 表含有 <code class="language-plaintext highlighter-rouge">cust_email</code> 顾客邮件和 cust_id 顾客 id</p>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BR01</td>
      <td>a0001</td>
    </tr>
    <tr>
      <td>BR01</td>
      <td>a0002</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0003</td>
    </tr>
    <tr>
      <td>BR02</td>
      <td>a0013</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表：</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
      <th>order_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>cust10</td>
      <td>2022-01-01 00:00:00</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>cust1</td>
      <td>2022-01-01 00:01:00</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cust1</td>
      <td>2022-01-02 00:00:00</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>cust2</td>
      <td>2022-01-01 00:20:00</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表代表顾客信息，<code class="language-plaintext highlighter-rouge">cust_id</code> 为顾客 id，<code class="language-plaintext highlighter-rouge">cust_email</code> 为顾客 email</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td><a href="mailto:cust10@cust.com">cust10@cust.com</a></td>
    </tr>
    <tr>
      <td>cust1</td>
      <td><a href="mailto:cust1@cust.com">cust1@cust.com</a></td>
    </tr>
    <tr>
      <td>cust2</td>
      <td><a href="mailto:cust2@cust.com">cust2@cust.com</a></td>
    </tr>
  </tbody>
</table>

<p>【问题】返回购买 <code class="language-plaintext highlighter-rouge">prod_id</code> 为 BR01 的产品的所有顾客的电子邮件（<code class="language-plaintext highlighter-rouge">Customers</code> 表中的 <code class="language-plaintext highlighter-rouge">cust_email</code>），结果无需排序。</p>

<p>提示：涉及到 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句，最内层的从 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表返回 <code class="language-plaintext highlighter-rouge">order_num</code>，中间的从 <code class="language-plaintext highlighter-rouge">Customers</code> 表返回 <code class="language-plaintext highlighter-rouge">cust_id</code>，但是必须使用 INNER JOIN 语法。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="k">using</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderItems</span> <span class="k">using</span><span class="p">(</span><span class="n">order_num</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">OrderItems</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="s1">'BR01'</span>
</code></pre></div></div>

<h3 id="确定最佳顾客的另一种方式二">确定最佳顾客的另一种方式（二）</h3>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表代表订单信息，确定最佳顾客的另一种方式是看他们花了多少钱，<code class="language-plaintext highlighter-rouge">OrderItems</code> 表有订单号 <code class="language-plaintext highlighter-rouge">order_num</code> 和 <code class="language-plaintext highlighter-rouge">item_price</code> 商品售出价格、<code class="language-plaintext highlighter-rouge">quantity</code> 商品数量</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>item_price</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>10</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>1100</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>2</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>5</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>1</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>7</td>
      <td>5</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表含有字段 <code class="language-plaintext highlighter-rouge">order_num</code> 订单号、<code class="language-plaintext highlighter-rouge">cust_id</code> 顾客 id</p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust22</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust221</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust2217</td>
    </tr>
  </tbody>
</table>

<p>顾客表 <code class="language-plaintext highlighter-rouge">Customers</code> 有字段 <code class="language-plaintext highlighter-rouge">cust_id</code> 客户 id、<code class="language-plaintext highlighter-rouge">cust_name</code> 客户姓名</p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>cust22</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>cust221</td>
      <td>an</td>
    </tr>
    <tr>
      <td>cust2217</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，返回订单总价不小于 1000 的客户名称和总额（<code class="language-plaintext highlighter-rouge">OrderItems</code> 表中的 <code class="language-plaintext highlighter-rouge">order_num</code>）。</p>

<p>提示：需要计算总和（<code class="language-plaintext highlighter-rouge">item_price</code> 乘以 <code class="language-plaintext highlighter-rouge">quantity</code>）。按总额对结果进行排序，请使用 <code class="language-plaintext highlighter-rouge">INNER JOIN</code>语法。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">item_price</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_price</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span> <span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">OrderItems</span> <span class="k">USING</span><span class="p">(</span><span class="n">order_num</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">cust_name</span>
<span class="k">HAVING</span> <span class="n">total_price</span> <span class="o">&gt;=</span> <span class="mi">1000</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">total_price</span>
</code></pre></div></div>

<h2 id="创建高级连接">创建高级连接</h2>

<h3 id="检索每个顾客的名称和所有的订单号一">检索每个顾客的名称和所有的订单号（一）</h3>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表代表顾客信息含有顾客 id <code class="language-plaintext highlighter-rouge">cust_id</code> 和 顾客名称 <code class="language-plaintext highlighter-rouge">cust_name</code></p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>cust22</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>cust221</td>
      <td>an</td>
    </tr>
    <tr>
      <td>cust2217</td>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单信息含有订单号 <code class="language-plaintext highlighter-rouge">order_num</code> 和顾客 id <code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust22</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust221</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust2217</td>
    </tr>
  </tbody>
</table>

<p>【问题】使用 INNER JOIN 编写 SQL 语句，检索每个顾客的名称（<code class="language-plaintext highlighter-rouge">Customers</code> 表中的 <code class="language-plaintext highlighter-rouge">cust_name</code>）和所有的订单号（<code class="language-plaintext highlighter-rouge">Orders</code> 表中的 <code class="language-plaintext highlighter-rouge">order_num</code>），最后根据顾客姓名 <code class="language-plaintext highlighter-rouge">cust_name</code> 升序返回。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span>
<span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span>
</code></pre></div></div>

<h3 id="检索每个顾客的名称和所有的订单号二">检索每个顾客的名称和所有的订单号（二）</h3>

<p><code class="language-plaintext highlighter-rouge">Orders</code> 表代表订单信息含有订单号 <code class="language-plaintext highlighter-rouge">order_num</code> 和顾客 id <code class="language-plaintext highlighter-rouge">cust_id</code></p>

<table>
  <thead>
    <tr>
      <th>order_num</th>
      <th>cust_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a1</td>
      <td>cust10</td>
    </tr>
    <tr>
      <td>a2</td>
      <td>cust1</td>
    </tr>
    <tr>
      <td>a3</td>
      <td>cust2</td>
    </tr>
    <tr>
      <td>a4</td>
      <td>cust22</td>
    </tr>
    <tr>
      <td>a5</td>
      <td>cust221</td>
    </tr>
    <tr>
      <td>a7</td>
      <td>cust2217</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">Customers</code> 表代表顾客信息含有顾客 id <code class="language-plaintext highlighter-rouge">cust_id</code> 和 顾客名称 <code class="language-plaintext highlighter-rouge">cust_name</code></p>

<table>
  <thead>
    <tr>
      <th>cust_id</th>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>andy</td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>ben</td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>tony</td>
    </tr>
    <tr>
      <td>cust22</td>
      <td>tom</td>
    </tr>
    <tr>
      <td>cust221</td>
      <td>an</td>
    </tr>
    <tr>
      <td>cust2217</td>
      <td>hex</td>
    </tr>
    <tr>
      <td>cust40</td>
      <td>ace</td>
    </tr>
  </tbody>
</table>

<p>【问题】检索每个顾客的名称（<code class="language-plaintext highlighter-rouge">Customers</code> 表中的 <code class="language-plaintext highlighter-rouge">cust_name</code>）和所有的订单号（Orders 表中的 <code class="language-plaintext highlighter-rouge">order_num</code>），列出所有的顾客，即使他们没有下过订单。最后根据顾客姓名 <code class="language-plaintext highlighter-rouge">cust_name</code> 升序返回。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Orders</span>
<span class="k">USING</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span>
</code></pre></div></div>

<h3 id="返回产品名称和与之相关的订单号">返回产品名称和与之相关的订单号</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表为产品信息表含有字段 <code class="language-plaintext highlighter-rouge">prod_id</code> 产品 id、<code class="language-plaintext highlighter-rouge">prod_name</code> 产品名称</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>egg</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>sockets</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>coffee</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cola</td>
    </tr>
    <tr>
      <td>a0023</td>
      <td>soda</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表为订单信息表含有字段 <code class="language-plaintext highlighter-rouge">order_num</code> 订单号和产品 id <code class="language-plaintext highlighter-rouge">prod_id</code></p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>a105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>a1100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>a200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>a1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a5</td>
    </tr>
  </tbody>
</table>

<p>【问题】使用外连接（left join、 right join、full join）联结 <code class="language-plaintext highlighter-rouge">Products</code> 表和 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表，返回产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和与之相关的订单号（<code class="language-plaintext highlighter-rouge">order_num</code>）的列表，并按照产品名称升序排序。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">order_num</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">OrderItems</span>
<span class="k">USING</span><span class="p">(</span><span class="n">prod_id</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_name</span>
</code></pre></div></div>

<h3 id="返回产品名称和每一项产品的总订单数">返回产品名称和每一项产品的总订单数</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表为产品信息表含有字段 <code class="language-plaintext highlighter-rouge">prod_id</code> 产品 id、<code class="language-plaintext highlighter-rouge">prod_name</code> 产品名称</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>prod_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>egg</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>sockets</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>coffee</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>cola</td>
    </tr>
    <tr>
      <td>a0023</td>
      <td>soda</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">OrderItems</code> 表为订单信息表含有字段 <code class="language-plaintext highlighter-rouge">order_num</code> 订单号和产品 id <code class="language-plaintext highlighter-rouge">prod_id</code></p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>order_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>a105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>a1100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>a200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>a1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>a5</td>
    </tr>
  </tbody>
</table>

<p>【问题】</p>

<p>使用 OUTER JOIN 联结 <code class="language-plaintext highlighter-rouge">Products</code> 表和 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表，返回产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和每一项产品的总订单数（不是订单号），并按产品名称升序排序。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_name</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">order_num</span><span class="p">)</span> <span class="k">AS</span> <span class="n">orders</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">OrderItems</span>
<span class="k">USING</span><span class="p">(</span><span class="n">prod_id</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">prod_name</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_name</span>
</code></pre></div></div>

<h3 id="列出供应商及其可供产品的数量">列出供应商及其可供产品的数量</h3>

<p>有 <code class="language-plaintext highlighter-rouge">Vendors</code> 表含有 <code class="language-plaintext highlighter-rouge">vend_id</code> （供应商 id）</p>

<table>
  <thead>
    <tr>
      <th>vend_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0002</td>
    </tr>
    <tr>
      <td>a0013</td>
    </tr>
    <tr>
      <td>a0003</td>
    </tr>
    <tr>
      <td>a0010</td>
    </tr>
  </tbody>
</table>

<p>有 <code class="language-plaintext highlighter-rouge">Products</code> 表含有 <code class="language-plaintext highlighter-rouge">vend_id</code>（供应商 id）和 prod_id（供应产品 id）</p>

<table>
  <thead>
    <tr>
      <th>vend_id</th>
      <th>prod_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>egg</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>prod_id_iphone</td>
    </tr>
    <tr>
      <td>a00113</td>
      <td>prod_id_tea</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>prod_id_vivo phone</td>
    </tr>
    <tr>
      <td>a0010</td>
      <td>prod_id_huawei phone</td>
    </tr>
  </tbody>
</table>

<p>【问题】列出供应商（<code class="language-plaintext highlighter-rouge">Vendors</code> 表中的 <code class="language-plaintext highlighter-rouge">vend_id</code>）及其可供产品的数量，包括没有产品的供应商。你需要使用 OUTER JOIN 和 COUNT()聚合函数来计算 <code class="language-plaintext highlighter-rouge">Products</code> 表中每种产品的数量，最后根据 vend_id 升序排序。</p>

<p>注意：<code class="language-plaintext highlighter-rouge">vend_id</code> 列会显示在多个表中，因此在每次引用它时都需要完全限定它。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">v</span><span class="p">.</span><span class="n">vend_id</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">prod_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">prod_id</span>
<span class="k">FROM</span> <span class="n">Vendors</span> <span class="n">v</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">Products</span> <span class="n">p</span>
<span class="k">USING</span><span class="p">(</span><span class="n">vend_id</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">v</span><span class="p">.</span><span class="n">vend_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">v</span><span class="p">.</span><span class="n">vend_id</span>
</code></pre></div></div>

<h2 id="组合查询">组合查询</h2>

<p><code class="language-plaintext highlighter-rouge">UNION</code> 运算符将两个或更多查询的结果组合起来，并生成一个结果集，其中包含来自 <code class="language-plaintext highlighter-rouge">UNION</code> 中参与查询的提取行。</p>

<p><code class="language-plaintext highlighter-rouge">UNION</code> 基本规则：</p>

<ul>
  <li>所有查询的列数和列顺序必须相同。</li>
  <li>每个查询中涉及表的列的数据类型必须相同或兼容。</li>
  <li>通常返回的列名取自第一个查询。</li>
</ul>

<p>默认地，<code class="language-plaintext highlighter-rouge">UNION</code> 操作符选取不同的值。如果允许重复的值，请使用 <code class="language-plaintext highlighter-rouge">UNION ALL</code>。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">UNION</code> 结果集中的列名总是等于 <code class="language-plaintext highlighter-rouge">UNION</code> 中第一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句中的列名。</p>

<p><code class="language-plaintext highlighter-rouge">JOIN</code> vs <code class="language-plaintext highlighter-rouge">UNION</code>：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">JOIN</code> 中连接表的列可能不同，但在 <code class="language-plaintext highlighter-rouge">UNION</code> 中，所有查询的列数和列顺序必须相同。</li>
  <li><code class="language-plaintext highlighter-rouge">UNION</code> 将查询之后的行放在一起（垂直放置），但 <code class="language-plaintext highlighter-rouge">JOIN</code> 将查询之后的列放在一起（水平放置），即它构成一个笛卡尔积。</li>
</ul>

<h3 id="将两个-select-语句结合起来一">将两个 SELECT 语句结合起来（一）</h3>

<p>表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 包含订单产品信息，字段 <code class="language-plaintext highlighter-rouge">prod_id</code> 代表产品 id、<code class="language-plaintext highlighter-rouge">quantity</code> 代表产品数量</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>5</td>
    </tr>
    <tr>
      <td>BNBG</td>
      <td>10002</td>
    </tr>
  </tbody>
</table>

<p>【问题】将两个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句结合起来，以便从 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表中检索产品 id（<code class="language-plaintext highlighter-rouge">prod_id</code>）和 <code class="language-plaintext highlighter-rouge">quantity</code>。其中，一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句过滤数量为 100 的行，另一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句过滤 id 以 BNBG 开头的产品，最后按产品 id 对结果进行升序排序。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">quantity</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">WHERE</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">quantity</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">WHERE</span> <span class="n">prod_id</span> <span class="k">LIKE</span> <span class="s1">'BNBG%'</span>
</code></pre></div></div>

<h3 id="将两个-select-语句结合起来二">将两个 SELECT 语句结合起来（二）</h3>

<p>表 <code class="language-plaintext highlighter-rouge">OrderItems</code> 包含订单产品信息，字段 <code class="language-plaintext highlighter-rouge">prod_id</code> 代表产品 id、<code class="language-plaintext highlighter-rouge">quantity</code> 代表产品数量。</p>

<table>
  <thead>
    <tr>
      <th>prod_id</th>
      <th>quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>a0001</td>
      <td>105</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>100</td>
    </tr>
    <tr>
      <td>a0002</td>
      <td>200</td>
    </tr>
    <tr>
      <td>a0013</td>
      <td>1121</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>10</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>19</td>
    </tr>
    <tr>
      <td>a0003</td>
      <td>5</td>
    </tr>
    <tr>
      <td>BNBG</td>
      <td>10002</td>
    </tr>
  </tbody>
</table>

<p>【问题】将两个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句结合起来，以便从 <code class="language-plaintext highlighter-rouge">OrderItems</code> 表中检索产品 id（<code class="language-plaintext highlighter-rouge">prod_id</code>）和 <code class="language-plaintext highlighter-rouge">quantity</code>。其中，一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句过滤数量为 100 的行，另一个 <code class="language-plaintext highlighter-rouge">SELECT</code> 语句过滤 id 以 BNBG 开头的产品，最后按产品 id 对结果进行升序排序。 注意：<strong>这次仅使用单个 SELECT 语句。</strong></p>

<p>答案：</p>

<p>要求只用一条 select 语句，那就用 <code class="language-plaintext highlighter-rouge">or</code> 不用 <code class="language-plaintext highlighter-rouge">union</code> 了。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">quantity</span>
<span class="k">FROM</span> <span class="n">OrderItems</span>
<span class="k">WHERE</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">100</span> <span class="k">OR</span> <span class="n">prod_id</span> <span class="k">LIKE</span> <span class="s1">'BNBG%'</span>
</code></pre></div></div>

<h3 id="组合-products-表中的产品名称和-customers-表中的顾客名称">组合 Products 表中的产品名称和 Customers 表中的顾客名称</h3>

<p><code class="language-plaintext highlighter-rouge">Products</code> 表含有字段 <code class="language-plaintext highlighter-rouge">prod_name</code> 代表产品名称</p>

<table>
  <thead>
    <tr>
      <th>prod_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>flower</td>
    </tr>
    <tr>
      <td>rice</td>
    </tr>
    <tr>
      <td>ring</td>
    </tr>
    <tr>
      <td>umbrella</td>
    </tr>
  </tbody>
</table>

<p>Customers 表代表顾客信息，cust_name 代表顾客名称</p>

<table>
  <thead>
    <tr>
      <th>cust_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>andy</td>
    </tr>
    <tr>
      <td>ben</td>
    </tr>
    <tr>
      <td>tony</td>
    </tr>
    <tr>
      <td>tom</td>
    </tr>
    <tr>
      <td>an</td>
    </tr>
    <tr>
      <td>lee</td>
    </tr>
    <tr>
      <td>hex</td>
    </tr>
  </tbody>
</table>

<p>【问题】编写 SQL 语句，组合 <code class="language-plaintext highlighter-rouge">Products</code> 表中的产品名称（<code class="language-plaintext highlighter-rouge">prod_name</code>）和 <code class="language-plaintext highlighter-rouge">Customers</code> 表中的顾客名称（<code class="language-plaintext highlighter-rouge">cust_name</code>）并返回，然后按产品名称对结果进行升序排序。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="k">UNION</span> <span class="err">结果集中的列名总是等于</span> <span class="k">UNION</span> <span class="err">中第一个</span> <span class="k">SELECT</span> <span class="err">语句中的列名。</span>
<span class="k">SELECT</span> <span class="n">prod_name</span>
<span class="k">FROM</span> <span class="n">Products</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">cust_name</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_name</span>
</code></pre></div></div>

<h3 id="检查-sql-语句-3">检查 SQL 语句</h3>

<p>表 <code class="language-plaintext highlighter-rouge">Customers</code> 含有字段 <code class="language-plaintext highlighter-rouge">cust_name</code> 顾客名、<code class="language-plaintext highlighter-rouge">cust_contact</code> 顾客联系方式、<code class="language-plaintext highlighter-rouge">cust_state</code> 顾客州、<code class="language-plaintext highlighter-rouge">cust_email</code> 顾客 <code class="language-plaintext highlighter-rouge">email</code></p>

<table>
  <thead>
    <tr>
      <th>cust_name</th>
      <th>cust_contact</th>
      <th>cust_state</th>
      <th>cust_email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cust10</td>
      <td>8695192</td>
      <td>MI</td>
      <td><a href="mailto:cust10@cust.com">cust10@cust.com</a></td>
    </tr>
    <tr>
      <td>cust1</td>
      <td>8695193</td>
      <td>MI</td>
      <td><a href="mailto:cust1@cust.com">cust1@cust.com</a></td>
    </tr>
    <tr>
      <td>cust2</td>
      <td>8695194</td>
      <td>IL</td>
      <td><a href="mailto:cust2@cust.com">cust2@cust.com</a></td>
    </tr>
  </tbody>
</table>

<p>【问题】修正下面错误的 SQL</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span><span class="p">,</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'MI'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span><span class="p">;</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span><span class="p">,</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'IL'</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span><span class="p">;</span>
</code></pre></div></div>

<p>修正后：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span><span class="p">,</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'MI'</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span><span class="p">,</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'IL'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span><span class="p">;</span>
</code></pre></div></div>

<p>使用 <code class="language-plaintext highlighter-rouge">union</code> 组合查询时，只能使用一条 <code class="language-plaintext highlighter-rouge">order by</code> 字句，他必须位于最后一条 <code class="language-plaintext highlighter-rouge">select</code> 语句之后</p>

<p>或者直接用 <code class="language-plaintext highlighter-rouge">or</code> 来做：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span><span class="p">,</span> <span class="n">cust_email</span>
<span class="k">FROM</span> <span class="n">Customers</span>
<span class="k">WHERE</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'MI'</span> <span class="k">or</span> <span class="n">cust_state</span> <span class="o">=</span> <span class="s1">'IL'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">cust_name</span><span class="p">;</span>
</code></pre></div></div>

<!-- @include: @article-footer.snippet.md -->
