<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-11-06T06:05:34+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">å°_å±®ã€çš„åšå®¢æ—¥è®°</title><subtitle>WordPressæ”¶è´¹ï¼ŒGhoståˆå¤ªå¤§äº†ï¼Œ2æ ¸2Gçš„æœåŠ¡å™¨è·‘ä¸èµ·æ¥ã€‚ã€‚è¿˜å¾—æ˜¯jekyllğŸ¥°</subtitle><entry><title type="html">Welcome to Jekyll!</title><link href="http://localhost:4000/jekyll/update/2024/09/24/welcome-to-jekyll.html" rel="alternate" type="text/html" title="Welcome to Jekyll!" /><published>2024-09-24T11:23:41+08:00</published><updated>2024-09-24T11:23:41+08:00</updated><id>http://localhost:4000/jekyll/update/2024/09/24/welcome-to-jekyll</id><content type="html" xml:base="http://localhost:4000/jekyll/update/2024/09/24/welcome-to-jekyll.html"><![CDATA[<p>Youâ€™ll find this post in your <code class="language-plaintext highlighter-rouge">_posts</code> directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run <code class="language-plaintext highlighter-rouge">jekyll serve</code>, which launches a web server and auto-regenerates your site when a file is updated.</p>

<p>Jekyll requires blog post files to be named according to the following format:</p>

<p><code class="language-plaintext highlighter-rouge">YEAR-MONTH-DAY-title.MARKUP</code></p>

<p>Where <code class="language-plaintext highlighter-rouge">YEAR</code> is a four-digit number, <code class="language-plaintext highlighter-rouge">MONTH</code> and <code class="language-plaintext highlighter-rouge">DAY</code> are both two-digit numbers, and <code class="language-plaintext highlighter-rouge">MARKUP</code> is the file extension representing the format used in the file. After that, include the necessary front matter. Take a look at the source for this post to get an idea about how it works.</p>

<p>Jekyll also offers powerful support for code snippets:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">print_hi</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Hi, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="n">print_hi</span><span class="p">(</span><span class="s1">'Tom'</span><span class="p">)</span>
<span class="c1">#=&gt; prints 'Hi, Tom' to STDOUT.</span></code></pre></figure>

<p>Check out the <a href="https://jekyllrb.com/docs/home">Jekyll docs</a> for more info on how to get the most out of Jekyll. File all bugs/feature requests at <a href="https://github.com/jekyll/jekyll">Jekyllâ€™s GitHub repo</a>. If you have questions, you can ask them on <a href="https://talk.jekyllrb.com/">Jekyll Talk</a>.</p>]]></content><author><name></name></author><category term="jekyll" /><category term="update" /><summary type="html"><![CDATA[Youâ€™ll find this post in your _posts directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run jekyll serve, which launches a web server and auto-regenerates your site when a file is updated.]]></summary></entry><entry><title type="html">è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰</title><link href="http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html" rel="alternate" type="text/html" title="è™šæ‹Ÿæœº Centos K8säºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆæœªæˆåŠŸï¼‰" /><published>2024-09-13T00:00:00+08:00</published><updated>2024-09-13T00:00:00+08:00</updated><id>http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2%EF%BC%88%E6%9C%AA%E6%88%90%E5%8A%9F%EF%BC%89</id><content type="html" xml:base="http://localhost:4000/2024/09/13/%E8%99%9A%E6%8B%9F%E6%9C%BA-CentOS-k8s%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%83%A8%E7%BD%B2-%E6%9C%AA%E6%88%90%E5%8A%9F.html"><![CDATA[<p>æœåŠ¡å™¨å¯†ç  mfhk12xx</p>

<p>æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œé€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æœ€è¿‘æŠ¥é”™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>journalctl -xe
</code></pre></div></div>

<p>ä¹Ÿå¯é€šè¿‡æŒ‡ä»¤æŸ¥çœ‹æœ€è¿‘æœåŠ¡çš„æ—¥å¿—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tail -f /var/log/messages
</code></pre></div></div>

<p>æŸ¥çœ‹ETCDå¥åº·çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_PREFIX='ETCDCTL_API=3 etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379" --write-out=table'
eval "${ETCD_PREFIX} endpoint health"
</code></pre></div></div>

<p>æŸ¥çœ‹masterç»„ä»¶å¥åº·çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status kube-proxy
systemctl status kubelet
systemctl status kube-scheduler
systemctl status kube-controller-manager
systemctl status kube-apiserver
kubectl get cs
</code></pre></div></div>

<h1 id="å‰ç½®æ“ä½œ">å‰ç½®æ“ä½œ</h1>

<h2 id="æå¥‡æ•°å°linuxæœåŠ¡å™¨">æå¥‡æ•°å°linuxæœåŠ¡å™¨</h2>

<p>æ€ä¹ˆæçš„ç•¥ï¼Œæˆ‘æäº†ä¸‰ä¸ª</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">host</th>
      <th style="text-align: center">ip</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">k8s-master</td>
      <td style="text-align: center">192.168.100.100</td>
    </tr>
    <tr>
      <td style="text-align: center">k8s-node1</td>
      <td style="text-align: center">192.168.100.101</td>
    </tr>
    <tr>
      <td style="text-align: center">k8s-node2</td>
      <td style="text-align: center">192.168.100.102</td>
    </tr>
  </tbody>
</table>

<h2 id="åˆ†é…å¥½ä¸»ä»èŠ‚ç‚¹">åˆ†é…å¥½ä¸»ä»èŠ‚ç‚¹</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; /etc/hosts &lt;&lt;EOF
192.168.100.100 k8s-master
192.168.100.101 k8s-node1
192.168.100.102 k8s-node2
EOF

</code></pre></div></div>

<h2 id="å…³é—­é˜²ç«å¢™">å…³é—­é˜²ç«å¢™</h2>

<p>è¿™æ ·çš„æ¯”è¾ƒæ–¹ä¾¿</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop firewalld
systemctl disable firewalld

</code></pre></div></div>

<h2 id="å…³é—­swap">å…³é—­swap</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -ri 's/.*swap.*/#&amp;/' /etc/fstab #æ°¸ä¹…
#swapoff -a   #ä¸´æ—¶

</code></pre></div></div>

<h2 id="å…³é—­selinux">å…³é—­selinux</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -i 's/enforcing/disabled/' /etc/selinux/config  #æ°¸ä¹…
#setenforce 0  # ä¸´æ—¶ 

</code></pre></div></div>

<h2 id="æ¡¥æ¥æµé‡è½¬å‘">æ¡¥æ¥æµé‡è½¬å‘</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt;EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv6.conf.all.disable_ipv6=1
net.ipv4.ip_forward=1
EOF
sysctl --system

</code></pre></div></div>

<h2 id="æ—¶é—´åŒæ­¥">æ—¶é—´åŒæ­¥</h2>

<p>æ¯ä¸€å°æœåŠ¡å™¨éƒ½æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install ntpdate -y
ntpdate time.windows.com

</code></pre></div></div>

<h2 id="ä¸»æœºåè§„åˆ’">ä¸»æœºåè§„åˆ’</h2>

<p>æŒ‰ç…§è§„åˆ’åœ¨å¯¹åº”ipçš„æœåŠ¡å™¨æ‰§è¡Œå¯¹åº”çš„set-hostname</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hostnamectl set-hostname k8s-master 
hostnamectl set-hostname k8s-node1
hostnamectl set-hostname k8s-node2

</code></pre></div></div>

<h2 id="æœåŠ¡éƒ¨ç½²">æœåŠ¡éƒ¨ç½²</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ip</th>
      <th style="text-align: center">host</th>
      <th style="text-align: center">æœåŠ¡</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">192.168.100.100</td>
      <td style="text-align: center">k8s-master</td>
      <td style="text-align: center">kube-proxy<br />kubelet<br />kube-scheduler<br />kube-controller-manager<br />kube-apiserver</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.100.101</td>
      <td style="text-align: center">k8s-node1</td>
      <td style="text-align: center">kube-proxy<br />kubelet</td>
    </tr>
    <tr>
      <td style="text-align: center">192.168.100.102</td>
      <td style="text-align: center">k8s-node2</td>
      <td style="text-align: center">kube-proxy<br />kubelet</td>
    </tr>
  </tbody>
</table>

<h1 id="éƒ¨ç½²etcd">éƒ¨ç½²ETCD</h1>

<h2 id="ä¸‹è½½cfssl">ä¸‹è½½cfssl</h2>

<p>åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šä¸‹è½½å°±è¡Œäº†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssl_1.6.3_linux_amd64 -O /usr/local/bin/cfssl
wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssljson_1.6.3_linux_amd64 -O /usr/local/bin/cfssljson
wget https://github.com/cloudflare/cfssl/releases/download/v1.6.3/cfssl-certinfo_1.6.3_linux_amd64 -O /usr/local/bin/cfssl-certinfo

chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson /usr/local/bin/cfssl-certinfo 

cp cfssl_1.6.3_linux_amd64 cfssl
cp cfssl-certinfo_1.6.3_linux_amd64 cfssl-certinfo
cp cfssljson_1.6.3_linux_amd64 cfssljson
</code></pre></div></div>

<p>wgetä¸‹è½½ä¸ä¸‹æ¥å¯ä»¥æ‰‹åŠ¨ä¸‹è½½</p>

<h2 id="etcdè¯ä¹¦åˆ›å»º">ETCDè¯ä¹¦åˆ›å»º</h2>

<p>åœ¨ä¸‹è½½äº†cfsslçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/etcd/{bin,cfg,ssl} -p
cd /opt/etcd/ssl/
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ca-config.json
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "signing": {
        "default": {
            "expiry": "87600h"
        },
        "profiles": {
            "etcd": {
                "expiry": "87600h",
                "usages": [
                    "signing",
                    "key encipherment",
                    "server auth",
                    "client auth"
                ]
            }
        }
    }
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ca-csr.json
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "CN": "etcd CA",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "Beijing",
            "L": "Beijing"
        }
    ]
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi server-csr.json
</code></pre></div></div>

<p>ä¸‹é¢çš„hostséœ€è¦æ”¹æˆè‡ªå·±çš„</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "CN": "etcd",
    "hosts": [
         "192.168.100.100",
         "192.168.100.101",
         "192.168.100.102"
        ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "Beijing",
            "L": "Beijing"
        }
    ]
}
</code></pre></div></div>

<p>ç”Ÿæˆ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=etcd server-csr.json | cfssljson -bare server
</code></pre></div></div>

<p>è¯ä¹¦æ‹·è´åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç›¸åŒä½ç½®ï¼Œä¸»è¦æ˜¯ca.pemã€server.pemã€server-key.pemä¸‰ä¸ªæ–‡ä»¶ï¼Œæˆ‘æ”¾åœ¨/opt/etcd/ssl/å†…éƒ¨</p>

<h2 id="etcdé›†ç¾¤æ­å»º">ETCDé›†ç¾¤æ­å»º</h2>

<p>åœ¨ä¸€å°æœåŠ¡å™¨ä¸‹è½½etcd</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_VER=v3.4.24

//è¿™ä¸¤ä¸ªéƒ½å¯ä»¥
GOOGLE_URL=https://storage.googleapis.com/etcd
GITHUB_URL=https://github.com/etcd-io/etcd/releases/download
DOWNLOAD_URL=${GOOGLE_URL}

rm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
rm -rf /tmp/etcd-download-test &amp;&amp; mkdir -p /tmp/etcd-download-test

curl -L ${DOWNLOAD_URL}/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
tar xzvf /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz -C /tmp/etcd-download-test --strip-components=1
rm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp/etcd-download-test/
cp etcd etcdctl /usr/local/bin/
</code></pre></div></div>

<p>è¿™é‡Œçš„etcdã€etcdctlä¸¤ä¸ªæ–‡ä»¶æ‹·è´åˆ°å…¨éƒ¨èŠ‚ç‚¹çš„/usr/local/bin/ç›®å½•å†…</p>

<p>å¯¹æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼Œé…ç½®æ–‡ä»¶æ³¨æ„æ”¹ä¸€éƒ¨åˆ†</p>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/etcd/cfg/etcd.conf
</code></pre></div></div>

<p>é…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_INITIAL_CLUSTER_STATEETCD_INITIAL_CLUSTER_STATE#[Member]
ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
ETCD_NAME="etcd01"#ä¿®æ”¹ä¸ºETCD_INITIAL_CLUSTERä¸­=å³è¾¹ä¸ºæœ¬æœºipçš„å·¦è¾¹çš„name
ETCD_LISTEN_PEER_URLS="https://192.168.100.100:2380" #ä¿®æ”¹ä¸ºæœ¬æœºip
ETCD_LISTEN_CLIENT_URLS="https://192.168.100.100:2379,http://127.0.0.1:2379"#ä¿®æ”¹ä¸ºæœ¬æœºip
#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS="https://192.168.100.100:2380"#ä¿®æ”¹ä¸ºæœ¬æœºip
ETCD_ADVERTISE_CLIENT_URLS="https://192.168.100.100:2379"#ä¿®æ”¹ä¸ºæœ¬æœºip

#ä¸‹é¢çš„åå­—è·Ÿipéœ€è¦äº‹å…ˆè§„åˆ’ä¸‹
ETCD_INITIAL_CLUSTER="etcd01=https://192.168.100.100:2380,etcd02=https://192.168.100.101:2380,etcd03=https://192.168.100.102:2380"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"
ETCD_INITIAL_CLUSTER_STATE="new"
#[Security]

#è¿™é‡Œæ˜¯å‰é¢cfsslåˆ›å»ºçš„è¯ä¹¦ï¼Œç”¨äºå¼€å¯TLS
ETCD_CERT_FILE="/opt/etcd/ssl/server.pem"
ETCD_KEY_FILE="/opt/etcd/ssl/server-key.pem"
ETCD_TRUSTED_CA_FILE="/opt/etcd/ssl/ca.pem"
ETCD_CLIENT_CERT_AUTH="true"
ETCD_PEER_CERT_FILE="/opt/etcd/ssl/server.pem"
ETCD_PEER_KEY_FILE="/opt/etcd/ssl/server-key.pem"
ETCD_PEER_TRUSTED_CA_FILE="/opt/etcd/ssl/ca.pem"
ETCD_PEER_CLIENT_CERT_AUTH="true"
</code></pre></div></div>

<p>å­—æ®µä»‹ç»ï¼Œä¸‹é¢çš„ä»£ç å—æ˜¯ä»‹ç»ï¼Œçœ‹çœ‹å°±è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--initial-clusterï¼šé›†ç¾¤å½“ä¸­çš„å…¶ä»–èŠ‚ç‚¹
--cert-fileï¼šetcdè¯ä¹¦è·¯å¾„
--key-fileï¼šetcdç§é’¥è·¯å¾„
--peer-cert-fileï¼šå¯¹ç­‰è¯ä¹¦(åŒå‘è¯ä¹¦)è·¯å¾„
--peer-key-fileï¼šå¯¹ç­‰è¯ä¹¦(åŒå‘è¯ä¹¦)ç§é’¥è·¯å¾„
--trusted-ca-fileï¼šä½œä¸ºå®¢æˆ·ç«¯æ—¶çš„CAè¯ä¹¦è·¯å¾„
--peer-trusted-ca-fileï¼šå¯¹ç­‰è¯ä¹¦çš„CAè¯ä¹¦è·¯å¾„
--initial-advertise-peer-urlsï¼šåˆ—å‡ºé›†ç¾¤æˆå‘˜é€šä¿¡çš„URLï¼Œç”¨äºé€šå‘Šé›†ç¾¤å…¶ä»–æˆå‘˜
--listen-peer-urlsï¼šç”¨äºç›‘å¬é›†ç¾¤å…¶ä»–æˆå‘˜çš„URLåˆ—è¡¨
--listen-client-urlsï¼šç”¨äºç›‘å¬å®¢æˆ·ç«¯é€šè®¯çš„URLåˆ—è¡¨
--advertise-client-urlsï¼šé€šå‘Šå®¢æˆ·ç«¯çš„URLï¼Œç”¨äºåˆ—å‡ºæ‰€æœ‰å®¢æˆ·ç«¯
--initial-cluster-tokenï¼šetcdé›†ç¾¤çš„åˆå§‹é›†ç¾¤ä»¤ç‰Œï¼ŒæœåŠ¡å™¨å¿…é¡»é€šè¿‡ä»¤ç‰Œæ‰èƒ½åŠ å…¥etcdé›†ç¾¤
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /usr/lib/systemd/system/etcd.service
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=Etcd Server
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
EnvironmentFile=-/opt/etcd/cfg/etcd.conf
ExecStart=/usr/local/bin/etcd
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
</code></pre></div></div>

<p>ç„¶åå¯åŠ¨æœåŠ¡ï¼Œç»„æˆé›†ç¾¤çš„å‡ ä¸ªèŠ‚ç‚¹éœ€è¦åŒæ—¶å¼€å¯etcdæœåŠ¡ï¼Œä»ä¸Šåˆ°ä¸‹çš„æŒ‡ä»¤åˆ†åˆ«æ˜¯ï¼š</p>

<p>è¯»å–æœåŠ¡æ–‡ä»¶ã€å¼€æœºå¯åŠ¨etcdã€å¼€å¯etcdæœåŠ¡ã€æŸ¥çœ‹etcdè¿è¡ŒçŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable etcd
systemctl start etcd
systemctl status etcd

</code></pre></div></div>

<p>è¿è¡ŒçŠ¶æ€æ˜¯runningå°±è¡Œ</p>

<p>è¿™é‡Œçš„æœåŠ¡å¯åŠ¨è¦åŒæ—¶ï¼ŒETCD_INITIAL_CLUSTERé…ç½®æœ‰å‡ å°å°±è¦åœ¨å‡ å°å¯åŠ¨ã€‚</p>

<p>æœåŠ¡å¯åŠ¨è¦æ˜¯æŠ¥é”™äº†æœ‰æç¤ºã€å¯ä»¥ç™¾åº¦çœ‹çœ‹å“ªé‡Œæœ‰é—®é¢˜</p>

<hr />

<p>åˆ°è¿™é‡Œå°±éƒ¨ç½²å®Œæ¯•äº†ï¼Œåé¢æ˜¯å¯¹éƒ¨ç½²ç»“æœçš„æŸ¥çœ‹</p>

<p>ä½¿ç”¨è„šæ‰‹æ¶çš„å›ºå®šå‰ç¼€ï¼Œè¯ä¹¦ä½ç½®è‡ªå·±å®šï¼ŒæœåŠ¡å™¨ipè‡ªå·±æ”¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ETCD_PREFIX='ETCDCTL_API=3 etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints="https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379" --write-out=table'
</code></pre></div></div>

<p>æŸ¥çœ‹æˆå‘˜ä¿¡æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "${ETCD_PREFIX} member list"
</code></pre></div></div>

<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval "${ETCD_PREFIX} endpoint health"
</code></pre></div></div>

<p>å…¨éƒ¨çš„healthåˆ—éƒ½æ˜¯trueè¡¨ç¤ºéƒ¨ç½²å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæœ‰æŸä¸€ä¸ªhealthæ˜¯falseï¼Œé‡å¯é‚£ä¸€ä¸ªetcdã€‚</p>

<p>é‡å¯å‰ä¿®æ”¹é…ç½®çš„ETCD_INITIAL_CLUSTER_STATEä¸ºâ€existingâ€ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å³å¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart etcd
</code></pre></div></div>

<h1 id="éƒ¨ç½²containerd">éƒ¨ç½²Containerd</h1>

<p>å…¨éƒ¨èŠ‚ç‚¹æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œcontaineréƒ¨ç½²</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/{containerd,cni/bin} -p
</code></pre></div></div>

<p>ä¸‹containerçš„è½½gzå®‰è£…åŒ…è·Ÿcniçš„gzå®‰è£…åŒ…è¿˜æœ‰runcçš„äºŒè¿›åˆ¶åŒ…ï¼Œè¿™é‡Œcontainerä½¿ç”¨1.7.0ç‰ˆæœ¬ï¼Œcniä½¿ç”¨1.2.0ï¼Œruncä½¿ç”¨1.1.4</p>

<p>containerdä¸‹è½½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/containerd/containerd/releases/download/v1.7.0/containerd-1.7.0-linux-amd64.tar.gz
</code></pre></div></div>

<p>cniæ’ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/containernetworking/plugins/releases/download/v1.2.0/cni-plugins-linux-amd64-v1.2.0.tgz
</code></pre></div></div>

<p>runcæ’ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64
</code></pre></div></div>

<p>containerdæ–‡ä»¶æ”¾åˆ°/opt/containerdè§£å‹ï¼Œctræ”¾åˆ°ç³»ç»Ÿç¯å¢ƒ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /opt/containerd/bin/ctr  /usr/local/bin
</code></pre></div></div>

<p>cniæ”¾åˆ°/opt/cni/binè§£å‹</p>

<p>è§£å‹å‘½ä»¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxf *gz
</code></pre></div></div>

<p>åœ¨æ”¾ç½®runc.amd64çš„åœ°æ–¹è¿è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>install -m 755 runc.amd64 /usr/local/sbin/runc
</code></pre></div></div>

<p>å…ˆå¯åŠ¨ä¸€æ¬¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/systemd/system/containerd.service &lt;&lt;EOF
[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target local-fs.target
 
[Service]
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/opt/containerd/bin/containerd
Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5
LimitNPROC=infinity
LimitCORE=infinity
LimitNOFILE=infinity
TasksMax=infinity
OOMScoreAdjust=-999
 
[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
systemctl enable containerd
systemctl start containerd
systemctl status containerd
</code></pre></div></div>

<p>é…ç½®Containerdæ‰€éœ€çš„æ¨¡å—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/modules-load.d/containerd.conf &lt;&lt;EOF
overlay
br_netfilter
EOF
systemctl restart systemd-modules-load.service
</code></pre></div></div>

<p>é…ç½®Containerdæ‰€éœ€çš„å†…æ ¸</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;&gt; /etc/sysctl.d/99-kubernetes-cri.conf &lt;&lt; EOF
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
sysctl --system
</code></pre></div></div>

<p>åˆ›å»ºcnié…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/cni/net.d/ -p
cat &gt; /etc/cni/net.d/10-mynet.conf &lt;&lt;EOF
{
    "cniVersion": "1.0.0",
    "name": "mynet",
    "type": "bridge",
    "bridge": "cni0",
    "isGateway": true,
    "ipMasq": true,
    "ipam": {
        "type": "host-local",
        "subnet": "10.88.0.0/16",
        "routes": [
            {
                "dst": "0.0.0.0/0"
            }
        ]
    }
}
EOF
cat &gt; /etc/cni/net.d/99-loopback.conf &lt;&lt;EOF
{
    "cniVerion": "1.0.0",
    "name": "lo",
    "type": "loopback"
}
EOF
</code></pre></div></div>

<p>åˆ›å»ºContainerdçš„é…ç½®æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/containerd
/opt/containerd/bin/containerd config default | tee /etc/containerd/config.toml
</code></pre></div></div>

<p><strong>ä¿®æ”¹Containerdçš„é…ç½®æ–‡ä»¶/etc/containerd/config.tomlï¼Œå‡ ä¸ªé…ç½®æ˜¯åˆ†å¼€çš„</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#è¿™ä¸ªé…ç½®é‡Œçš„[plugins."io.containerd.grpc.v1.cri"]
sandbox_image = "registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6"
#è¿™ä¸ªé…ç½®é‡Œçš„[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options] SystemdCgroupæ³¨é‡Šæ‰
# SystemdCgroup = true
</code></pre></div></div>

<p>æŸ¥çœ‹é…ç½®é‡Œçš„è¿™ä¸€é¡¹config_pathï¼Œæ²¡æœ‰è‡ªå·±åŠ </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[plugins."io.containerd.grpc.v1.cri".registry]
  config_path = "/etc/containerd/certs.d"
</code></pre></div></div>

<p>æŸ¥çœ‹å‘½åç©ºé—´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ctr namespaces ls
</code></pre></div></div>

<p>åˆ›å»ºå‘½åç©ºé—´çš„é…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /etc/containerd/certs.d/k8s.io -p
</code></pre></div></div>

<p>é…ç½®é•œåƒåŠ é€Ÿhost.åé¢çš„æ”¹æˆè‡ªå·±é˜¿é‡Œäº‘çš„å…è´¹é•œåƒåŠ é€Ÿåœ°å€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt;  /etc/containerd/certs.d/k8s.io/hosts.toml  &lt;&lt;EOF
server = "https://k8s.io"

[host."https://d68wvxw0.mirror.aliyuncs.com"]
  capabilities = ["pull", "resolve", "push"]
EOF
</code></pre></div></div>

<p>å¯åŠ¨æµ‹è¯•</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart containerd
ctr version

</code></pre></div></div>

<p>##</p>

<h1 id="ä¸»èŠ‚ç‚¹éƒ¨ç½²masterç»„ä»¶">ä¸»èŠ‚ç‚¹éƒ¨ç½²Masterç»„ä»¶</h1>

<h2 id="ä¸‹è½½æºç ">ä¸‹è½½æºç </h2>

<p>è¿™é‡Œæœ‰å…¨éƒ¨ç‰ˆæœ¬çš„æ—¥å¿—ï¼Œè¿›å»è¿™ä¸ªé¡µé¢ä¸‹æ»‘æœ‰å¾ˆå¤šç‰ˆæœ¬</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG
</code></pre></div></div>

<p>ç‚¹å‡»ç‰ˆæœ¬è¿›å»åå°±èƒ½çœ‹åˆ°ç‰ˆæœ¬çš„ä¸‹è½½é“¾æ¥</p>

<p>ç‚¹å‡»Download for xxxï¼Œè¿›å»æ‰¾åˆ°Server Binariesï¼Œæ˜¯Serverï¼Œä¸‹è½½ç¬¬ä¸€ä¸ªkubernetes-server-linux-amd64.tar.gz</p>

<p>æˆ‘ä¸‹è½½çš„1.26.3ç‰ˆæœ¬ï¼Œä¹‹ååˆ°è§„åˆ’çš„MasteræœåŠ¡å™¨è·‘ä»£ç </p>

<p>è§„åˆ’ä¸€ä¸ªæ”¾k8sçš„æ–‡ä»¶å¤¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p /opt/kubernetes/{bin,cfg,ssl,logs} 
</code></pre></div></div>

<p>å°†ä¸‹è½½çš„gzæ–‡ä»¶æ”¾åœ¨/opt/kubernetes/ç›®å½•ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/kubernetes
tar zxvf kubernetes-server-linux-amd64.tar.gz
cd kubernetes/server/bin
cp kube-apiserver kube-scheduler kube-controller-manager kubelet kube-proxy kubectl kubeadm /opt/kubernetes/bin
cp kubectl kubeadm /usr/bin/
</code></pre></div></div>

<h2 id="éƒ¨ç½²kube-apiserver">éƒ¨ç½²kube-apiserver</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-apiserver

cd /opt/kubernetes/ssl/kube-apiserver


cat &gt; ca-config.json &lt;&lt; EOF
{
  "signing": {
    "default": {
      "expiry": "87600h"
    },
    "profiles": {
      "kubernetes": {
         "expiry": "87600h",
         "usages": [
            "signing",
            "key encipherment",
            "server auth",
            "client auth"
        ]
      }
    }
  }
}
EOF
cat &gt; ca-csr.json &lt;&lt; EOF
{
    "CN": "kubernetes",
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "Beijing",
            "ST": "Beijing",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
EOF

cat &gt; server-csr.json &lt;&lt; EOF
{
    "CN": "kubernetes",
    "hosts": [
      "127.0.0.1",
      "192.168.100.100",
      "192.168.100.101",
      "192.168.100.102",
      "k8s-master",
      "k8s-node1",
      "k8s-node2"
    ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "L": "BeiJing",
            "ST": "BeiJing",
            "O": "k8s",
            "OU": "System"
        }
    ]
}
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server

</code></pre></div></div>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; EOF
KUBE_APISERVER_OPTS="--v=2 \\
--etcd-servers=https://192.168.100.100:2379,https://192.168.100.101:2379,https://192.168.100.102:2379 \\
--etcd-cafile=/opt/etcd/ssl/ca.pem \\
--etcd-certfile=/opt/etcd/ssl/server.pem \\
--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\
--bind-address=192.168.100.100 \\
--secure-port=6443 \\
--advertise-address=192.168.100.100 \\
--allow-privileged=true \\
--authorization-mode=RBAC,Node \\
--token-auth-file=/opt/kubernetes/cfg/token.csv \\
--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\
--enable-bootstrap-token-auth=true \\
--service-cluster-ip-range=10.0.0.0/24 \\
--service-node-port-range=30000-32767 \\
--service-account-issuer=api \\
--service-account-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem \\
--service-account-signing-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--proxy-client-cert-file=/opt/kubernetes/ssl/kube-apiserver/server.pem \\
--proxy-client-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--kubelet-client-certificate=/opt/kubernetes/ssl/kube-apiserver/server.pem \\
--kubelet-client-key=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--tls-cert-file=/opt/kubernetes/ssl/kube-apiserver/server.pem  \\
--tls-private-key-file=/opt/kubernetes/ssl/kube-apiserver/server-key.pem \\
--client-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--requestheader-client-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--requestheader-allowed-names=kubernetes \\
--requestheader-extra-headers-prefix=X-Remote-Extra- \\
--requestheader-group-headers=X-Remote-Group \\
--requestheader-username-headers=X-Remote-User \\
--enable-aggregator-routing=true \\
--audit-log-maxage=30 \\
--audit-log-maxbackup=3 \\
--audit-log-maxsize=100 \\
--audit-log-path=/opt/kubernetes/logs/k8s-audit.log"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆä¸€ä¸ªtoken</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>head -c 16 /dev/urandom | od -An -t x | tr -d ' '

</code></pre></div></div>

<p>å†™å…¥bootstrapingéªŒè¯tokençš„æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; EOF
dcbfd5e168fde8abda5ed8b0fda3291f,kubelet-bootstrap,10001,"system:node-bootstrapper"
EOF

</code></pre></div></div>

<p>åˆ›å»ºapiserveræœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf
ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-apiserver
systemctl start kube-apiserver 
systemctl status kube-apiserver 

</code></pre></div></div>

<p>çŠ¶æ€æ˜¯runningå°±ok</p>

<h2 id="éƒ¨ç½²kube-controller-manager">éƒ¨ç½²kube-controller-manager</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; EOF
KUBE_CONTROLLER_MANAGER_OPTS="--v=2 \\
--leader-elect=true \\
--kubeconfig=/opt/kubernetes/cfg/kube-controller-manager.kubeconfig \\
--bind-address=127.0.0.1 \\
--allocate-node-cidrs=true \\
--cluster-cidr=10.244.0.0/16 \\
--service-cluster-ip-range=10.0.0.0/24 \\
--cluster-signing-cert-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--cluster-signing-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem  \\
--root-ca-file=/opt/kubernetes/ssl/kube-apiserver/ca.pem \\
--service-account-private-key-file=/opt/kubernetes/ssl/kube-apiserver/ca-key.pem \\
--cluster-signing-duration=87600h0m0s"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-controller-manager
cd /opt/kubernetes/ssl/kube-controller-manager
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-controller-manager
cat &gt; kube-controller-manager-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-controller-manager",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing", 
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager

</code></pre></div></div>

<p>shellæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆkubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-controller-manager.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-controller-manager \
  --client-certificate=/opt/kubernetes/ssl/kube-controller-manager/kube-controller-manager.pem \
  --client-key=/opt/kubernetes/ssl/kube-controller-manager/kube-controller-manager-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-controller-manager \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf
ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-controller-manager
systemctl start kube-controller-manager
systemctl status kube-controller-manager

</code></pre></div></div>

<p>çŠ¶æ€æ˜¯runningå°±ok</p>

<h2 id="éƒ¨ç½²-kube-scheduler">éƒ¨ç½² kube-scheduler</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; EOF
KUBE_SCHEDULER_OPTS="--v=2 \\
--leader-elect \\
--kubeconfig=/opt/kubernetes/cfg/kube-scheduler.kubeconfig \\
--bind-address=127.0.0.1"
EOF

</code></pre></div></div>

<p>ç”Ÿæˆè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-scheduler
cd /opt/kubernetes/ssl/kube-scheduler
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-scheduler
# åˆ›å»ºè¯ä¹¦è¯·æ±‚æ–‡ä»¶
cat &gt; kube-scheduler-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-scheduler",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF
# ç”Ÿæˆè¯ä¹¦
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-scheduler-csr.json | cfssljson -bare kube-scheduler

</code></pre></div></div>

<p>ç”Ÿæˆ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-scheduler.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-scheduler \
  --client-certificate=/opt/kubernetes/ssl/kube-scheduler/kube-scheduler.pem \
  --client-key=/opt/kubernetes/ssl/kube-scheduler/kube-scheduler-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-scheduler \
  --kubeconfig=${KUBE_CONFIG}
    
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡ç®¡ç†</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf
ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>å¯åŠ¨</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-scheduler
systemctl start kube-scheduler
systemctl status kube-scheduler

</code></pre></div></div>

<h2 id="é›†ç¾¤ç®¡ç†å‰é…ç½®">é›†ç¾¤ç®¡ç†å‰é…ç½®</h2>

<p>ç”Ÿæˆé›†ç¾¤é“¾æ¥è¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-link
cd /opt/kubernetes/ssl/kube-link
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-link

cat &gt; admin-csr.json &lt;&lt;EOF
{
  "CN": "admin",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "system:masters",
      "OU": "System"
    }
  ]
}
EOF

cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin

</code></pre></div></div>

<p>åˆ›å»ºkubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /root/.kube

KUBE_CONFIG="/root/.kube/config"
KUBE_APISERVER="https://192.168.100.100:6443"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-link/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials cluster-admin \
  --client-certificate=/opt/kubernetes/ssl/kube-link/admin.pem \
  --client-key=/opt/kubernetes/ssl/kube-link/admin-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=cluster-admin \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>æŸ¥çœ‹èŠ‚ç‚¹ç»„ä»¶çŠ¶æ€</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> kubectl get cs
</code></pre></div></div>

<p>healthå…¨æ˜¯trueå°±æ˜¯ç»„ä»¶æ­£å¸¸</p>

<p>åˆ›å»ºç”¨æˆ·</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create clusterrolebinding kubelet-bootstrap \
--clusterrole=system:node-bootstrapper \
--user=kubelet-bootstrap

</code></pre></div></div>

<h1 id="é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹éƒ¨ç½²">é›†ç¾¤å…¨éƒ¨èŠ‚ç‚¹éƒ¨ç½²</h1>

<h2 id="å®‰è£…ctictl">å®‰è£…ctictl</h2>

<p>ä¸‹è½½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.26.1/crictl-v1.26.1-linux-amd64.tar.gz
</code></pre></div></div>

<p>è§£å‹åç§»åŠ¨åˆ°ç¯å¢ƒå˜é‡é‡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf crictl-v1.26.1-linux-amd64.tar.gz
mv crictl /usr/local/bin/
</code></pre></div></div>

<p>æ·»åŠ crictlé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /etc/crictl.yaml &lt;&lt;EOF
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 2
debug: false
pull-image-on-create: false
disable-pull-on-run: false
EOF

</code></pre></div></div>

<h2 id="masteréƒ¨ç½²kubelet">ï¼ˆmasterï¼‰éƒ¨ç½²kubelet</h2>

<p>å…ˆåœ¨masterèŠ‚ç‚¹æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤kubeletéƒ¨ç½²</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; EOF
kind: KubeletConfiguration
apiVersion: kubelet.config.k8s.io/v1beta1
address: 0.0.0.0
port: 10250
readOnlyPort: 10255
cgroupDriver: cgroupfs
clusterDNS:
- 10.0.0.2
clusterDomain: k8s-master 
failSwapOn: false
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /opt/kubernetes/ssl/kube-apiserver/ca.pem 
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
maxOpenFiles: 1000000
maxPods: 110
EOF

</code></pre></div></div>

<p>åˆ›å»ºbootstrap.kubeconfig</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/bootstrap.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443" 
TOKEN="dcbfd5e168fde8abda5ed8b0fda3291f"

kubectl config set-cluster kubernetes \
  --certificate-authority=/opt/kubernetes/ssl/kube-apiserver/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials "kubelet-bootstrap" \
  --token=${TOKEN} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user="kubelet-bootstrap" \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; EOF
KUBELET_OPTS="--hostname-override=k8s-master \\
--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\
--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\
--config=/opt/kubernetes/cfg/kubelet-config.yml \\
--cert-dir=/opt/kubernetes/ssl/kube-link \\
--container-runtime-endpoint=unix:///run/containerd/containerd.sock"
EOF

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kubelet
systemctl start kubelet
systemctl status kubelet

</code></pre></div></div>

<p>å…è®¸kubeletè¯ä¹¦ç”³è¯·å¹¶åŠ å…¥é›†ç¾¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get csr
#ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåçš„è¡¨æ ¼ï¼Œå–nameé‚£ä¸€å—ä½œä¸ºä¸‹é¢å‘½ä»¤çš„å‚æ•°
kubectl certificate approve node-csr-t8Gq2LXx4SJ-WDa-HFeuc0ESNvEZ8oMTsZcaybs1NII
#æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤èƒ½çœ‹åˆ°k8s-masterå±•ç¤ºåˆ—è¡¨çŠ¶æ€ä¸ºready
kubectl get nodes

</code></pre></div></div>

<h2 id="masteréƒ¨ç½²kube-proxy">ï¼ˆmasterï¼‰éƒ¨ç½²kube-proxy</h2>

<p>åˆ›å»ºé…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; EOF
KUBE_PROXY_OPTS="--v=2 \\
--config=/opt/kubernetes/cfg/kube-proxy-config.yml"
EOF
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; EOF
kind: KubeProxyConfiguration
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
metricsBindAddress: 0.0.0.0:10249
clientConnection:
  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig
hostnameOverride: k8s-master
clusterCIDR: 10.244.0.0/16
EOF
</code></pre></div></div>

<p>åˆ›å»ºè¯ä¹¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes/ssl/kube-proxy
cd /opt/kubernetes/ssl/kube-proxy
cp /opt/kubernetes/ssl/kube-apiserver/ca* /opt/kubernetes/ssl/kube-proxy
cat &gt; kube-proxy-csr.json &lt;&lt; EOF
{
  "CN": "system:kube-proxy",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "L": "BeiJing",
      "ST": "BeiJing",
      "O": "k8s",
      "OU": "System"
    }
  ]
}
EOF
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy

</code></pre></div></div>

<p>ç”Ÿæˆkube-proxy.kubeconfigæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KUBE_CONFIG="/opt/kubernetes/cfg/kube-proxy.kubeconfig"
KUBE_APISERVER="https://192.168.100.100:6443"
CERT_PATH="/opt/kubernetes/ssl/kube-proxy"

kubectl config set-cluster kubernetes \
  --certificate-authority=${CERT_PATH}/ca.pem \
  --embed-certs=true \
  --server=${KUBE_APISERVER} \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-credentials kube-proxy \
  --client-certificate=${CERT_PATH}/kube-proxy.pem \
  --client-key=${CERT_PATH}/kube-proxy-key.pem \
  --embed-certs=true \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config set-context default \
  --cluster=kubernetes \
  --user=kube-proxy \
  --kubeconfig=${KUBE_CONFIG}
  
kubectl config use-context default --kubeconfig=${KUBE_CONFIG}

</code></pre></div></div>

<p>åˆ›å»ºæœåŠ¡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
    EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-proxy
systemctl start kube-proxy
systemctl status kube-proxy

</code></pre></div></div>

<h2 id="masteræ·»åŠ ç½‘ç»œç®¡ç†ç»„ä»¶">ï¼ˆmasterï¼‰æ·»åŠ ç½‘ç»œç®¡ç†ç»„ä»¶</h2>

<p>ä¸‹è½½calicotl</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/projectcalico/calico/releases/download/v3.25.0/calicoctl-linux-amd64
</code></pre></div></div>

<p>æ”¾åˆ°/usr/local/bin/ä¸­</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv /usr/local/bin/calicoctl-linux-amd64 /usr/local/bin/calicoctl
chmod +x /usr/local/bin/calicoctl
</code></pre></div></div>

<p>ä¸‹è½½é…ç½®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/calico.yaml
</code></pre></div></div>

<p>æ”¾åˆ°/opt/kubernetes/cfg/ä¸­</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f /opt/kubernetes/cfg/calico.yaml
kubectl get pods -n kube-system
</code></pre></div></div>

<h2 id="nodeå¤åˆ¶èŠ‚ç‚¹">ï¼ˆnodeï¼‰å¤åˆ¶èŠ‚ç‚¹</h2>

<p>masterèŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/kubernetes
tar zvcf kube.gz bin/ cfg/ ssl/

</code></pre></div></div>

<p>å°†/opt/kubernetes/ä¸‹çš„kube.gzæ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p>

<p>å­èŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /opt/kubernetes

</code></pre></div></div>

<p>å°†åˆšåˆšä¸‹è½½çš„kube.gzæ–‡ä»¶ä¸Šä¼ åˆ°/opt/kubernetes/</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tar -zxvf kube.gz
 
</code></pre></div></div>

<p>åˆ é™¤éƒ¨åˆ†é…ç½®ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸åŒ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm -f /opt/kubernetes/cfg/kubelet.kubeconfig 
rm -f /opt/kubernetes/ssl/kube-link/kubelet*

</code></pre></div></div>

<p>ä¿®æ”¹ä¸»æœºåç§°</p>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/kubernetes/cfg/kubelet.conf

</code></pre></div></div>

<p>ä¿®æ”¹ï¼šâ€“hostname-override=k8s-node1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/kubernetes/cfg/kube-proxy-config.yml

</code></pre></div></div>

<p>ä¿®æ”¹ï¼šhostnameOverride: k8s-node1</p>

<hr />

<p>åˆ›å»ºè½¯è¿æ¥ï¼ˆåˆ›å»ºæœåŠ¡ï¼‰kubeletä¸kube-proxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
After=docker.service

[Service]
EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf
ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Proxy
After=network.target

[Service]
    EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf
ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS
Restart=on-failure
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF

</code></pre></div></div>

<p>è¿™é‡Œå¯ä»¥å¼€ä¸€ä¸ªæ–°çš„sshä¸“é—¨æ‰“æ—¥å¿—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tail -f /var/log/messages
</code></pre></div></div>

<p>å¼€å¯kubelet</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kubelet
systemctl start kubelet
systemctl status kubelet

</code></pre></div></div>

<p>å¼€å¯kube-proxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload
systemctl enable kube-proxy
systemctl start kube-proxy
systemctl status kube-proxy

</code></pre></div></div>

<p>åœ¨Masterä¸ŠåŒæ„æ–°çš„Node kubeletè¯ä¹¦ç”³è¯·</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get csr
kubectl certificate approve #åé¢æ˜¯ä¸Šé¢è¯­å¥è·å–çš„NAMEåˆ—çš„ä¸€è¡Œ
</code></pre></div></div>

<p>æŸ¥çœ‹èŠ‚ç‚¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes
</code></pre></div></div>

<p>æœ‰ä¸‰ä¸ªReadyçš„</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="è™šæ‹Ÿæœº" /><category term="k8s" /><category term="kubernetes" /><category term="containerd" /><summary type="html"><![CDATA[æœåŠ¡å™¨å¯†ç  mfhk12xx]]></summary></entry><entry><title type="html">Linux Centos å¦‚ä½•æ³¨å†Œè‡ªå·±çš„æœåŠ¡</title><link href="http://localhost:4000/2023/09/06/Linux-CentOS-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1.html" rel="alternate" type="text/html" title="Linux Centos å¦‚ä½•æ³¨å†Œè‡ªå·±çš„æœåŠ¡" /><published>2023-09-06T00:00:00+08:00</published><updated>2023-09-06T00:00:00+08:00</updated><id>http://localhost:4000/2023/09/06/Linux-CentOS-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1</id><content type="html" xml:base="http://localhost:4000/2023/09/06/Linux-CentOS-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1.html"><![CDATA[<p>è„šæœ¬å†…çš„åœ°å€éœ€è¦å†™å…¨è·¯å¾„ï¼Œä¸”éœ€ä»¥</p>

<p><strong>#! /bin/bash</strong></p>

<p>å¼€å¤´</p>

<p>åˆ›å»º ä½ çš„æœåŠ¡.service æ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=test
After=network.target

[Service]
Type=forking
ExecStart=å¯åŠ¨æ“ä½œæ—¶æ‰§è¡Œçš„è„šæœ¬
ExecReload=é‡æ–°å¯åŠ¨æ“ä½œæ—¶æ‰§è¡Œçš„è„šæœ¬
ExecStop=å…³é—­æ“ä½œæ—¶æ‰§è¡Œçš„è„šæœ¬
PrivateTmp=true

 [Install]
WantedBy=multi-user.target
</code></pre></div></div>

<p>å¤åˆ¶è„šæœ¬åˆ°ç³»ç»ŸæœåŠ¡ä¸­ /usr/lib/systemd/system/</p>

<p>systemctl daemon-reload</p>

<p>systemctl start ä½ çš„æœåŠ¡</p>

<p>è®¾ç½®å¼€æœºè‡ªå¯</p>

<p>systemctl enable ä½ çš„æœåŠ¡</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="æœåŠ¡" /><summary type="html"><![CDATA[è„šæœ¬å†…çš„åœ°å€éœ€è¦å†™å…¨è·¯å¾„ï¼Œä¸”éœ€ä»¥]]></summary></entry><entry><title type="html">Linux Centos GitæœåŠ¡å™¨æ­å»º</title><link href="http://localhost:4000/2022/10/14/Linux-CentOS-git%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA.html" rel="alternate" type="text/html" title="Linux Centos GitæœåŠ¡å™¨æ­å»º" /><published>2022-10-14T00:00:00+08:00</published><updated>2022-10-14T00:00:00+08:00</updated><id>http://localhost:4000/2022/10/14/Linux-CentOS-git%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA</id><content type="html" xml:base="http://localhost:4000/2022/10/14/Linux-CentOS-git%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA.html"><![CDATA[<p>æ–‡ç« æ¥æºï¼š https://www.runoob.com/git/git-server.html</p>

<h2 id="1å®‰è£…gitrootç”¨æˆ·">1ã€å®‰è£…Git[rootç”¨æˆ·]</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel
yum install git
</code></pre></div></div>

<p>åˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ç»„å’Œç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>groupadd git
useradd git -g git
passwd git
//è®¾ç½®å¯†ç 
</code></pre></div></div>

<h2 id="2åˆ›å»ºè¯ä¹¦ç™»å½•rootç”¨æˆ·">2ã€åˆ›å»ºè¯ä¹¦ç™»å½•[rootç”¨æˆ·]</h2>

<p>å°†æˆ‘ä»¬çš„å…¬é’¥å¯¼å…¥åˆ°/home/git/.ssh/authorized_keysæ–‡ä»¶é‡Œï¼Œä¸€è¡Œä¸€ä¸ªã€‚</p>

<p>å…¬é’¥ä½äºæœ¬åœ°çš„C:\Users\ç”¨æˆ·å\ .ssh\id_rsa.pubæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /home/git/
mkdir .ssh
chmod 755 .ssh
touch .ssh/authorized_keys
chmod 644 .ssh/authorized_keys
chown git:git .ssh/
</code></pre></div></div>

<h2 id="3åˆå§‹åŒ–gitä»“åº“rootç”¨æˆ·">3ã€åˆå§‹åŒ–Gitä»“åº“[rootç”¨æˆ·]</h2>

<p>é¦–å…ˆæˆ‘ä»¬é€‰å®šä¸€ä¸ªç›®å½•ä½œä¸ºGitä»“åº“ï¼Œå‡å®šæ˜¯/usr/local/gitRepo/demo.gitï¼Œåœ¨/usr/local/gitRepoç›®å½•ä¸‹è¾“å…¥å‘½ä»¤ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/local
mkdir gitRepo
chown git:git gitRepo/
cd gitRepo

git init --bare demo.git

//Initialized empty Git repository in /usr/local/gitRepo/demo.git/
</code></pre></div></div>

<p>ä»¥ä¸Šå‘½ä»¤Gitåˆ›å»ºä¸€ä¸ªç©ºä»“åº“ï¼ŒæœåŠ¡å™¨ä¸Šçš„Gitä»“åº“é€šå¸¸éƒ½ä»¥.gitç»“å°¾ã€‚ç„¶åï¼ŒæŠŠä»“åº“æ‰€å±ç”¨æˆ·æ”¹ä¸ºgitï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chown -R git:git demo.git
</code></pre></div></div>

<h2 id="4å…‹éš†ä»“åº“gitç”¨æˆ·">4ã€å…‹éš†ä»“åº“[Gitç”¨æˆ·]</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@127.0.0.1:/usr/local/gitRepo/demo.git

Cloning into 'runoob'...
warning: You appear to have cloned an empty repository.
Checking connectivity... done.
</code></pre></div></div>

<p>192.168.45.4 ä¸º Git æ‰€åœ¨æœåŠ¡å™¨ ip ï¼Œä½ éœ€è¦å°†å…¶ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ Git æœåŠ¡ ipã€‚</p>

<p>è¿™æ ·æˆ‘ä»¬çš„ Git æœåŠ¡å™¨å®‰è£…å°±å®Œæˆã€‚</p>

<h2 id="5æ•´ç‚¹å¥½ç©çš„--gitä»“åº“è§¦å‘æäº¤gitç”¨æˆ·">5ã€æ•´ç‚¹å¥½ç©çš„  gitä»“åº“è§¦å‘æäº¤[Gitç”¨æˆ·]</h2>

<p>ä¿®æ”¹äº‘ç«¯ä»“åº“hooksä¸­çš„post-receiveå‡½æ•°</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/local/gitRepo/demo.git/hooks
vim post-receive
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh
read local_ref local_sha remote_ref remote_sha
DIR=`pwd`
DIR=${DIR%.*}
branch=${remote_ref##*/}
cd ${DIR}
unset GIT_DIR
echo "${branch}å¼€å§‹æ‹‰å–ï¼Œé¡¹ç›®æ–‡ä»¶å¤¹`pwd`"
chmod 755 restart-demo.sh
./restart-demo.sh ${branch}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod 755 post-receive
</code></pre></div></div>

<p>æœåŠ¡å™¨æ‹‰å–é¡¹ç›®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /usr/local/gitRepo/demo
cd /usr/local/gitRepo/
git init demo
cd demo
git config --local user.name "xc"
git config --local user.email '1960481101@qq.com'
ssh-keygen -t rsa
</code></pre></div></div>

<p>æ‰¾åˆ°ç”Ÿæˆçš„æ–‡ä»¶çš„å…¬é’¥/home/git/.ssh/id_rsa.pubï¼Œæ·»åŠ åˆ° /home/git/.ssh/authorized_keys,ç„¶åå…‹éš†é¡¹ç›®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/local/gitRepo/demo
git remote add origin git@127.0.0.1:/usr/local/gitRepo/demo.git
git pull
</code></pre></div></div>

<p>é¡¹ç›®ä¸­åˆ›å»ºè„šæœ¬  restart-demo.sh</p>

<p>è„šæœ¬åœ¨é¡¹ç›®æœ€å¤–ä¾§ï¼Œæ–¹ä¾¿,mvnä½ç½®è‡ªå·±æ”¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#! /bin/bash
date

updateBranch=master

branch=$1
if [ "$branch" ! = "$updateBranch" ]; then
  echo "åˆ†æ”¯ä¸º${updateBranch}æ‰è¿›è¡Œæ›´æ–°"
  exit 1
fi

repoPath=$(pwd)
profile=$branch
cd $repoPath
git reset --hard origin/$branch
git checkout -f -b cache origin/$branch
git branch -D $branch
git checkout -f -b $branch origin/$branch
git branch -D cache
git pull --no-edit

/usr/local/custom/maven/bin/mvn clean package -P$profile

cd target
file=$(ls *.jar | awk '{print $1}')
sp_pid=$(ps -ef | grep $file | grep -v grep | awk '{print $2}')
if [ -z "$sp_pid" ]; then
  echo "[ not find sp-tomcat pid ]"
else
  echo "find result: $sp_pid "
  kill -9 $sp_pid
fi
logPath=$repoPath/${file%.*}.out
nohup java -jar $file &gt;$logPath 2&gt;&amp;1 &amp;
echo "--å¯åŠ¨ok,æ—¥å¿—è§$logPath--"

</code></pre></div></div>

<p>å°†é¡¹ç›®ä»£ç æ–‡ä»¶å¤¹å…¶æ‹¥æœ‰è€…è®¾ç½®ä¸ºgit</p>

<p>æ³¨æ„ï¼Œé¡¹ç›®ä¸­æ‰€æœ‰è¾“å‡ºè·¯å¾„éƒ½éœ€è¦ç”¨æˆ·gitæœ‰æ“ä½œæƒé™</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="git" /><category term="gitæœåŠ¡å™¨" /><category term="è‡ªåŠ¨éƒ¨ç½²" /><summary type="html"><![CDATA[æ–‡ç« æ¥æºï¼š https://www.runoob.com/git/git-server.html]]></summary></entry><entry><title type="html">Linux Centos Rediså®‰è£…</title><link href="http://localhost:4000/2022/10/12/Linux-CentOS-redis%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Rediså®‰è£…" /><published>2022-10-12T00:00:00+08:00</published><updated>2022-10-12T00:00:00+08:00</updated><id>http://localhost:4000/2022/10/12/Linux-CentOS-redis%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/10/12/Linux-CentOS-redis%E5%AE%89%E8%A3%85.html"><![CDATA[<p>redisæ˜¯ä¸ªå¥½ä¸œè¥¿å•Šï¼Œç¼–è¯‘å®‰è£…éœ€è¦gcc</p>

<p><strong>yum -y install gcc</strong></p>

<h2 id="ä¸€å•æœºrediså®‰è£…">ä¸€ã€å•æœºrediså®‰è£…</h2>

<h3 id="1ä¸‹è½½">1ã€ä¸‹è½½</h3>

<p>wget https://download.redis.io/releases/redis-6.2.7.tar.gz</p>

<h3 id="2è§£å‹">2ã€è§£å‹</h3>

<p>tar xzf redis-6.2.7.tar.gz</p>

<h3 id="3æ”¹å">3ã€æ”¹å</h3>

<p>mv redis-6.2.7 redis</p>

<h3 id="4ç¼–è¯‘å®‰è£…">4ã€ç¼–è¯‘å®‰è£…</h3>

<p>cd redis</p>

<p>make &amp;&amp; make install</p>

<h3 id="5ä¿®æ”¹é…ç½®">5ã€ä¿®æ”¹é…ç½®</h3>

<p>vi redis.conf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#æ³¨é‡Šæ‰ç»‘å®šç”¨äºè¿œç¨‹ç™»é™†
#bind 127.0.0.1 -::1
#è¿™é‡Œè®²åŸæ¥çš„noæ”¹ä¸ºyes,ç›®çš„æ˜¯ä¸ºäº†è®¾ç½®åå°è¿è¡Œ
daemonize yes
#è¿™é‡Œè®²åŸæ¥çš„yesæ”¹ä¸ºno,ç›®çš„æ˜¯ä¸ºäº†è§£å†³å®‰å…¨æ¨¡å¼å¼•èµ·çš„æŠ¥é”™
protected-mode no
#æ­¤å¤„æœ¬æ¥æ˜¯æ³¨é‡ŠçŠ¶æ€ï¼Œå–æ¶ˆæ³¨é‡Šåï¼Œè®¾ç½®redisæ°¸è¿œçš„ç™»é™†å¯†ç 
requirepass redisè¿æ¥å¯†ç 
</code></pre></div></div>

<h2 id="äºŒredisé›†ç¾¤é…ç½®">äºŒã€redisé›†ç¾¤é…ç½®</h2>

<p>redisé›†ç¾¤æœ€å°‘è¦6ä¸ªredisï¼Œèµ„æºæœ‰é™ï¼Œå¯ä»¥ä¸€å°æœºå™¨é…ç½®6ä¸ªredis</p>

<h3 id="1åˆ›å»ºé…ç½®è·¯å¾„">1ã€åˆ›å»ºé…ç½®è·¯å¾„</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#é…ç½®å­˜æ”¾è·¯å¾„
mkdir -p /usr/local/redis/6380
mkdir -p /usr/local/redis/6381
mkdir -p /usr/local/redis/6382
mkdir -p /usr/local/redis/6383
mkdir -p /usr/local/redis/6384
mkdir -p /usr/local/redis/6385
#æ—¥å¿—å­˜æ”¾è·¯å¾„
mkdir -p /usr/local/redis/logs
#redisæ•°æ®åº“å­˜æ”¾è·¯å¾„
mkdir -p /usr/local/redis/redisdata6380
mkdir -p /usr/local/redis/redisdata6381
mkdir -p /usr/local/redis/redisdata6382
mkdir -p /usr/local/redis/redisdata6383
mkdir -p /usr/local/redis/redisdata6384
mkdir -p /usr/local/redis/redisdata6385
</code></pre></div></div>

<h3 id="2æ‹·è´ä¿®æ”¹é…ç½®">2ã€æ‹·è´ä¿®æ”¹é…ç½®</h3>

<p>æ‹·è´é¦–ä»½é…ç½®</p>

<p>cp /usr/local/redis/redis.conf /usr/local/redis/6380/</p>

<p>ä¿®æ”¹å‡ ä¸ªé…ç½®</p>

<p>vim /usr/local/redis/6380/redis.conf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ç«¯å£
port 6380
#å–æ¶ˆç»‘å®š
#bind 127.0.0.1  -::1
#å¼€å¯é›†ç¾¤
cluster-enabled yes
cluster-node-timeout 15000
#å¯åå°è¿è¡Œ
daemonize yes
#å¯è¿œç¨‹è¿æ¥
protected-mode no
#æ–‡ä»¶è¾“å‡ºè·¯å¾„æ”¹ä¸‹
cluster-config-file nodes-6380.conf
pidfile /var/run/redis_6380.pid
logfile "/usr/local/redis/logs/redis-6380.log"
dir /usr/local/redis/redisdata6380
#å¯†ç åŠmasterå¯†ç 
requirepass redisè¿æ¥å¯†ç 
masterauth redisè¿æ¥å¯†ç 
</code></pre></div></div>

<p>å…¶ä»–åº“é…ç½®åªéœ€å°†é¦–ä»½é…ç½®æ‹·è´ï¼Œç„¶åå…¨å±€æ›¿æ¢ç«¯å£</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp /usr/local/redis/6380/redis.conf /usr/local/redis/6381/
cp /usr/local/redis/6380/redis.conf /usr/local/redis/6382/
cp /usr/local/redis/6380/redis.conf /usr/local/redis/6383/
cp /usr/local/redis/6380/redis.conf /usr/local/redis/6384/
cp /usr/local/redis/6380/redis.conf /usr/local/redis/6385/
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /usr/local/redis/6381/redis.conf   
:%s/6380/6381/g
:wq
vim /usr/local/redis/6382/redis.conf   
:%s/6380/6382/g
:wq
vim /usr/local/redis/6383/redis.conf   
:%s/6380/6383/g
:wq
vim /usr/local/redis/6384/redis.conf   
:%s/6380/6384/g
:wq
vim /usr/local/redis/6385/redis.conf   
:%s/6380/6385/g
:wq
</code></pre></div></div>

<h3 id="3å¯åŠ¨æœåŠ¡">3ã€å¯åŠ¨æœåŠ¡</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/redis/src/redis-server /usr/local/redis/6380/redis.conf
/usr/local/redis/src/redis-server /usr/local/redis/6381/redis.conf
/usr/local/redis/src/redis-server /usr/local/redis/6382/redis.conf
/usr/local/redis/src/redis-server /usr/local/redis/6383/redis.conf
/usr/local/redis/src/redis-server /usr/local/redis/6384/redis.conf
/usr/local/redis/src/redis-server /usr/local/redis/6385/redis.conf
</code></pre></div></div>

<p>ä»¥ä¸Šè®¾ç½®ï¼Œå¯ä»¥å°†ä»–ä»¬æ”¾åœ¨ä¸åŒæœåŠ¡å™¨ä¸­ï¼Œæ¯”å¦‚6380ä¸6381åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œ6382ä¸6383åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œ6384ä¸6385åœ¨ä¸€å°æœåŠ¡å™¨</p>

<p>åœ¨å…¶ä¸­ä¸€å°æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>

<p>src/redis-cli â€“cluster create   <strong>6380redisæ‰€åœ¨ip:6380</strong>    <strong>6381redisæ‰€åœ¨ip:6381</strong>      <strong>6382redisæ‰€åœ¨ip:6382</strong>      <strong>6383redisæ‰€åœ¨ip:6383 **     **6384redisæ‰€åœ¨ip:6384</strong>      <strong>6385redisæ‰€åœ¨ip:6385</strong>  â€“cluster-replicas 1 -a <strong>redisè¿æ¥å¯†ç </strong></p>

<p>éƒ½åœ¨ä¸€èµ·å¯ä»¥ä½¿ç”¨127.0.0.1ä»£æ›¿ip</p>

<p>src/redis-cli â€“cluster create 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385  â€“cluster-replicas 1 -a redisPass</p>

<p>ä¸­é—´ä¼šè¯¢é—®å‡ æ¬¡ï¼Œç›´æ¥è¾“å…¥yesåå›è½¦,æœ€åå±•ç¤ºå¦‚ä¸‹å³è¡¨ç¤ºæˆåŠŸ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
</code></pre></div></div>

<p>é›†ç¾¤ç™»å½•ï¼ŒæŒ‘ä¸€ä¸ªèŠ‚ç‚¹ç™»å½•å³å¯</p>

<p>src/redis-cli -h 127.0.0.1 -p 6380 -c -a è®¾ç½®çš„å¯†ç </p>

<h3 id="4æŸ¥çœ‹é›†ç¾¤çŠ¶æ€">4ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3>

<p>cluster nodes</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5e3d9195c01ce5ab069b3042e2e27171241814dc 127.0.0.1:6381@16381 master - 0 1661353971336 2 connected 5461-10922
601e269d458e6f2a6af9b183316e9cd3fc3bbeb1 127.0.0.1:6383@16383 slave 5e3d9195c01ce5ab069b3042e2e27171241814dc 0 1661353968324 2 connected
afb32dc53068eb5bfe3b544fd3ae5adfad29ea7f 127.0.0.1:6385@16385 slave 9a6b56517eceab367aebc0105238c010792aa36c 0 1661353970333 1 connected
f6b538e2df80fea1e948fda3024647bdccae3f33 127.0.0.1:6382@16382 master - 0 1661353970000 3 connected 10923-16383
b8e79566afa7b55b1a451024f50c142f658ec4a2 127.0.0.1:6384@16384 slave f6b538e2df80fea1e948fda3024647bdccae3f33 0 1661353968000 3 connected
9a6b56517eceab367aebc0105238c010792aa36c 127.0.0.1:6380@16380 myself,master - 0 1661353969000 1 connected 0-5460

</code></pre></div></div>

<h2 id="é™„å½•">é™„å½•</h2>

<p>é›†ç¾¤é‡å¯è„šæœ¬ï¼Œä»…é€‚ç”¨å•æœåŠ¡å™¨ï¼ŒæŒ‰ç…§ä»¥ä¸Šæ–¹å¼é…ç½®çš„é›†ç¾¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ports=('6380' '6381' '6382' '6383' '6384' '6385')
path=/usr/local/custom/redis/
dataDirPre=redisdata

pid=`ps -ef | grep redis-server | grep -v grep | awk '{print $2}'`
if [ -z "$pid" ];
	then
		echo "[ not find pid ]"
else
	for id in $pid
		do
			echo "kill -9 pid:" $id
			kill -9 $id
		done
	echo "å¼€å§‹åˆ é™¤æ•°æ®"
	for port in ${ports[@]}
 		do
			echo $path$port
			echo $path$dataDirPre$port
			rm -rf $path$port/dump.rdb
			rm -rf $path$port/appendonly.aof
			rm -rf $path$port/nodes-*.*
			rm -rf $path$dataDirPre$port/dump.rdb
			rm -rf $path$dataDirPre$port/appendonly.aof
			rm -rf $path$dataDirPre$port/nodes-*.*
		done
	echo "å¼€å§‹åˆ›å»ºé›†ç¾¤"
	for port in ${ports[@]}
		do
			str=$str" 127.0.0.1:"$port" "
			$path"src/redis-server" $path"/"$port"/redis.conf"
		done
	$path'src/redis-cli' --cluster create $str  --cluster-replicas 1 -a redisPass		
fi
echo "----------------------æ—¥å¿—è¯¦è§/usr/local/custom/redis/logs---------------"
</code></pre></div></div>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="redis" /><category term="redisé›†ç¾¤" /><summary type="html"><![CDATA[redisæ˜¯ä¸ªå¥½ä¸œè¥¿å•Šï¼Œç¼–è¯‘å®‰è£…éœ€è¦gcc]]></summary></entry><entry><title type="html">Linux Centos Rabbitmqå®‰è£…</title><link href="http://localhost:4000/2022/08/26/Linux-CentOS-rabbitMQ%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Rabbitmqå®‰è£…" /><published>2022-08-26T00:00:00+08:00</published><updated>2022-08-26T00:00:00+08:00</updated><id>http://localhost:4000/2022/08/26/Linux-CentOS-rabbitMQ%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/08/26/Linux-CentOS-rabbitMQ%E5%AE%89%E8%A3%85.html"><![CDATA[<p>æ–‡æ¡£æä¾›RabbitMQç‰ˆæœ¬3.10.7ï¼ŒErlangç‰ˆæœ¬25.0.3ï¼ŒLinuxç‰ˆæœ¬CenterOS7.9</p>

<h2 id="é›¶ç‰ˆæœ¬å¯¹åº”">é›¶ã€ç‰ˆæœ¬å¯¹åº”</h2>

<p>https://www.rabbitmq.com/which-erlang.html</p>

<h2 id="ä¸€epelå®‰è£…">ä¸€ã€EPELå®‰è£…</h2>

<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>

<p>https://docs.fedoraproject.org/en-US/epel/#_quickstart</p>

<p>yum install -y epel-release</p>

<h2 id="äºŒerlangå®‰è£…">äºŒã€Erlangå®‰è£…</h2>

<p>é¦–å…ˆå®‰è£…ä¾èµ–ï¼š</p>

<p>yum -y install gcc glibc-devel make ncurses-devel openssl-devel xmlto perl wget gtk2-devel binutils-devel</p>

<p>ç„¶åï¼ŒåŒºåˆ†å®‰è£…æ–¹å¼</p>

<h3 id="1yumå®‰è£…æœªç»è¯•éªŒ">1ã€yumå®‰è£…ï¼ˆæœªç»è¯•éªŒï¼‰</h3>

<p>opensslç‰ˆæœ¬é™å®šåªèƒ½æ˜¯1.0.1ï¼Œä¸”ç¼–è¯‘æ—¶CFLAGå‚æ•°æ·»åŠ -fPIC</p>

<p>è·å–éœ€è¦çš„ç‰ˆæœ¬çš„rpmåŒ…</p>

<p>https://www.erlang-solutions.com/downloads/</p>

<p>ç„¶åå°†é“¾æ¥ç”¨äºwget</p>

<p>wget https://packages.erlang-solutions.com/erlang/rpm/centos/7/x86_64/esl-erlang_25.0.3-1~centos~7_amd64.rpm</p>

<p>æ­¤å¤„â†“å¯èƒ½ä¼šé‡åˆ°é—®é¢˜â‘ </p>

<p>rpm -Uvh esl-erlang_25.0.3-1~centos~7_amd64.rpm</p>

<p>rpm â€“import https://packages.erlang-solutions.com/rpm/erlang_solutions.asc</p>

<p>vi /etc/yum.repos.d/erlang_solutions.repo</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[erlang-solutions]
name=CentOS $releasever - $basearch - Erlang Solutions
baseurl=https://packages.erlang-solutions.com/rpm/centos/$releasever/$basearch
gpgcheck=1
gpgkey=https://packages.erlang-solutions.com/rpm/erlang_solutions.asc
enabled=1
</code></pre></div></div>

<p>sudo yum install erlang</p>

<h3 id="2æºç ç¼–è¯‘å®‰è£…">2ã€æºç ç¼–è¯‘å®‰è£…</h3>

<p>è¿™ç©æ„å„¿ä¸å¥½è£…å•Šï¼Œç¯å¢ƒè¦æ±‚çœŸé¸¡å„¿å¤š</p>

<h4 id="1ä¾èµ–ç¯å¢ƒå®‰è£…">1.ä¾èµ–ç¯å¢ƒå®‰è£…</h4>

<p>ä¾èµ–ç¯å¢ƒä¸€å †ï¼ŒwxWidgets åˆ°è¿™é‡Œä¸‹è½½https://www.wxwidgets.org/downloads/</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install unixODBC-devel
yum list *gtk+*
yum install mesa*
bzip2 -dkv wxWidgets-3.2.0.tar.bz2
tar -xvf wxWidgets-3.2.0.tar
cd wxWidgets-3.2.0/
./configure --with-opengl --enable-debug --enable-unicode
#è¿™ä¸ªå¥½ä¹…ã€‚
make &amp;&amp; make install
#æµ‹è¯•
wx-config
</code></pre></div></div>

<h4 id="2å¼€è£…">2.å¼€è£…</h4>

<p>gitåœ°å€ï¼Œé‚£éœ€è¦çš„ç‰ˆæœ¬é“¾æ¥</p>

<p>https://github.com/erlang/otp/releases</p>

<p>wget https://github.com/erlang/otp/releases/download/OTP-25.0.3/otp_src_25.0.3.tar.gz</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf otp_src_25.0.3.tar.gz
mv otp_src_25.0.3 erlang_opt
cd erlang_opt
mkdir ../erlang
./configure --prefix=/usr/local/custom/erlang
</code></pre></div></div>

<p>æœ‰è¿™ä¸ªinfoä¸ç®¡ä»–</p>

<p>wxï¼šWidgets was not compiled with â€“enable-webview or wxWebView developer package is not installed, wxWebView will NOT be available</p>

<p>ç›´æ¥æ‰§è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make &amp;&amp; make install
</code></pre></div></div>

<p>vim /etc/profile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PATH=$PATH:/usr/local/custom/erlang/bin
</code></pre></div></div>

<p>source /etc/profile</p>

<p>erl</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Erlang/OTP 25 [erts-13.0.3] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [jit:ns]
Eshell V13.0.3  (abort with ^G)
halt().
#è¿™ä¸ªErlang/OTP 25çš„25å°±æ˜¯ç‰ˆæœ¬å·
</code></pre></div></div>

<h2 id="ä¸‰å®‰è£…rabbitmq">ä¸‰ã€å®‰è£…RabbitMQ</h2>

<p>å®˜ç½‘é€‰æ‹©éœ€è¦çš„ç‰ˆæœ¬</p>

<p>https://github.com/rabbitmq/rabbitmq-server/releases</p>

<p>wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.10.7/rabbitmq-server-generic-unix-3.10.7.tar.xz</p>

<p>yum install -y xz</p>

<p>xz -d rabbitmq-server-generic-unix-3.10.7.tar.xz</p>

<p>tar -xvf rabbitmq-server-generic-unix-3.10.7.tar</p>

<p>mv rabbitmq_server-3.10.7/ /usr/local/</p>

<p>mv /usr/local/rabbitmq_server-3.10.7 /usr/local/rabbitmq</p>

<p>echo â€˜export PATH=$PATH:/usr/local/rabbitmq/sbinâ€™Â Â» /etc/profile</p>

<p>source /etc/profile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#å¯åŠ¨
rabbitmq-server -detached
#åœæ­¢
rabbitmqctl stop
#çŠ¶æ€
rabbitmqctl status
#å¼€å¯webæ’ä»¶
rabbitmq-plugins enable rabbitmq_management
</code></pre></div></div>

<p>å¼€å¯ç«¯å£15672</p>

<p>ç™»å½•é»˜è®¤è´¦å·ï¼šguest/ guest</p>

<p>æ³¨æ„ï¼Œå®‰å…¨èµ·è§rabbitmq3.3.0ä¹‹åï¼Œé»˜è®¤æƒ…å†µä¸‹rabbitmqçš„guest/guestè´¦æˆ·å°†ä¸èƒ½å®ç°è¿œç¨‹ç™»å½•ï¼Œåªèƒ½åœ¨æœ¬åœ°ç™»å½•ã€‚</p>

<p>è§£å†³æ–¹æ¡ˆï¼šåˆ›å»ºè¿œç¨‹ç™»é™†è´¦æˆ·</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
rabbitmqctl list_users
#æ–°å¢è´¦æˆ·
rabbitmqctl add_user ç”¨æˆ·å å¯†ç 
#è®¾ç½®è§’è‰²
#ç”¨æˆ·è§’è‰²å¯ä»¥åˆ†ä¸ºè¶…çº§ç®¡ç†å‘˜administratorã€ç›‘æ§è€…monitoringã€ç­–ç•¥åˆ¶å®šè€…policymakerã€æ™®é€šç®¡ç†è€…managementç­‰
rabbitmqctl set_user_tags ç”¨æˆ·å administrator
#èµ‹äºˆæƒé™
rabbitmqctl set_permissions -p / ç”¨æˆ·å "." "." ".*"
#å¿˜è®°å¯†ç æ›´æ–°å¯†ç 
rabbitmqctl  change_password  ç”¨æˆ·å æ–°å¯†ç 
</code></pre></div></div>

<h2 id="é™„å½•">é™„å½•</h2>

<h3 id="é™„å¸¦å­¦ä¹ ç®€å•é˜Ÿåˆ—gité¡¹ç›®">é™„å¸¦å­¦ä¹ ç®€å•é˜Ÿåˆ—gité¡¹ç›®</h3>

<p>https://download.csdn.net/download/zpcandzhj/10585077</p>

<h3 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜">å¯èƒ½é‡åˆ°çš„é—®é¢˜</h3>

<p>â‘ yumå®‰è£…æŠ¥äº†è¿™ä¸ª</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>é”™è¯¯ï¼šä¾èµ–æ£€æµ‹å¤±è´¥ï¼š
        libcrypto.so.10()(64bit) è¢« esl-erlang-25.0.3-1.x86_64 éœ€è¦
        libcrypto.so.10(OPENSSL_1.0.1_EC)(64bit) è¢« esl-erlang-25.0.3-1.x86_64 éœ€è¦
        libcrypto.so.10(OPENSSL_1.0.2)(64bit) è¢« esl-erlang-25.0.3-1.x86_64 éœ€è¦
        libcrypto.so.10(libcrypto.so.10)(64bit) è¢« esl-erlang-25.0.3-1.x86_64 éœ€è¦
        libodbc.so.2()(64bit) è¢« esl-erlang-25.0.3-1.x86_64 éœ€è¦
</code></pre></div></div>

<p>è§£å†³ï¼š</p>

<p>wget http://www.openssl.org/source/openssl-1.0.1f.tar.gz</p>

<p>tar zxvf openssl-1.0.1f.tar.gz</p>

<p>cd openssl-1.0.1f</p>

<p>./config â€“prefix=/opt/ssl ï¼ˆä¸‹è½½ç›®å½•ï¼‰</p>

<p>vim Makefile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#CFLAGå‚æ•°åˆ—è¡¨é‡ŒåŠ ä¸Š-fPIC
CC= gcc  
CFLAG= -fPIC -DOP........
</code></pre></div></div>

<p>make &amp;&amp; make install</p>

<p>æ­¤æ—¶å¯èƒ½æŠ¥é”™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POD document had syntax errors at /usr/bin/pod2man line 69.
make: *** [Makefile:641ï¼šinstall_docs] é”™è¯¯ 255
</code></pre></div></div>

<p>æ‰¾åˆ°pod2manå¯¹åº”è¡Œæ•°ç›´æ¥æ³¨é‡Š</p>

<p>ç„¶åæŒ‡å®šsslè·¯å¾„ç¼–è¯‘å®‰è£…</p>

<p>./configure â€“with-ssl=/opt/ssl/ â€“prefix=/opt/erlang</p>

<p>make &amp;&amp; make install</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="rebbitMQ" /><summary type="html"><![CDATA[æ–‡æ¡£æä¾›RabbitMQç‰ˆæœ¬3.10.7ï¼ŒErlangç‰ˆæœ¬25.0.3ï¼ŒLinuxç‰ˆæœ¬CenterOS7.9]]></summary></entry><entry><title type="html">Linux Centos Mavenå®‰è£…</title><link href="http://localhost:4000/2022/08/24/Linux-CentOS-maven%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Mavenå®‰è£…" /><published>2022-08-24T00:00:00+08:00</published><updated>2022-08-24T00:00:00+08:00</updated><id>http://localhost:4000/2022/08/24/Linux-CentOS-maven%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/08/24/Linux-CentOS-maven%E5%AE%89%E8%A3%85.html"><![CDATA[<p>mavenç‰ˆæœ¬æŸ¥çœ‹https://dlcdn.apache.org/maven/maven-3/</p>

<p>å®‰è£…mavenï¼Œå°±å››æ­¥</p>

<h2 id="1ä¸‹è½½">1ã€ä¸‹è½½</h2>

<p>wget https://dlcdn.apache.org/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz</p>

<h2 id="2è§£å‹">2ã€è§£å‹</h2>

<p>tar -zxvf apache-maven-3.8.6-bin.tar.gz</p>

<h2 id="3æ”¹å">3ã€æ”¹å</h2>

<p>mv apache-maven-3.8.6 maven</p>

<h2 id="4æ·»åŠ ç¯å¢ƒå˜é‡">4ã€æ·»åŠ ç¯å¢ƒå˜é‡</h2>

<p>æ”¾åœ¨æœ«å°¾</p>

<p>vim /etc/profile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export MAVEN_HOME=/usr/local/maven/
export PATH=${PATH}:${MAVEN_HOME}/bin
</code></pre></div></div>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="maven" /><summary type="html"><![CDATA[mavenç‰ˆæœ¬æŸ¥çœ‹https://dlcdn.apache.org/maven/maven-3/]]></summary></entry><entry><title type="html">Linux Centos Nginxå®‰è£…</title><link href="http://localhost:4000/2022/08/24/Linux-CentOS-nginx%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Nginxå®‰è£…" /><published>2022-08-24T00:00:00+08:00</published><updated>2022-08-24T00:00:00+08:00</updated><id>http://localhost:4000/2022/08/24/Linux-CentOS-nginx%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/08/24/Linux-CentOS-nginx%E5%AE%89%E8%A3%85.html"><![CDATA[<p>å®˜ç½‘æŒ‘é€‰ç‰ˆæœ¬ä¸‹è½½</p>

<p>http://nginx.org/en/download.html</p>

<h2 id="ä¸€å®‰è£…ä¾èµ–">ä¸€ã€å®‰è£…ä¾èµ–</h2>

<p>yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</p>

<h2 id="äºŒä¸‹è½½">äºŒã€ä¸‹è½½</h2>

<p>wget http://nginx.org/download/nginx-1.22.0.tar.gz</p>

<h2 id="ä¸‰è§£å‹">ä¸‰ã€è§£å‹</h2>

<p>tar -zxvf nginx-1.22.0.tar.gz</p>

<h2 id="å››ç¼–è¯‘å®‰è£…">å››ã€ç¼–è¯‘å®‰è£…</h2>

<p>mv nginx-1.22.0 nginx</p>

<p>cd nginx</p>

<p>./configure</p>

<p>make &amp; make install</p>

<h2 id="äº”å¯åŠ¨">äº”ã€å¯åŠ¨</h2>

<p>cd /usr/local/nginx/sbin</p>

<p>./nginx</p>

<h2 id="é™„å¸¸ç”¨å‘½ä»¤">é™„ï¼šå¸¸ç”¨å‘½ä»¤</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ç”¨æŸä¸ªè·¯å¾„ä¸‹çš„é…ç½®å¯åŠ¨
nginx -c /usr/local/nginx/conf/nginx.conf 
#å¿«é€Ÿå…³é—­
nginx -s stop
#å®‰å…¨å…³é—­
nginx -s quit
#é‡è½½é…ç½®
nginx -s reload
#é‡æ–°æ‰“å¼€ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶
nginx -s reopen
#éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œåæ¥è·¯å¾„ï¼Œä¸æ¥ä»£è¡¨é»˜è®¤é…ç½®
nginx -t /home/test/conf/nginx.conf
</code></pre></div></div>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="nginx" /><summary type="html"><![CDATA[å®˜ç½‘æŒ‘é€‰ç‰ˆæœ¬ä¸‹è½½]]></summary></entry><entry><title type="html">Linux Centos Nacoså®‰è£…</title><link href="http://localhost:4000/2022/08/24/Linux-CentOS-nacos%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Nacoså®‰è£…" /><published>2022-08-24T00:00:00+08:00</published><updated>2022-08-24T00:00:00+08:00</updated><id>http://localhost:4000/2022/08/24/Linux-CentOS-nacos%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/08/24/Linux-CentOS-nacos%E5%AE%89%E8%A3%85.html"><![CDATA[<p>nacosæ³¨å†Œä¸­å¿ƒï¼Œéœ€è¦å®‰è£…mavenä½œä¸ºå‰ç½®</p>

<p>nacosæŸ¥çœ‹ç‰ˆæœ¬</p>

<p>https://github.com/alibaba/nacos/releases</p>

<h2 id="ä¸€ä¸‹è½½">ä¸€ã€ä¸‹è½½</h2>

<p>wget https://github.com/alibaba/nacos/releases/download/1.4.3/nacos-server-1.4.3.tar.gz</p>

<h2 id="äºŒè§£å‹">äºŒã€è§£å‹</h2>

<p>tar -zxvf nacos-server-1.4.3.tar.gz</p>

<h2 id="ä¸‰æ•°æ®æºé…ç½®">ä¸‰ã€æ•°æ®æºé…ç½®</h2>

<p>vim nacos/conf/application.properties</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#å‡ ä¸ªé‡è¦é…ç½®
#æ•°æ®åº“è¿æ¥ç±»å‹
spring.datasource.platform=mysql
#æ•°æ®åº“é“¾æ¥æ•°é‡
db.num=1
#æ•°æ®åº“è¿æ¥è·¯å¾„
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC
#æ•°æ®åº“è´¦å·
db.user.0=root
#æ•°æ®åº“å¯†ç 
db.password.0=password
#æ˜¯å¦å¼€å¯ç”¨æˆ·è®¤è¯ï¼Œå¼€å¯åï¼Œé¡¹ç›®å¯åŠ¨è¿æ¥nacosæ—¶ï¼Œéœ€è¦é…ç½®è¿æ¥è´¦å·å¯†ç ï¼ˆnacosç™»å½•è´¦å·å¯†ç ï¼‰
nacos.core.auth.enabled=true
</code></pre></div></div>

<h3 id="å››nacoså¯åŠ¨">å››ã€nacoså¯åŠ¨</h3>

<p>sh nacos/bin/startup.sh -m standalone</p>

<p>æŸ¥çœ‹å¯åŠ¨çŠ¶æ€</p>

<p>tail -100f nacos/logs/start.out</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="nacos" /><summary type="html"><![CDATA[nacosæ³¨å†Œä¸­å¿ƒï¼Œéœ€è¦å®‰è£…mavenä½œä¸ºå‰ç½®]]></summary></entry><entry><title type="html">Linux Centos Mysqlå®‰è£…</title><link href="http://localhost:4000/2022/08/24/Linux-CentOS-mysql%E5%AE%89%E8%A3%85.html" rel="alternate" type="text/html" title="Linux Centos Mysqlå®‰è£…" /><published>2022-08-24T00:00:00+08:00</published><updated>2022-08-24T00:00:00+08:00</updated><id>http://localhost:4000/2022/08/24/Linux-CentOS-mysql%E5%AE%89%E8%A3%85</id><content type="html" xml:base="http://localhost:4000/2022/08/24/Linux-CentOS-mysql%E5%AE%89%E8%A3%85.html"><![CDATA[<p>mysqlæ•°æ®åº“å®‰è£…æ“ä½œ</p>

<h2 id="ä¸€æ¸…ç†æ•°æ®">ä¸€ã€æ¸…ç†æ•°æ®</h2>

<h3 id="1é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…è¿‡mysql">1ã€é¦–å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…è¿‡mysql</h3>

<table>
  <tbody>
    <tr>
      <td>rpm -qa</td>
      <td>grep mysql</td>
    </tr>
  </tbody>
</table>

<p>è‹¥æœ‰åˆ™æ¸…ç†å¹²å‡€å†å®‰è£…</p>

<p>whereis mysql</p>

<p>æ‰¾åˆ°æ–‡ä»¶å¤¹ç›®å½•ï¼Œå†æŠŠå®ƒåˆ é™¤ã€‚</p>

<p>rpm -e â€“nodeps mysql-xxxx</p>

<h3 id="2æ£€æŸ¥ä½ ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦mariadbè¾“å…¥å¦‚ä¸‹æ£€æŸ¥">2ã€æ£€æŸ¥ä½ ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦mariadbï¼Œè¾“å…¥å¦‚ä¸‹æ£€æŸ¥ã€‚</h3>

<table>
  <tbody>
    <tr>
      <td>rpm -qa</td>
      <td>grep mariadb</td>
    </tr>
  </tbody>
</table>

<p>å¦‚æœæœ‰åˆ™éœ€è¦æŠŠå®ƒå¸è½½æ‰ï¼Œå› ä¸ºä¼šå’ŒMysqlå¼•èµ·å†²çªï¼Œè¾“å…¥å¦‚ä¸‹å¸è½½æ‰ã€‚</p>

<p>rpm -e â€“nodeps mariadb-libs</p>

<h2 id="äºŒä¸‹è½½åœ°å€æˆ–è€…ä½¿ç”¨æœ¬åœ°å®‰è£…åŒ…">äºŒã€ä¸‹è½½åœ°å€æˆ–è€…ä½¿ç”¨æœ¬åœ°å®‰è£…åŒ…</h2>

<p>å®‰è£…ç›®å½•é€‰æ‹©åœ¨/usr/local</p>

<p>cd /usr/local</p>

<h3 id="1ä¸‹è½½">1ã€ä¸‹è½½</h3>

<p>wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</p>

<h3 id="2è§£å‹">2ã€è§£å‹</h3>

<p>tar -xzvf mysql-5.7.39-linux-glibc2.12-x86_64.tar.gz</p>

<h3 id="3ä¿®æ”¹æ–‡ä»¶ç›®å½•">3ã€ä¿®æ”¹æ–‡ä»¶ç›®å½•</h3>

<p>mv mysql-5.7.39-linux-glibc2.12-x86_64 mysql</p>

<h3 id="4æ›´æ”¹mysqlç›®å½•ä¸‹æ‰€æœ‰çš„ç›®å½•åŠæ–‡ä»¶å¤¹æ‰€å±ç»„åˆç”¨æˆ·">4ã€æ›´æ”¹mysqlç›®å½•ä¸‹æ‰€æœ‰çš„ç›®å½•åŠæ–‡ä»¶å¤¹æ‰€å±ç»„åˆç”¨æˆ·</h3>

<p>groupadd mysql</p>

<p>useradd -r -g mysql mysql</p>

<p>chown -R mysql:mysql mysql/</p>

<p>chmod -R 777 mysql/</p>

<h3 id="5ç¼–è¾‘é…ç½®æ–‡ä»¶">5ã€ç¼–è¾‘é…ç½®æ–‡ä»¶</h3>

<p>vi /usr/local/mysql/my.cnf</p>

<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ºå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[client]
#password=88888888
socket=/usr/local/mysql/mysql.sock

[mysql]
socket=/usr/local/mysql/mysql.sock
# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†
default-character-set=utf8

[mysqld]
pid-file=/usr/local/mysql/mysql.pid
log-error = /usr/local/mysql/log/mysql-error.log
#è®¾ç½®3306ç«¯å£
port = 3306
# è®¾ç½®mysqlçš„å®‰è£…ç›®å½•
basedir=/usr/local/mysql
# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•
datadir=/usr/local/mysql/data
#sock
socket=/usr/local/mysql/mysql.sock
# å…è®¸æœ€å¤§è¿æ¥æ•°
max_connections=200
# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸º8æ¯”ç‰¹ç¼–ç çš„latin1å­—ç¬¦é›†
character-set-server=utf8mb4
# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“
default-storage-engine=INNODB
#å…è®¸æ—¶é—´ç±»å‹çš„æ•°æ®ä¸ºé›¶(å»æ‰NO_ZERO_IN_DATE,NO_ZERO_DATE)
sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
#ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
lower_case_table_names=1
</code></pre></div></div>

<h3 id="6ç¼–è¯‘å®‰è£…">6ã€ç¼–è¯‘å®‰è£…</h3>

<p>åˆ›å»ºdataæ–‡ä»¶å¤¹</p>

<p>mkdir /usr/local/mysql/data</p>

<p>æ‰§è¡Œå®‰è£…ï¼Œè´¦å·é»˜è®¤root<strong>ï¼ˆéœ€è¦æ³¨æ„æœ€åè¡Œæ˜¾ç¤ºçš„æ˜¯rootçš„å¯†ç ï¼‰</strong></p>

<p>/usr/local/mysql/bin/mysqld â€“initialize â€“user=mysql â€“datadir=/usr/local/mysql/data â€“basedir=/usr/local/mysql</p>

<p>æ·»åŠ æ–‡ä»¶å¤¹</p>

<p>mkdir /usr/local/mysql/log</p>

<p>touch /usr/local/mysql/log/mysql-error.log</p>

<p>chmod -R 777 /usr/local/mysql/log</p>

<h3 id="7æœåŠ¡åŠmysqlå‘½ä»¤è½¯é“¾æ¥">7ã€æœåŠ¡åŠmysqlå‘½ä»¤è½¯é“¾æ¥</h3>

<p>ln -s /usr/local/mysql/bin/mysql /usr/bin</p>

<p>ln -s /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</p>

<h3 id="8å¯åŠ¨æœåŠ¡å¹¶ç™»å…¥æ›´æ”¹rootå¯†ç ">8ã€å¯åŠ¨æœåŠ¡å¹¶ç™»å…¥æ›´æ”¹rootå¯†ç </h3>

<p>service mysql start</p>

<p>ln -s /usr/local/mysql/mysql.sock /tmp/mysql.sock</p>

<p>mysql -u root -p <strong>åˆšåˆšç¼–è¯‘ç”Ÿæˆçš„é»˜è®¤å¯†ç </strong></p>

<p>set password for root@localhost = password(â€˜<strong>æ–°å¯†ç </strong>â€™);</p>

<p>flush privileges;</p>

<h3 id="9è®¾ç½®è¿œç¨‹ç™»å…¥">9ã€è®¾ç½®è¿œç¨‹ç™»å…¥ï¼š</h3>

<p>use mysql;</p>

<p>update user set host=â€™%â€™ where host=â€™localhostâ€™;</p>

<p>flush privileges;</p>

<h2 id="ä¸‰ä¸»ä»äº’å¤‡">ä¸‰ã€ä¸»ä»äº’å¤‡</h2>

<h3 id="1ä¿®æ”¹é…ç½®æ–‡ä»¶">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>

<p>ä¸»åº“é…ç½®æ–‡ä»¶</p>

<p>vim /etc/my.cnf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
server_id=1
log-bin=mysql-bin
log-bin-index=master-bin.index
relay-log=relay-log
relay-log-index=relay-log.index
</code></pre></div></div>

<p>ä»åº“é…ç½®æ–‡ä»¶</p>

<p>vim /etc/my.cnf</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[mysqld]
server_id=2
log-bin=mysql-bin
log-bin-index=master-bin.index
relay-log=relay-log
relay-log-index=relay-log.index
</code></pre></div></div>

<p>ä¸Šé¢ä¿®æ”¹é…ç½®æ–‡ä»¶éœ€é‡å¯æœåŠ¡</p>

<p>service mysql restart</p>

<h3 id="2ç™»å½•ä¸»åº“è®¾ç½®æˆæƒä»åº“">2ã€ç™»å½•ä¸»åº“è®¾ç½®æˆæƒä»åº“</h3>

<p>[root@servername fold]# mysql -u root -p</p>

<p>Enter password:ï¼ˆ<strong>å¯†ç è¾“å…¥ä¸å¯è§</strong>ï¼‰</p>

<p>mysql&gt; grant replication slave on <em>.</em> to â€˜rootâ€™@â€™<strong>ä»åº“çš„ipåœ°å€</strong>â€™ identified by â€˜<strong>ä»åº“ä¸»åº“è¿æ¥å¯†ç </strong>â€™;</p>

<p>mysql&gt;flush privileges;</p>

<p>æŸ¥çœ‹masterçš„çŠ¶æ€</p>

<p>mysql&gt;show master status;</p>

<p><img src="C:\Users\19604\AppData\Roaming\Typora\typora-user-images\image-20220824221121472.png" alt="image-20220824221121472" /></p>

<p>ä¸»åº“è¿›è¡Œé”è¡¨</p>

<p>mysql&gt;flush tables with read lock;</p>

<h3 id="3ä»åº“é…ç½®æ“ä½œ">3ã€ä»åº“é…ç½®æ“ä½œ</h3>

<p>[root@servername fold]# mysql -u root -p</p>

<p>Enter password:ï¼ˆ<strong>å¯†ç è¾“å…¥ä¸å¯è§</strong>ï¼‰</p>

<p>mysql&gt; change master to master_host=â€™<strong>ä¸»åº“ipåœ°å€</strong>â€˜,master_user=â€™rootâ€™, master_password=â€™<strong>ä»åº“ä¸»åº“è¿æ¥å¯†ç </strong>â€˜,master_log_file=â€™<strong>ä¸»åº“File</strong>â€˜,master_log_pos=ï¼ˆ<strong>ä¸»åº“position</strong>ï¼‰;</p>

<p>mysql&gt;start slave;</p>

<p>æŸ¥çœ‹è¿æ¥çŠ¶æ€</p>

<p>mysql&gt;show slave status\G;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                Slave_IO_State: Waiting for master to send event
                   Master_Host: 119.3.131.252
                   Master_User: root
                   Master_Port: 3306
                 Connect_Retry: 60
               Master_Log_File: mysql-bin.000007
           Read_Master_Log_Pos: 154
                Relay_Log_File: relay-log.000002
                 Relay_Log_Pos: 320
         Relay_Master_Log_File: mysql-bin.000007
              Slave_IO_Running: Yes				#æ­¤å¤„ä¸¤ä¸ªåœ°æ–¹
             Slave_SQL_Running: Yes				#å…¨éƒ¨ä¸ºYeså³æˆåŠŸ
               Replicate_Do_DB: 
           Replicate_Ignore_DB: 
            Replicate_Do_Table: 
        Replicate_Ignore_Table: 
       Replicate_Wild_Do_Table: 
   Replicate_Wild_Ignore_Table: 
          			Last_Errno: 0
          			Last_Error: 
         		  Skip_Counter: 0
     	   Exec_Master_Log_Pos: 154
      		   Relay_Log_Space: 521
       		   Until_Condition: None
        		Until_Log_File: 
        		 Until_Log_Pos: 0
            Master_SSL_Allowed: No
            Master_SSL_CA_File: 
            Master_SSL_CA_Path: 
    	  	   Master_SSL_Cert: 
     		 Master_SSL_Cipher: 
        		Master_SSL_Key: 
    	 Seconds_Behind_Master: 0
 Master_SSL_Verify_Server_Cert: No
                 Last_IO_Errno: 0
                 Last_IO_Error: 
                Last_SQL_Errno: 0
                Last_SQL_Error: 
   Replicate_Ignore_Server_Ids: 
       		  Master_Server_Id: 2
         		   Master_UUID: 8823ac3e-0983-11ed-97a9-fa163e59f44f
       		  Master_Info_File: /usr/local/mysql/data/master.info
              		 SQL_Delay: 0
           SQL_Remaining_Delay: NULL
       Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates
          	Master_Retry_Count: 86400
        		   Master_Bind: 
       Last_IO_Error_Timestamp: 
      Last_SQL_Error_Timestamp: 
                Master_SSL_Crl: 
            Master_SSL_Crlpath: 
            Retrieved_Gtid_Set: 
             Executed_Gtid_Set: 
                 Auto_Position: 0
          Replicate_Rewrite_DB: 
                  Channel_Name: 
            Master_TLS_Version: 
1 row in set (0.00 sec)

ERROR: 
No query specified
</code></pre></div></div>

<h3 id="4è§£é”ä¸»åº“åˆ«æ¼äº†">4ã€è§£é”ä¸»åº“ï¼ˆåˆ«æ¼äº†ï¼‰</h3>

<p>mysql&gt; unlock tables;</p>

<h2 id="å››ä¸»ä¸»äº’å¤‡">å››ã€ä¸»ä¸»äº’å¤‡</h2>

<p>ä¸»ä¸»äº’å¤‡ã€å³å°†ä¸»ä»äº’å¤‡åè¿‡æ¥ï¼Œé‡æ–°æ‰§è¡Œä¸€éæµç¨‹å³å¯</p>]]></content><author><name></name></author><category term="è¿ç»´" /><category term="linux" /><category term="CentOS" /><category term="mysql" /><category term="mysql5.7" /><category term="ä¸»ä¸»äº’å¤‡" /><category term="ä¸»ä»å¤‡ä»½" /><summary type="html"><![CDATA[mysqlæ•°æ®åº“å®‰è£…æ“ä½œ]]></summary></entry></feed>